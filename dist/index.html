<!doctype html><html lang="en">
 <head>
  <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
  <title>Aggregator Specification</title>
  <meta content="width=device-width, initial-scale=1, shrink-to-fit=no" name="viewport">
<style data-fill-with="stylesheet">/******************************************************************************
 *                   Style sheet for the W3C specifications                   *
 *
 * Special classes handled by this style sheet include:
 *
 * Indices
 *   - .toc for the Table of Contents (<ol class="toc">)
 *     + <span class="secno"> for the section numbers
 *   - #toc for the Table of Contents (<nav id="toc">)
 *   - ul.index for Indices (<a href="#ref">term</a><span>, in § N.M</span>)
 *   - table.index for Index Tables (e.g. for properties or elements)
 *
 * Structural Markup
 *   - table.data for general data tables
 *     -> use 'scope' attribute, <colgroup>, <thead>, and <tbody> for best results !
 *     -> use <table class='complex data'> for extra-complex tables
 *     -> use <td class='long'> for paragraph-length cell content
 *     -> use <td class='pre'> when manual line breaks/indentation would help readability
 *   - dl.switch for switch statements
 *   - ol.algorithm for algorithms (helps to visualize nesting)
 *   - .figure and .caption (HTML4) and figure and figcaption (HTML5)
 *     -> .sidefigure for right-floated figures
 *   - ins/del
 *     -> ins/del.c### for candidate and proposed changes (amendments)
 *
 * Code
 *   - pre and code
 *
 * Special Sections
 *   - .note       for informative notes             (div, p, span, aside, details)
 *   - .example    for informative examples          (div, p, pre, span)
 *   - .issue      for issues                        (div, p, span)
 *   - .advisement for loud normative statements     (div, p, strong)
 *   - .annoying-warning for spec obsoletion notices (div, aside, details)
 *   - .correction for "candidate corrections"       (div, aside, details, section)
 *   - .addition   for "candidate additions"         (div, aside, details, section)
 *   - .correction.proposed for "proposed corrections" (div, aside, details, section)
 *   - .addition.proposed   for "proposed additions"   (div, aside, details, section)
 *
 * Definition Boxes
 *   - pre.def   for WebIDL definitions
 *   - table.def for tables that define other entities (e.g. CSS properties)
 *   - dl.def    for definition lists that define other entitles (e.g. HTML elements)
 *
 * Numbering
 *   - .secno for section numbers in .toc and headings (<span class='secno'>3.2</span>)
 *   - .marker for source-inserted example/figure/issue numbers (<span class='marker'>Issue 4</span>)
 *   - ::before styled for CSS-generated issue/example/figure numbers:
 *     -> Documents wishing to use this only need to add
 *        figcaption::before,
 *        .caption::before { content: "Figure "  counter(figure) " ";  }
 *        .example::before { content: "Example " counter(example) " "; }
 *        .issue::before   { content: "Issue "   counter(issue) " ";   }
 *
 * Header Stuff (ignore, just don't conflict with these classes)
 *   - .head for the header
 *   - .copyright for the copyright
 *
 * Outdated warning for old specs
 *
 * Miscellaneous
 *   - .overlarge for things that should be as wide as possible, even if
 *     that overflows the body text area. This can be used on an item or
 *     on its container, depending on the effect desired.
 *     Note that this styling basically doesn't help at all when printing,
 *     since A4 paper isn't much wider than the max-width here.
 *     It's better to design things to fit into a narrower measure if possible.
 *
 *   - js-added ToC jump links (see fixup.js)
 *
 ******************************************************************************/

/* color variables included separately for reliability */

/******************************************************************************/
/*                                    Body                                    */
/******************************************************************************/

	html {
	}

	body {
		counter-reset: example figure issue;

		/* Layout */
		max-width: 50em;			  /* limit line length to 50em for readability   */
		margin: 0 auto;				/* center text within page                    */
		padding: 1.6em 1.5em 2em 50px; /* assume 16px font size for downlevel clients */
		padding: 1.6em 1.5em 2em calc(26px + 1.5em); /* leave space for status flag    */

		/* Typography */
		line-height: 1.5;
		font-family: sans-serif;
		widows: 2;
		orphans: 2;
		word-wrap: break-word;
		overflow-wrap: break-word;
		hyphens: auto;

		color: black;
		color: var(--text);
		background: white top left fixed no-repeat;
		background: var(--bg) top left fixed no-repeat;
		background-size: 25px auto;
	}


/******************************************************************************/
/*                         Front Matter & Navigation                          */
/******************************************************************************/

/** Header ********************************************************************/

	div.head { margin-bottom: 1em; }
	div.head hr { border-style: solid; }

	div.head h1 {
		font-weight: bold;
		margin: 0 0 .1em;
		font-size: 220%;
	}

	div.head h2 { margin-bottom: 1.5em;}

/** W3C Logo ******************************************************************/

	.head .logo {
		float: right;
		margin: 0.4rem 0 0.2rem .4rem;
	}

	.head img[src*="logos/W3C"] {
		display: block;
		border: solid #1a5e9a;
		border: solid var(--logo-bg);
		border-width: .65rem .7rem .6rem;
		border-radius: .4rem;
		background: #1a5e9a;
		background: var(--logo-bg);
		color: white;
		color: var(--logo-text);
		font-weight: bold;
	}

	.head a:hover > img[src*="logos/W3C"],
	.head a:focus > img[src*="logos/W3C"] {
		opacity: .8;
	}

	.head a:active > img[src*="logos/W3C"] {
		background: #c00;
		background: var(--logo-active-bg);
		border-color: #c00;
		border-color: var(--logo-active-bg);
	}

	/* see also additional rules in Link Styling section */

/** Copyright *****************************************************************/

	p.copyright,
	p.copyright small { font-size: small; }

/** Back to Top / ToC Toggle **************************************************/

	@media print {
		#toc-nav {
			display: none;
		}
	}
	@media not print {
		#toc-nav {
			position: fixed;
			z-index: 3;
			bottom: 0; left: 0;
			margin: 0;
			min-width: 1.33em;
			border-top-right-radius: 2rem;
			box-shadow: 0 0 2px;
			font-size: 1.5em;
		}
		#toc-nav > a {
			display: block;
			white-space: nowrap;

			height: 1.33em;
			padding: .1em 0.3em;
			margin: 0;

			box-shadow: 0 0 2px;
			border: none;
			border-top-right-radius: 1.33em;

			color: #707070;
			color: var(--tocnav-normal-text);
			background: white;
			background: var(--tocnav-normal-bg);
		}
		#toc-nav > a:hover,
		#toc-nav > a:focus {
			color: black;
			color: var(--tocnav-hover-text);
			background: #f8f8f8;
			background: var(--tocnav-hover-bg);
		}
		#toc-nav > a:active {
			color: #c00;
			color: var(--tocnav-active-text);
			background: white;
			background: var(--tocnav-active-bg);
		}

		#toc-nav > #toc-jump {
			padding-bottom: 2em;
			margin-bottom: -1.9em;
		}

		/* statusbar gets in the way on keyboard focus; remove once browsers fix */
		#toc-nav > a[href="#toc"]:not(:hover):focus:last-child {
			padding-bottom: 1.5rem;
		}

		#toc-nav:not(:hover) > a:not(:focus) > span + span {
			/* Ideally this uses :focus-within on #toc-nav */
			display: none;
		}
		#toc-nav > a > span + span {
			padding-right: 0.2em;
		}
	}

/** ToC Sidebar ***************************************************************/

	/* Floating sidebar */
	@media screen {
		body.toc-sidebar #toc {
			position: fixed;
			top: 0; bottom: 0;
			left: 0;
			width: 23.5em;
			max-width: 80%;
			max-width: calc(100% - 2em - 26px);
			overflow: auto;
			padding: 0 1em;
			padding-left: 42px;
			padding-left: calc(1em + 26px);
			color: black;
			color: var(--tocsidebar-text);
			background: inherit;
			background-color: #f7f8f9;
			background-color: var(--tocsidebar-bg);
			z-index: 1;
			box-shadow: -.1em 0 .25em rgba(0,0,0,.1) inset;
			box-shadow: -.1em 0 .25em var(--tocsidebar-shadow) inset;
		}
		body.toc-sidebar #toc h2 {
			margin-top: .8rem;
			font-variant: small-caps;
			font-variant: all-small-caps;
			text-transform: lowercase;
			font-weight: bold;
			color: gray;
			color: hsla(203,20%,40%,.7);
			color: var(--tocsidebar-heading-text);
		}
		body.toc-sidebar #toc-jump:not(:focus) {
			width: 0;
			height: 0;
			padding: 0;
			position: absolute;
			overflow: hidden;
		}
	}
	/* Hide main scroller when only the ToC is visible anyway */
	@media screen and (max-width: 28em) {
		body.toc-sidebar {
			overflow: hidden;
		}
	}

	/* Sidebar with its own space */
	@media screen and (min-width: 78em) {
		body:not(.toc-inline) #toc {
			position: fixed;
			top: 0; bottom: 0;
			left: 0;
			width: 23.5em;
			overflow: auto;
			padding: 0 1em;
			padding-left: 42px;
			padding-left: calc(1em + 26px);
			color: black;
			color: var(--tocsidebar-text);
			background: inherit;
			background-color: #f7f8f9;
			background-color: var(--tocsidebar-bg);
			z-index: 1;
			box-shadow: -.1em 0 .25em rgba(0,0,0,.1) inset;
			box-shadow: -.1em 0 .25em var(--tocsidebar-shadow) inset;
		}
		body:not(.toc-inline) #toc h2 {
			margin-top: .8rem;
			font-variant: small-caps;
			font-variant: all-small-caps;
			text-transform: lowercase;
			font-weight: bold;
			color: gray;
			color: hsla(203,20%,40%,.7);
			color: var(--tocsidebar-heading-text);
		}

		body:not(.toc-inline) {
			padding-left: 29em;
		}
		/* See also Overflow section at the bottom */

		body:not(.toc-inline) #toc-jump:not(:focus) {
			width: 0;
			height: 0;
			padding: 0;
			position: absolute;
			overflow: hidden;
		}
	}
	@media screen and (min-width: 90em) {
		body:not(.toc-inline) {
			margin: 0 4em;
		}
	}

/******************************************************************************/
/*                                Sectioning                                  */
/******************************************************************************/

/** Headings ******************************************************************/

	h1, h2, h3, h4, h5, h6, dt {
		page-break-after: avoid;
		page-break-inside: avoid;
		font: 100% sans-serif;   /* Reset all font styling to clear out UA styles */
		font-family: inherit;	/* Inherit the font family. */
		line-height: 1.2;		/* Keep wrapped headings compact */
		hyphens: manual;		/* Hyphenated headings look weird */
	}

	h2, h3, h4, h5, h6 {
		margin-top: 3rem;
	}

	h1, h2, h3 {
		color: #005A9C;
		color: var(--heading-text);
	}

	h1 { font-size: 170%; }
	h2 { font-size: 140%; }
	h3 { font-size: 120%; }
	h4 { font-weight: bold; }
	h5 { font-style: italic; }
	h6 { font-variant: small-caps; }
	dt { font-weight: bold; }

/** Subheadings ***************************************************************/

	h1 + h2,
	#profile-and-date {
		/* #profile-and-date is a subtitle in an H2 under the H1 */
		margin-top: 0;
	}
	h2 + h3,
	h3 + h4,
	h4 + h5,
	h5 + h6 {
		margin-top: 1.2em; /* = 1 x line-height */
	}

/** Section divider ***********************************************************/

	:not(.head) > :not(.head) + hr {
		font-size: 1.5em;
		text-align: center;
		margin: 1em auto;
		height: auto;
		color: black;
		color: var(--hr-text);
		border: transparent solid 0;
		background: transparent;
	}
	:not(.head) > hr::before {
		content: "\2727\2003\2003\2727\2003\2003\2727";
	}

/******************************************************************************/
/*                            Paragraphs and Lists                            */
/******************************************************************************/

	p {
		margin: 1em 0;
	}

	dd > p:first-child,
	li > p:first-child {
		margin-top: 0;
	}

	ul, ol {
		margin-left: 0;
		padding-left: 2em;
	}

	li {
		margin: 0.25em 0 0.5em;
		padding: 0;
	}

	dl dd {
		margin: 0 0 .5em 2em;
	}

	.head dd + dd { /* compact for header */
		margin-top: -.5em;
	}

	/* Style for algorithms */
	ol.algorithm ol:not(.algorithm),
	.algorithm > ol ol:not(.algorithm) {
	border-left: 0.5em solid #DEF;
	border-left: 0.5em solid var(--algo-border);
	}

	/* Put nice boxes around each algorithm. */
	[data-algorithm]:not(.heading) {
	 padding: .5em;
	 border: thin solid #ddd;
	 border: thin solid var(--algo-border);
	 border-radius: .5em;
	 margin: .5em calc(-0.5em - 1px);
	}
	[data-algorithm]:not(.heading) > :first-child {
	 margin-top: 0;
	}
	[data-algorithm]:not(.heading) > :last-child {
	 margin-bottom: 0;
	}

	/* Style for switch/case <dl>s */
	dl.switch > dd > ol.only,
	dl.switch > dd > .only > ol {
	margin-left: 0;
	}
	dl.switch > dd > ol.algorithm,
	dl.switch > dd > .algorithm > ol {
	margin-left: -2em;
	}
	dl.switch {
	padding-left: 2em;
	}
	dl.switch > dt {
	text-indent: -1.5em;
	margin-top: 1em;
	}
	dl.switch > dt + dt {
	margin-top: 0;
	}
	dl.switch > dt::before {
	content: '\21AA';
	padding: 0 0.5em 0 0;
	display: inline-block;
	width: 1em;
	text-align: right;
	line-height: 0.5em;
	}

/** Terminology Markup ********************************************************/


/******************************************************************************/
/*                                 Inline Markup                              */
/******************************************************************************/

/** Terminology Markup ********************************************************/
	dfn   { /* Defining instance */
		font-weight: bolder;
	}
	a > i { /* Instance of term */
		font-style: normal;
	}
	dt dfn code, code.idl {
		font-size: inherit;
	}
	dfn var {
		font-style: normal;
	}

/** Change Marking ************************************************************/

	del {
		color: #aa0000;
		color: var(--del-text);
		background: transparent;
		background: var(--del-bg);
		text-decoration: line-through;
	}
	ins {
		color: #006100;
		color: var(--ins-text);
		background: transparent;
		background: var(--ins-bg);
		text-decoration: underline;
	}

	/* for amendments (candidate/proposed changes) */

	.amendment ins, .correction ins, .addition ins,
	ins[class^=c] {
		text-decoration-style: dotted;
	}
	.amendment del, .correction del, .addition del,
	del[class^=c] {
		text-decoration-style: dotted;
	}
	.amendment.proposed ins, .correction.proposed ins, .addition.proposed ins,
	ins[class^=c].proposed {
		text-decoration-style: double;
	}
	.amendment.proposed del, .correction.proposed del, .addition.proposed del,
	del[class^=c].proposed {
		text-decoration-style: double;
	}

/** Miscellaneous improvements to inline formatting ***************************/

	sup {
		vertical-align: super;
		font-size: 80%
	}

/******************************************************************************/
/*                                    Code                                    */
/******************************************************************************/

/** General monospace/pre rules ***********************************************/

	pre, code, samp {
		font-family: Menlo, Consolas, "DejaVu Sans Mono", Monaco, monospace;
		font-size: .9em;
		hyphens: none;
		text-transform: none;
		text-align: left;
		text-align: start;
		font-variant: normal;
		orphans: 3;
		widows: 3;
		page-break-before: avoid;
	}
	pre code,
	code code {
		font-size: 100%;
	}

	pre {
		margin-top: 1em;
		margin-bottom: 1em;
		overflow: auto;
	}

/** Inline Code fragments *****************************************************/

	/* Do something nice. */

/******************************************************************************/
/*                                    Links                                   */
/******************************************************************************/

/** General Hyperlinks ********************************************************/

	/* We hyperlink a lot, so make it less intrusive */
	a[href] {
		color: #034575;
		color: var(--a-normal-text);
		text-decoration: underline #707070;
		text-decoration: underline var(--a-normal-underline);
		text-decoration-skip-ink: none;
	}
	a:visited {
		color: #034575;
		color: var(--a-visited-text);
		text-decoration-color: #bbb;
		text-decoration-color: var(--a-visited-underline);
	}

	/* Indicate interaction with the link */
	a[href]:focus,
	a[href]:hover {
		text-decoration-thickness: 2px;
	}
	a[href]:active {
		color: #c00;
		color: var(--a-active-text);
		text-decoration-color: #c00;
		text-decoration-color: var(--a-active-underline);
	}

	/* Backout above styling for W3C logo */
	.head .logo,
	.head .logo a {
		border: none;
		text-decoration: none;
		background: transparent;
	}

/******************************************************************************/
/*                                    Images                                  */
/******************************************************************************/

	img {
		border-style: none;
	}

	img, svg {
		/* Intentionally not color-scheme aware. */
		background: white;
	}

	/* For autogen numbers, add
	  .caption::before, figcaption::before { content: "Figure " counter(figure) ". "; }
	*/

	figure, .figure, .sidefigure {
		page-break-inside: avoid;
		text-align: center;
		margin: 2.5em 0;
	}
	.figure img,	.sidefigure img,	figure img,
	.figure object, .sidefigure object, figure object {
		max-width: 100%;
		margin: auto;
		height: auto;
	}
	.figure pre, .sidefigure pre, figure pre {
		text-align: left;
		display: table;
		margin: 1em auto;
	}
	.figure table, figure table {
		margin: auto;
	}
	@media screen and (min-width: 20em) {
		.sidefigure {
			float: right;
			width: 50%;
			margin: 0 0 0.5em 0.5em;
		}
	}
	.caption, figcaption, caption {
		font-style: italic;
		font-size: 90%;
	}
	.caption::before, figcaption::before, figcaption > .marker {
		font-weight: bold;
	}
	.caption, figcaption {
		counter-increment: figure;
	}

	/* DL list is indented 2em, but figure inside it is not */
	dd > .figure, dd > figure { margin-left: -2em; }

/******************************************************************************/
/*                             Colored Boxes                                  */
/******************************************************************************/

	.issue, .note, .example, .assertion, .advisement, blockquote,
	.amendment, .correction, .addition {
		margin: 1em auto;
		padding: .5em;
		border: .5em;
		border-left-style: solid;
		page-break-inside: avoid;
	}
	span.issue, span.note {
		padding: .1em .5em .15em;
		border-right-style: solid;
	}

	blockquote > :first-child,
	.note  > p:first-child,
	.issue > p:first-child,
	.amendment > p:first-child,
	.correction > p:first-child,
	.addition > p:first-child {
		margin-top: 0;
	}
	blockquote > :last-child,
	.note  > p:last-child,
	.issue > p:last-child,
	.amendment > p:last-child,
	.correction > p:last-child,
	.addition > p:last-child {
		margin-bottom: 0;
	}


	.issue::before, .issue > .marker,
	.example::before, .example > .marker,
	.note::before, .note > .marker,
	details.note > summary > .marker,
	.amendment::before, .amendment > .marker,
	details.amendment > summary > .marker,
	.addition::before, .addition > .marker,
	addition.amendment > summary > .marker,
	.correction::before, .correction > .marker,
	correction.amendment > summary > .marker
	{
		text-transform: uppercase;
		padding-right: 1em;
	}

	.example::before, .example > .marker {
		display: block;
		padding-right: 0em;
	}

/** Blockquotes ***************************************************************/

	blockquote {
		border-color: silver;
		border-color: var(--blockquote-border);
		background: transparent;
		background: var(--blockquote-bg);
		color: currentcolor;
		color: var(--blockquote-text);
	}

/** Open issue ****************************************************************/

	.issue {
		border-color: #e05252;
		border-color: var(--issue-border);
		background: #fbe9e9;
		background: var(--issue-bg);
		color: black;
		color: var(--issue-text);
		counter-increment: issue;
		overflow: auto;
	}
	.issue::before, .issue > .marker {
		color: #831616;
		color: var(--issueheading-text);
	}
	/* Add .issue::before { content: "Issue " counter(issue) " "; } for autogen numbers,
	  or use class="marker" to mark up the issue number in source. */

/** Example *******************************************************************/

	.example {
		border-color: #e0cb52;
		border-color: var(--example-border);
		background: #fcfaee;
		background: var(--example-bg);
		color: black;
		color: var(--example-text);
		counter-increment: example;
		overflow: auto;
		clear: both;
	}
	.example::before, .example > .marker {
		color: #574b0f;
		color: var(--exampleheading-text);
	}
	/* Add .example::before { content: "Example " counter(example) " "; } for autogen numbers,
	  or use class="marker" to mark up the example number in source. */

/** Non-normative Note ********************************************************/

	.note {
		border-color: #52e052;
		border-color: var(--note-border);
		background: #e9fbe9;
		background: var(--note-bg);
		color: black;
		color: var(--note-text);
		overflow: auto;
	}

	.note::before, .note > .marker,
	details.note > summary {
		color: hsl(120, 70%, 30%);
		color: var(--noteheading-text);
	}
	/* Add .note::before { content: "Note "; } for autogen label,
	  or use class="marker" to mark up the label in source. */

	details.note[open] > summary {
		border-bottom: 1px silver solid;
		border-bottom: 1px var(--notesummary-underline) solid;
	}

/** Assertion Box *************************************************************/
	/*  for assertions in algorithms */

	.assertion {
		border-color: #AAA;
		border-color: var(--assertion-border);
		background: #EEE;
		background: var(--assertion-bg);
		color: black;
		color: var(--assertion-text);
	}

/** Advisement Box ************************************************************/
	/*  for attention-grabbing normative statements */

	.advisement {
		border-color: orange;
		border-color: var(--advisement-border);
		border-style: none solid;
		background: #fec;
		background: var(--advisement-bg);
		color: black;
		color: var(--advisement-text);
	}
	strong.advisement {
		display: block;
		text-align: center;
	}
	.advisement::before, .advisement > .marker {
		color: #b35f00;
		color: var(--advisementheading-text);
	}

/** Amendment Box *************************************************************/

	.amendment, .correction, .addition {
		border-color: #330099;
		border-color: var(--amendment-border);
		background: #F5F0FF;
		background: var(--amendment-bg);
		color: black;
		color: var(--amendment-text);
	}
	.amendment.proposed, .correction.proposed, .addition.proposed {
		border-style: solid;
		border-block-width: 0.25em;
	}
	.amendment::before, .amendment > .marker,
	details.amendment > summary::before, details.amendment > summary > .marker,
	.correction::before, .correction > .marker,
	details.correction > summary::before, details.correction > summary > .marker,
	.addition::before, .addition > .marker,
	details.addition > summary::before, details.addition > summary > .marker {
		color: #220066;
		color: var(--amendmentheading-text);
	}
	.amendment.proposed::before, .amendment.proposed > .marker,
	details.amendment.proposed > summary::before, details.amendment.proposed > summary > .marker,
	.correction.proposed::before, .correction.proposed > .marker,
	details.correction.proposed > summary::before, details.correction.proposed > summary > .marker,
	.addition.proposed::before, .addition.proposed > .marker,
	details.addition.proposed > summary::before, details.addition.proposed > summary > .marker {
		font-weight: bold;
	}

/** Spec Obsoletion Notice ****************************************************/
	/* obnoxious obsoletion notice for older/abandoned specs. */

	details {
		display: block;
	}
	summary {
		font-weight: bolder;
	}

	.annoying-warning:not(details),
	details.annoying-warning:not([open]) > summary,
	details.annoying-warning[open] {
		background: hsla(40,100%,50%,0.95);
		background: var(--warning-bg);
		color: black;
		color: var(--warning-text);
		padding: .75em 1em;
		border: red;
		border: var(--warning-border);
		border-style: solid none;
		box-shadow: 0 2px 8px black;
		text-align: center;
	}
	.annoying-warning :last-child {
		margin-bottom: 0;
	}

@media not print {
	details.annoying-warning[open] {
		position: fixed;
		left: 0;
		right: 0;
		bottom: 2em;
		z-index: 1000;
	}
}

	details.annoying-warning:not([open]) > summary {
		text-align: center;
	}

/** Entity Definition Boxes ***************************************************/

	.def {
		padding: .5em 1em;
		background: #def;
		background: var(--def-bg);
		margin: 1.2em 0;
		border-left: 0.5em solid #8ccbf2;
		border-left: 0.5em solid var(--def-border);
		color: black;
		color: var(--def-text);
	}

/******************************************************************************/
/*                                    Tables                                  */
/******************************************************************************/

	th, td {
		text-align: left;
		text-align: start;
	}

/** Property/Descriptor Definition Tables *************************************/

	table.def {
		/* inherits .def box styling, see above */
		width: 100%;
		border-spacing: 0;
	}

	table.def td,
	table.def th {
		padding: 0.5em;
		vertical-align: baseline;
		border-bottom: 1px solid #bbd7e9;
		border-bottom: 1px solid var(--defrow-border);
	}

	table.def > tbody > tr:last-child th,
	table.def > tbody > tr:last-child td {
		border-bottom: 0;
	}

	table.def th {
		font-style: italic;
		font-weight: normal;
		padding-left: 1em;
		width: 3em;
	}

	/* For when values are extra-complex and need formatting for readability */
	table td.pre {
		white-space: pre-wrap;
	}

	/* A footnote at the bottom of a def table */
	table.def td.footnote {
		padding-top: 0.6em;
	}
	table.def td.footnote::before {
		content: " ";
		display: block;
		height: 0.6em;
		width: 4em;
		border-top: thin solid;
	}

/** Data tables (and properly marked-up index tables) *************************/
	/*
		<table class="data"> highlights structural relationships in a table
		when correct markup is used (e.g. thead/tbody, th vs. td, scope attribute)

		Use class="complex data" for particularly complicated tables --
		(This will draw more lines: busier, but clearer.)

		Use class="long" on table cells with paragraph-like contents
		(This will adjust text alignment accordingly.)
		Alternately use class="longlastcol" on tables, to have the last column assume "long".
	*/

	table {
		word-wrap: normal;
		overflow-wrap: normal;
		hyphens: manual;
	}

	table.data,
	table.index {
		margin: 1em auto;
		border-collapse: collapse;
		border: hidden;
		width: 100%;
	}
	table.data caption,
	table.index caption {
		max-width: 50em;
		margin: 0 auto 1em;
	}

	table.data td,  table.data th,
	table.index td, table.index th {
		padding: 0.5em 1em;
		border-width: 1px;
		border-color: silver;
		border-color: var(--datacell-border);
		border-top-style: solid;
	}

	table.data thead td:empty {
		padding: 0;
		border: 0;
	}

	table.data  thead,
	table.index thead,
	table.data  tbody,
	table.index tbody {
		border-bottom: 2px solid;
	}

	table.data colgroup,
	table.index colgroup {
		border-left: 2px solid;
	}

	table.data  tbody th:first-child,
	table.index tbody th:first-child  {
		border-right: 2px solid;
		border-top: 1px solid silver;
		border-top: 1px solid var(--datacell-border);
		padding-right: 1em;
	}

	table.data th[colspan],
	table.data td[colspan] {
		text-align: center;
	}

	table.complex.data th,
	table.complex.data td {
		border: 1px solid silver;
		border: 1px solid var(--datacell-border);
		text-align: center;
	}

	table.data.longlastcol td:last-child,
	table.data td.long {
		vertical-align: baseline;
		text-align: left;
	}

	table.data img {
		vertical-align: middle;
	}


/*
Alternate table alignment rules

	table.data,
	table.index {
		text-align: center;
	}

	table.data  thead th[scope="row"],
	table.index thead th[scope="row"] {
		text-align: right;
	}

	table.data  tbody th:first-child,
	table.index tbody th:first-child  {
		text-align: right;
	}

Possible extra rowspan handling

	table.data  tbody th[rowspan]:not([rowspan='1']),
	table.index tbody th[rowspan]:not([rowspan='1']),
	table.data  tbody td[rowspan]:not([rowspan='1']),
	table.index tbody td[rowspan]:not([rowspan='1']) {
		border-left: 1px solid silver;
	}

	table.data  tbody th[rowspan]:first-child,
	table.index tbody th[rowspan]:first-child,
	table.data  tbody td[rowspan]:first-child,
	table.index tbody td[rowspan]:first-child{
		border-left: 0;
		border-right: 1px solid silver;
	}
*/

/******************************************************************************/
/*                                  Indices                                   */
/******************************************************************************/


/** Table of Contents *********************************************************/

	.toc a {
		/* More spacing; use padding to make it part of the click target. */
		padding: 0.1rem 1px 0;
		/* Larger, more consistently-sized click target */
		display: block;
		/* Switch to using border-bottom for underlines */
		text-decoration: none;
		border-bottom: 1px solid;
		/* Reverse color scheme */
		color: black;
		color: var(--toclink-text);
		border-color: #3980b5;
		border-color: var(--toclink-underline);
	}
	.toc a:visited {
		color: black;
		color: var(--toclink-visited-text);
		border-color: #054572;
		border-color: var(--toclink-visited-underline);
	}
	.toc a:focus,
	.toc a:hover {
		background: rgba(75%, 75%, 75%, .25);
		background: var(--a-hover-bg);
		border-bottom-width: 3px;
		margin-bottom: -2px;
	}
	.toc a:not(:focus):not(:hover) {
		/* Allow colors to cascade through from link styling */
		border-bottom-color: transparent;
	}

	.toc, .toc ol, .toc ul, .toc li {
		list-style: none; /* Numbers must be inlined into source */
		/* because generated content isn't search/selectable and markers can't do multilevel yet */
		margin:  0;
		padding: 0;
	}
	.toc {
		line-height: 1.1em;
	}

	/* ToC not indented until third level, but font style & margins show hierarchy */
	.toc > li			{ font-weight: bold;   }
	.toc > li li		 { font-weight: normal; }
	.toc > li li li	  { font-size:   95%;	}
	.toc > li li li li	{ font-size:   90%;	}
	.toc > li li li li li { font-size:   85%;	}

	/* @supports not (display:grid) { */
		.toc > li			{ margin: 1.5rem 0;	}
		.toc > li li		 { margin: 0.3rem 0;	}
		.toc > li li li	  { margin-left: 2rem;   }

		/* Section numbers in a column of their own */
		.toc .secno {
			float: left;
			width: 4rem;
			white-space: nowrap;
		}
		.toc > li li li li .secno { font-size: 85%; }
		.toc > li li li li li .secno { font-size: 100%; }

		.toc li {
			clear: both;
		}

		:not(li) > .toc			 { margin-left:  5rem; }
		.toc .secno				 { margin-left: -5rem; }
		.toc > li li li .secno	  { margin-left: -7rem; }
		.toc > li li li li .secno	{ margin-left: -9rem; }
		.toc > li li li li li .secno { margin-left: -11rem; }

		/* Tighten up indentation in narrow ToCs */
		@media (max-width: 30em) {
			:not(li) > .toc			 { margin-left:  4rem; }
			.toc .secno				 { margin-left: -4rem; }
			.toc > li li li			 { margin-left:  1rem; }
			.toc > li li li .secno	  { margin-left: -5rem; }
			.toc > li li li li .secno	{ margin-left: -6rem; }
			.toc > li li li li li .secno { margin-left: -7rem; }
		}
		/* Loosen it on wide screens */
		@media screen and (min-width: 78em) {
			body:not(.toc-inline) :not(li) > .toc			 { margin-left:  4rem; }
			body:not(.toc-inline) .toc .secno				 { margin-left: -4rem; }
			body:not(.toc-inline) .toc > li li li			 { margin-left:  1rem; }
			body:not(.toc-inline) .toc > li li li .secno	  { margin-left: -5rem; }
			body:not(.toc-inline) .toc > li li li li .secno	{ margin-left: -6rem; }
			body:not(.toc-inline) .toc > li li li li li .secno { margin-left: -7rem; }
	}
	/* } */

	@supports (display:grid) and (display:contents) {
		/* Use #toc over .toc to override non-@supports rules. */
		#toc {
			display: grid;
			align-content: start;
			grid-template-columns: auto 1fr;
			grid-column-gap: 1rem;
			column-gap: 1rem;
			grid-row-gap: .6rem;
			row-gap: .6rem;
		}
		#toc h2 {
			grid-column: 1 / -1;
			margin-bottom: 0;
		}
		#toc ol,
		#toc li,
		#toc a {
			display: contents;
			/* Switch <a> to subgrid when supported */
		}
		#toc span {
			margin: 0;
		}
		#toc > .toc > li > a > span {
			/* The spans of the top-level list,
			  comprising the first items of each top-level section. */
			margin-top: 1.1rem;
		}
		#toc#toc .secno { /* Ugh, need more specificity to override base.css */
			grid-column: 1;
			width: auto;
			margin-left: 0;
		}
		#toc .content {
			grid-column: 2;
			width: auto;
			margin-right: 1rem;
			border-bottom: 3px solid transparent;
			margin-bottom: -3px;
		}
		#toc .content:hover,
		#toc .content:focus {
			background: rgba(75%, 75%, 75%, .25);
			background: var(--a-hover-bg);
			border-bottom-color: #054572;
			border-bottom-color: var(--toclink-underline);
		}
		#toc li li li .content {
			margin-left: 1rem;
		}
		#toc li li li li .content {
			margin-left: 2rem;
		}
	}


/** Index *********************************************************************/

	/* Index Lists: Layout */
	ul.index	  { margin-left: 0; columns: 15em; text-indent: 1em hanging; }
	ul.index li	{ margin-left: 0; list-style: none; break-inside: avoid; }
	ul.index li li { margin-left: 1em; }
	ul.index dl	{ margin-top: 0; }
	ul.index dt	{ margin: .2em 0 .2em 20px;}
	ul.index dd	{ margin: .2em 0 .2em 40px;}
	/* Index Lists: Typography */
	ul.index ul,
	ul.index dl { font-size: smaller; }
	@media not print {
		ul.index li a + span {
			white-space: nowrap;
			color: transparent; }
		ul.index li a:hover + span,
		ul.index li a:focus + span {
			color: #707070;
			color: var(--indexinfo-text);
		}
	}

/** Index Tables *****************************************************/
	/* See also the data table styling section, which this effectively subclasses */

	table.index {
		font-size: small;
		border-collapse: collapse;
		border-spacing: 0;
		text-align: left;
		margin: 1em 0;
	}

	table.index td,
	table.index th {
		padding: 0.4em;
	}

	table.index tr:hover td:not([rowspan]),
	table.index tr:hover th:not([rowspan]) {
		color: black;
		color: var(--indextable-hover-text);
		background: #f7f8f9;
		background: var(--indextable-hover-bg);
	}

	/* The link in the first column in the property table (formerly a TD) */
	table.index th:first-child a {
		font-weight: bold;
	}

/** Outdated warning **********************************************************/

.outdated-spec {
	color: black;
	color: var(--outdatedspec-text);
	background-color: rgba(0,0,0,0.5);
	background-color: var(--outdatedspec-bg);
}

.outdated-warning {
	position: fixed;
	bottom: 50%;
	left: 0;
	right: 0;
	margin: 0 auto;
	width: 50%;
	background: maroon;
	background: var(--outdated-bg);
	color: white;
	color: var(--outdated-text);
	border-radius: 1em;
	box-shadow: 0 0 1em red;
	box-shadow: 0 0 1em var(--outdated-shadow);
	padding: 2em;
	text-align: center;
	z-index: 2;
}

.outdated-warning a {
	color: currentcolor;
	background: transparent;
}

.edited-rec-warning {
	background: darkorange;
	background: var(--editedrec-bg);
	box-shadow: 0 0 1em;
}

.outdated-warning button {
	color: var(--outdated-text);
	border-radius: 1em;
	box-shadow: 0 0 1em red;
	box-shadow: 0 0 1em var(--outdated-shadow);
	padding: 2em;
	text-align: center;
	z-index: 2;
}

.outdated-warning a {
	color: currentcolor;
	background: transparent;
}

.edited-rec-warning {
	background: darkorange;
	background: var(--editedrec-bg);
	box-shadow: 0 0 1em;
}

.outdated-warning button {
	position: absolute;
	top: 0;
	right:0;
	margin: 0;
	border: 0;
	padding: 0.25em 0.5em;
	background: transparent;
	color: white;
	color: var(--outdated-text);
	font:1em sans-serif;
	text-align:center;
}

.outdated-warning span {
	display: block;
}

.outdated-collapsed {
	bottom: 0;
	border-radius: 0;
	width: 100%;
	padding: 0;
}

/******************************************************************************/
/*                                    Print                                   */
/******************************************************************************/

	@media print {
		/* Pages have their own margins. */
		html {
			margin: 0;
		}
		/* Serif for print. */
		body {
			font-family: serif;
		}

		.outdated-warning {
			position: absolute;
			border-style: solid;
			border-color: red;
		}

		.outdated-warning input {
			display: none;
		}
	}
	@page {
		margin: 1.5cm 1.1cm;
	}



/******************************************************************************/
/*                             Overflow Control                               */
/******************************************************************************/

	.figure .caption, .sidefigure .caption, figcaption {
		/* in case figure is overlarge, limit caption to 50em */
		max-width: 50rem;
		margin-left: auto;
		margin-right: auto;
	}
	.overlarge {
		/* Magic to create good item positioning:
		  "content column" is 50ems wide at max; less on smaller screens.
		  Extra space (after ToC + content) is empty on the right.

		  1. When item < content column, centers item in column.
		  2. When content < item < available, left-aligns.
		  3. When item > available, fills available + scroll bar.
		*/
		display: grid;
		grid-template-columns: minmax(0, 50em);
	}
	.overlarge > table {
		/* limit preferred width of table */
		max-width: 50em;
		margin-left: auto;
		margin-right: auto;
	}

	@media (min-width: 55em) {
		.overlarge {
			margin-right: calc(13px + 26.5rem - 50vw);
			max-width: none;
		}
	}
	@media screen and (min-width: 78em) {
		body:not(.toc-inline) .overlarge {
			/* 30.5em body padding 50em content area */
			margin-right: calc(40em - 50vw) !important;
		}
	}
	@media screen and (min-width: 90em) {
		body:not(.toc-inline) .overlarge {
			/* 4em html margin 30.5em body padding 50em content area */
			margin-right: calc(84.5em - 100vw) !important;
		}
	}

	@media not print {
		.overlarge {
			overflow-x: auto;
			/* See Lea Verou's explanation background-attachment:
			* http://lea.verou.me/2012/04/background-attachment-local/
			*
			background: top left  / 4em 100% linear-gradient(to right,  #ffffff, rgba(255, 255, 255, 0)) local,
						top right / 4em 100% linear-gradient(to left, #ffffff, rgba(255, 255, 255, 0)) local,
						top left  / 1em 100% linear-gradient(to right,  #c3c3c5, rgba(195, 195, 197, 0)) scroll,
						top right / 1em 100% linear-gradient(to left, #c3c3c5, rgba(195, 195, 197, 0)) scroll,
						white;
			background-repeat: no-repeat;
			*/
		}
	}
</style>
  <meta content="Bikeshed version 0ef803fdf, updated Tue Jan 6 11:59:39 2026 -0800" name="generator">
  <link href="_ORCHESTRATOR_CURRENT_BUILD_FULL_LINK_" rel="canonical">
  <meta content="dark light" name="color-scheme">
<style>/* Boilerplate: style-autolinks */
.css.css, .property.property, .descriptor.descriptor {
    color: var(--a-normal-text);
    font-size: inherit;
    font-family: inherit;
}
.css::before, .property::before, .descriptor::before {
    content: "‘";
}
.css::after, .property::after, .descriptor::after {
    content: "’";
}
.property, .descriptor {
    /* Don't wrap property and descriptor names */
    white-space: nowrap;
}
.type { /* CSS value <type> */
    font-style: italic;
}
pre .property::before, pre .property::after {
    content: "";
}
[data-link-type="property"]::before,
[data-link-type="propdesc"]::before,
[data-link-type="descriptor"]::before,
[data-link-type="value"]::before,
[data-link-type="function"]::before,
[data-link-type="at-rule"]::before,
[data-link-type="selector"]::before,
[data-link-type="maybe"]::before {
    content: "‘";
}
[data-link-type="property"]::after,
[data-link-type="propdesc"]::after,
[data-link-type="descriptor"]::after,
[data-link-type="value"]::after,
[data-link-type="function"]::after,
[data-link-type="at-rule"]::after,
[data-link-type="selector"]::after,
[data-link-type="maybe"]::after {
    content: "’";
}

[data-link-type].production::before,
[data-link-type].production::after,
.prod [data-link-type]::before,
.prod [data-link-type]::after {
    content: "";
}

[data-link-type=element],
[data-link-type=element-attr] {
    font-family: Menlo, Consolas, "DejaVu Sans Mono", monospace;
    font-size: .9em;
}
[data-link-type=element]::before { content: "<" }
[data-link-type=element]::after  { content: ">" }

[data-link-type=biblio] {
    white-space: pre;
}

@media (prefers-color-scheme: dark) {
    :root {
        --selflink-text: black;
        --selflink-bg: silver;
        --selflink-hover-text: white;
    }
}
</style>
<style>/* Boilerplate: style-colors */
/* Any --*-text not paired with a --*-bg is assumed to have a transparent bg */
:root {
    color-scheme: light dark;

    --text: black;
    --bg: white;

    --unofficial-watermark: url(https://www.w3.org/StyleSheets/TR/2016/logos/UD-watermark);

    --logo-bg: #1a5e9a;
    --logo-active-bg: #c00;
    --logo-text: white;

    --tocnav-normal-text: #707070;
    --tocnav-normal-bg: var(--bg);
    --tocnav-hover-text: var(--tocnav-normal-text);
    --tocnav-hover-bg: #f8f8f8;
    --tocnav-active-text: #c00;
    --tocnav-active-bg: var(--tocnav-normal-bg);

    --tocsidebar-text: var(--text);
    --tocsidebar-bg: #f7f8f9;
    --tocsidebar-shadow: rgba(0,0,0,.1);
    --tocsidebar-heading-text: hsla(203,20%,40%,.7);

    --toclink-text: var(--text);
    --toclink-underline: #3980b5;
    --toclink-visited-text: var(--toclink-text);
    --toclink-visited-underline: #054572;

    --heading-text: #005a9c;

    --hr-text: var(--text);

    --algo-border: #def;

    --del-text: red;
    --del-bg: transparent;
    --ins-text: #080;
    --ins-bg: transparent;

    --a-normal-text: #034575;
    --a-normal-underline: #bbb;
    --a-visited-text: var(--a-normal-text);
    --a-visited-underline: #707070;
    --a-hover-bg: rgba(75%, 75%, 75%, .25);
    --a-active-text: #c00;
    --a-active-underline: #c00;

    --blockquote-border: silver;
    --blockquote-bg: transparent;
    --blockquote-text: currentcolor;

    --issue-border: #e05252;
    --issue-bg: #fbe9e9;
    --issue-text: var(--text);
    --issueheading-text: #831616;

    --example-border: #e0cb52;
    --example-bg: #fcfaee;
    --example-text: var(--text);
    --exampleheading-text: #574b0f;

    --note-border: #52e052;
    --note-bg: #e9fbe9;
    --note-text: var(--text);
    --noteheading-text: hsl(120, 70%, 30%);
    --notesummary-underline: silver;

    --assertion-border: #aaa;
    --assertion-bg: #eee;
    --assertion-text: black;

    --advisement-border: orange;
    --advisement-bg: #fec;
    --advisement-text: var(--text);
    --advisementheading-text: #b35f00;

    --warning-border: red;
    --warning-bg: hsla(40,100%,50%,0.95);
    --warning-text: var(--text);

    --amendment-border: #330099;
    --amendment-bg: #F5F0FF;
    --amendment-text: var(--text);
    --amendmentheading-text: #220066;

    --def-border: #8ccbf2;
    --def-bg: #def;
    --def-text: var(--text);
    --defrow-border: #bbd7e9;

    --datacell-border: silver;

    --indexinfo-text: #707070;

    --indextable-hover-text: black;
    --indextable-hover-bg: #f7f8f9;

    --outdatedspec-bg: rgba(0, 0, 0, .5);
    --outdatedspec-text: black;
    --outdated-bg: maroon;
    --outdated-text: white;
    --outdated-shadow: red;

    --editedrec-bg: darkorange;
}

@media (prefers-color-scheme: dark) {
    :root {
        --text: #ddd;
        --bg: black;

        --unofficial-watermark: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='400' height='400'%3E%3Cg fill='%23100808' transform='translate(200 200) rotate(-45) translate(-200 -200)' stroke='%23100808' stroke-width='3'%3E%3Ctext x='50%25' y='220' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EUNOFFICIAL%3C/text%3E%3Ctext x='50%25' y='305' style='font: bold 70px sans-serif; text-anchor: middle; letter-spacing: 6px;'%3EDRAFT%3C/text%3E%3C/g%3E%3C/svg%3E");

        --logo-bg: #1a5e9a;
        --logo-active-bg: #c00;
        --logo-text: white;

        --tocnav-normal-text: #999;
        --tocnav-normal-bg: var(--bg);
        --tocnav-hover-text: var(--tocnav-normal-text);
        --tocnav-hover-bg: #080808;
        --tocnav-active-text: #f44;
        --tocnav-active-bg: var(--tocnav-normal-bg);

        --tocsidebar-text: var(--text);
        --tocsidebar-bg: #080808;
        --tocsidebar-shadow: rgba(255,255,255,.1);
        --tocsidebar-heading-text: hsla(203,20%,40%,.7);

        --toclink-text: var(--text);
        --toclink-underline: #6af;
        --toclink-visited-text: var(--toclink-text);
        --toclink-visited-underline: #054572;

        --heading-text: #8af;

        --hr-text: var(--text);

        --algo-border: #456;

        --del-text: #f44;
        --del-bg: transparent;
        --ins-text: #4a4;
        --ins-bg: transparent;

        --a-normal-text: #6af;
        --a-normal-underline: #555;
        --a-visited-text: var(--a-normal-text);
        --a-visited-underline: var(--a-normal-underline);
        --a-hover-bg: rgba(25%, 25%, 25%, .2);
        --a-active-text: #f44;
        --a-active-underline: var(--a-active-text);

        --borderedblock-bg: rgba(255, 255, 255, .05);

        --blockquote-border: silver;
        --blockquote-bg: var(--borderedblock-bg);
        --blockquote-text: currentcolor;

        --issue-border: #e05252;
        --issue-bg: var(--borderedblock-bg);
        --issue-text: var(--text);
        --issueheading-text: hsl(0deg, 70%, 70%);

        --example-border: hsl(50deg, 90%, 60%);
        --example-bg: var(--borderedblock-bg);
        --example-text: var(--text);
        --exampleheading-text: hsl(50deg, 70%, 70%);

        --note-border: hsl(120deg, 100%, 35%);
        --note-bg: var(--borderedblock-bg);
        --note-text: var(--text);
        --noteheading-text: hsl(120, 70%, 70%);
        --notesummary-underline: silver;

        --assertion-border: #444;
        --assertion-bg: var(--borderedblock-bg);
        --assertion-text: var(--text);

        --advisement-border: orange;
        --advisement-bg: #222218;
        --advisement-text: var(--text);
        --advisementheading-text: #f84;

        --warning-border: red;
        --warning-bg: hsla(40,100%,20%,0.95);
        --warning-text: var(--text);

        --amendment-border: #330099;
        --amendment-bg: #080010;
        --amendment-text: var(--text);
        --amendmentheading-text: #cc00ff;

        --def-border: #8ccbf2;
        --def-bg: #080818;
        --def-text: var(--text);
        --defrow-border: #136;

        --datacell-border: silver;

        --indexinfo-text: #aaa;

        --indextable-hover-text: var(--text);
        --indextable-hover-bg: #181818;

        --outdatedspec-bg: rgba(255, 255, 255, .5);
        --outdatedspec-text: black;
        --outdated-bg: maroon;
        --outdated-text: white;
        --outdated-shadow: red;

        --editedrec-bg: darkorange;
    }
    /* In case a transparent-bg image doesn't expect to be on a dark bg,
       which is quite common in practice... */
    img { background: white; }
}
</style>
<style>/* Boilerplate: style-counters */
body {
    counter-reset: example figure issue;
}
.issue {
    counter-increment: issue;
}
.issue:not(.no-marker)::before {
    content: "Issue " counter(issue);
}

.example {
    counter-increment: example;
}
.example:not(.no-marker)::before {
    content: "Example " counter(example);
}
.invalid.example:not(.no-marker)::before,
.illegal.example:not(.no-marker)::before {
    content: "Invalid Example " counter(example);
}

figcaption {
    counter-increment: figure;
}
figcaption:not(.no-marker)::before {
    content: "Figure " counter(figure) " ";
}
</style>
<style>/* Boilerplate: style-issues */
a[href].issue-return {
    float: right;
    float: inline-end;
    color: var(--issueheading-text);
    font-weight: bold;
    text-decoration: none;
}
</style>
<style>/* Boilerplate: style-md-lists */
/* This is a weird hack for me not yet following the commonmark spec
   regarding paragraph and lists. */
[data-md] > :first-child {
    margin-top: 0;
}
[data-md] > :last-child {
    margin-bottom: 0;
}
</style>
<style>/* Boilerplate: style-selflinks */
:root {
    --selflink-text: white;
    --selflink-bg: gray;
    --selflink-hover-text: black;
}
.heading, .issue, .note, .example, li, dt {
    position: relative;
}
a.self-link {
    position: absolute;
    top: 0;
    left: calc(-1 * (3.5rem - 26px));
    width: calc(3.5rem - 26px);
    height: 2em;
    text-align: center;
    border: none;
    transition: opacity .2s;
    opacity: .5;
}
a.self-link:hover {
    opacity: 1;
}
.heading > a.self-link {
    font-size: 83%;
}
.example > a.self-link,
.note > a.self-link,
.issue > a.self-link {
    /* These blocks are overflow:auto, so positioning outside
       doesn't work. */
    left: auto;
    right: 0;
}
li > a.self-link {
    left: calc(-1 * (3.5rem - 26px) - 2em);
}
dfn > a.self-link {
    top: auto;
    left: auto;
    opacity: 0;
    width: 1.5em;
    height: 1.5em;
    background: var(--selflink-bg);
    color: var(--selflink-text);
    font-style: normal;
    transition: opacity .2s, background-color .2s, color .2s;
}
dfn:hover > a.self-link {
    opacity: 1;
}
dfn > a.self-link:hover {
    color: var(--selflink-hover-text);
}

a.self-link::before            { content: "¶"; }
.heading > a.self-link::before { content: "§"; }
dfn > a.self-link::before      { content: "#"; }
</style>
<style>/* Boilerplate: style-syntax-highlighting */
code.highlight { padding: .1em; border-radius: .3em; }
pre.highlight, pre > code.highlight { display: block; padding: 1em; margin: .5em 0; overflow: auto; border-radius: 0; }

.highlight:not(.idl) { background: rgba(0, 0, 0, .03); }
c-[a] { color: #990055 } /* Keyword.Declaration */
c-[b] { color: #990055 } /* Keyword.Type */
c-[c] { color: #708090 } /* Comment */
c-[d] { color: #708090 } /* Comment.Multiline */
c-[e] { color: #0077aa } /* Name.Attribute */
c-[f] { color: #669900 } /* Name.Tag */
c-[g] { color: #222222 } /* Name.Variable */
c-[k] { color: #990055 } /* Keyword */
c-[l] { color: #000000 } /* Literal */
c-[m] { color: #000000 } /* Literal.Number */
c-[n] { color: #0077aa } /* Name */
c-[o] { color: #999999 } /* Operator */
c-[p] { color: #999999 } /* Punctuation */
c-[s] { color: #a67f59 } /* Literal.String */
c-[t] { color: #a67f59 } /* Literal.String.Single */
c-[u] { color: #a67f59 } /* Literal.String.Double */
c-[cp] { color: #708090 } /* Comment.Preproc */
c-[c1] { color: #708090 } /* Comment.Single */
c-[cs] { color: #708090 } /* Comment.Special */
c-[kc] { color: #990055 } /* Keyword.Constant */
c-[kn] { color: #990055 } /* Keyword.Namespace */
c-[kp] { color: #990055 } /* Keyword.Pseudo */
c-[kr] { color: #990055 } /* Keyword.Reserved */
c-[ld] { color: #000000 } /* Literal.Date */
c-[nc] { color: #0077aa } /* Name.Class */
c-[no] { color: #0077aa } /* Name.Constant */
c-[nd] { color: #0077aa } /* Name.Decorator */
c-[ni] { color: #0077aa } /* Name.Entity */
c-[ne] { color: #0077aa } /* Name.Exception */
c-[nf] { color: #0077aa } /* Name.Function */
c-[nl] { color: #0077aa } /* Name.Label */
c-[nn] { color: #0077aa } /* Name.Namespace */
c-[py] { color: #0077aa } /* Name.Property */
c-[ow] { color: #999999 } /* Operator.Word */
c-[mb] { color: #000000 } /* Literal.Number.Bin */
c-[mf] { color: #000000 } /* Literal.Number.Float */
c-[mh] { color: #000000 } /* Literal.Number.Hex */
c-[mi] { color: #000000 } /* Literal.Number.Integer */
c-[mo] { color: #000000 } /* Literal.Number.Oct */
c-[sb] { color: #a67f59 } /* Literal.String.Backtick */
c-[sc] { color: #a67f59 } /* Literal.String.Char */
c-[sd] { color: #a67f59 } /* Literal.String.Doc */
c-[se] { color: #a67f59 } /* Literal.String.Escape */
c-[sh] { color: #a67f59 } /* Literal.String.Heredoc */
c-[si] { color: #a67f59 } /* Literal.String.Interpol */
c-[sx] { color: #a67f59 } /* Literal.String.Other */
c-[sr] { color: #a67f59 } /* Literal.String.Regex */
c-[ss] { color: #a67f59 } /* Literal.String.Symbol */
c-[vc] { color: #0077aa } /* Name.Variable.Class */
c-[vg] { color: #0077aa } /* Name.Variable.Global */
c-[vi] { color: #0077aa } /* Name.Variable.Instance */
c-[il] { color: #000000 } /* Literal.Number.Integer.Long */

@media (prefers-color-scheme: dark) {
    .highlight:not(.idl) { background: rgba(255, 255, 255, .05); }

    c-[a] { color: #d33682 } /* Keyword.Declaration */
    c-[b] { color: #d33682 } /* Keyword.Type */
    c-[c] { color: #2aa198 } /* Comment */
    c-[d] { color: #2aa198 } /* Comment.Multiline */
    c-[e] { color: #268bd2 } /* Name.Attribute */
    c-[f] { color: #b58900 } /* Name.Tag */
    c-[g] { color: #cb4b16 } /* Name.Variable */
    c-[k] { color: #d33682 } /* Keyword */
    c-[l] { color: #657b83 } /* Literal */
    c-[m] { color: #657b83 } /* Literal.Number */
    c-[n] { color: #268bd2 } /* Name */
    c-[o] { color: #657b83 } /* Operator */
    c-[p] { color: #657b83 } /* Punctuation */
    c-[s] { color: #6c71c4 } /* Literal.String */
    c-[t] { color: #6c71c4 } /* Literal.String.Single */
    c-[u] { color: #6c71c4 } /* Literal.String.Double */
    c-[ch] { color: #2aa198 } /* Comment.Hashbang */
    c-[cp] { color: #2aa198 } /* Comment.Preproc */
    c-[cpf] { color: #2aa198 } /* Comment.PreprocFile */
    c-[c1] { color: #2aa198 } /* Comment.Single */
    c-[cs] { color: #2aa198 } /* Comment.Special */
    c-[kc] { color: #d33682 } /* Keyword.Constant */
    c-[kn] { color: #d33682 } /* Keyword.Namespace */
    c-[kp] { color: #d33682 } /* Keyword.Pseudo */
    c-[kr] { color: #d33682 } /* Keyword.Reserved */
    c-[ld] { color: #657b83 } /* Literal.Date */
    c-[nc] { color: #268bd2 } /* Name.Class */
    c-[no] { color: #268bd2 } /* Name.Constant */
    c-[nd] { color: #268bd2 } /* Name.Decorator */
    c-[ni] { color: #268bd2 } /* Name.Entity */
    c-[ne] { color: #268bd2 } /* Name.Exception */
    c-[nf] { color: #268bd2 } /* Name.Function */
    c-[nl] { color: #268bd2 } /* Name.Label */
    c-[nn] { color: #268bd2 } /* Name.Namespace */
    c-[py] { color: #268bd2 } /* Name.Property */
    c-[ow] { color: #657b83 } /* Operator.Word */
    c-[mb] { color: #657b83 } /* Literal.Number.Bin */
    c-[mf] { color: #657b83 } /* Literal.Number.Float */
    c-[mh] { color: #657b83 } /* Literal.Number.Hex */
    c-[mi] { color: #657b83 } /* Literal.Number.Integer */
    c-[mo] { color: #657b83 } /* Literal.Number.Oct */
    c-[sa] { color: #6c71c4 } /* Literal.String.Affix */
    c-[sb] { color: #6c71c4 } /* Literal.String.Backtick */
    c-[sc] { color: #6c71c4 } /* Literal.String.Char */
    c-[dl] { color: #6c71c4 } /* Literal.String.Delimiter */
    c-[sd] { color: #6c71c4 } /* Literal.String.Doc */
    c-[se] { color: #6c71c4 } /* Literal.String.Escape */
    c-[sh] { color: #6c71c4 } /* Literal.String.Heredoc */
    c-[si] { color: #6c71c4 } /* Literal.String.Interpol */
    c-[sx] { color: #6c71c4 } /* Literal.String.Other */
    c-[sr] { color: #6c71c4 } /* Literal.String.Regex */
    c-[ss] { color: #6c71c4 } /* Literal.String.Symbol */
    c-[fm] { color: #268bd2 } /* Name.Function.Magic */
    c-[vc] { color: #cb4b16 } /* Name.Variable.Class */
    c-[vg] { color: #cb4b16 } /* Name.Variable.Global */
    c-[vi] { color: #cb4b16 } /* Name.Variable.Instance */
    c-[vm] { color: #cb4b16 } /* Name.Variable.Magic */
    c-[il] { color: #657b83 } /* Literal.Number.Integer.Long */
}
</style>
 <body class="h-entry">
  <div class="head">
   <p data-fill-with="logo"></p>
   <h1 class="no-ref p-name" id="title">Aggregator Specification</h1>
   <h2 class="heading no-num no-ref no-toc settled" id="profile-and-date"><span class="content">Living Document,
    <time class="dt-updated" datetime="2026-02-03">3 February 2026</time></span></h2>
   <div data-fill-with="spec-metadata">
    <dl>
     <dt>Previous Versions:
     <dd><a href="_ORCHESTRATOR_PREVIOUS_BUILD_FULL_LINK_" rel="prev">_ORCHESTRATOR_PREVIOUS_BUILD_FULL_LINK_</a>
     <dt>Issue Tracking:
     <dd><a href="#issues-index">Inline In Spec</a>
     <dt class="editor">Editor:
     <dd class="editor h-card p-author vcard"><a class="email fn p-name u-email" href="mailto:maarten.vandenbrande@ugent.be">Maarten Vandenbrande</a> (<a class="org p-org" href="http://idlab.ugent.be/">Ghent University - imec</a>)
    </dl>
   </div>
   <div data-fill-with="warning"></div>
   <p class="copyright" data-fill-with="copyright"><a href="http://creativecommons.org/publicdomain/zero/1.0/" rel="license"><img alt="CC0" height="15" src="https://licensebuttons.net/p/zero/1.0/80x15.png" width="80"></a>
To the extent possible under law, the editors have waived all copyright
and related or neighboring rights to this work.
In addition, as of 3 February 2026,
the editors have made this specification available under the
<a href="https://www.openwebfoundation.org/the-agreements/the-owf-1-0-agreements-granted-claims/owfa-1-0" rel="license">Open Web Foundation Agreement Version 1.0</a>,
which is available at https://www.openwebfoundation.org/the-agreements/the-owf-1-0-agreements-granted-claims/owfa-1-0.
Parts of this work may be from another specification document.  If so, those parts are instead covered by the license of that specification document.
</p>
   <hr title="Separator for header">
  </div>
  <div class="p-summary" data-fill-with="abstract">
   <h2 class="heading no-num no-ref no-toc settled" id="abstract"><span class="content">Abstract</span></h2>
   <p>The Aggregator Protocol defines an HTTP interface for discovering aggregator deployments,
registering aggregator instances, and managing services that execute data transformations. The protocol
leverages OIDC and User-Managed Access (UMA) for authentication and authorization, enabling secure access
to protected derived resources.</p>
  </div>
  <div data-fill-with="at-risk"></div>
  <nav data-fill-with="table-of-contents" id="toc">
   <h2 class="no-num no-ref no-toc" id="contents">Table of Contents</h2>
   <ol class="toc">
    <li><a href="#introduction"><span class="secno">1</span> <span class="content">Introduction</span></a>
    <li>
     <a href="#definitions"><span class="secno">2</span> <span class="content">Definitions</span></a>
     <ol class="toc">
      <li><a href="#definitions-core"><span class="secno">2.1</span> <span class="content">Core Roles and Components</span></a>
      <li><a href="#definitions-security"><span class="secno">2.2</span> <span class="content">Identity, Authorization, and Tokens</span></a>
      <li><a href="#aggregator-server-namespaces"><span class="secno">2.3</span> <span class="content">Namespaces</span></a>
     </ol>
    <li>
     <a href="#architecture-resource-model"><span class="secno">3</span> <span class="content">Architecture &amp; Resource Model</span></a>
     <ol class="toc">
      <li><a href="#architecture-actors"><span class="secno">3.1</span> <span class="content">Actors and Responsibilities</span></a>
      <li><a href="#resource-types"><span class="secno">3.2</span> <span class="content">Resource Types</span></a>
      <li><a href="#base-urls-and-addressing"><span class="secno">3.3</span> <span class="content">Base URLs and Addressing</span></a>
      <li><a href="#discovery-and-entry-points"><span class="secno">3.4</span> <span class="content">Discovery and Entry Points</span></a>
      <li><a href="#security-boundaries"><span class="secno">3.5</span> <span class="content">Security Boundaries</span></a>
      <li><a href="#example-url-layout"><span class="secno">3.6</span> <span class="content">Example URL Layout (Non-normative)</span></a>
     </ol>
    <li>
     <a href="#aggregator-server-metadata"><span class="secno">4</span> <span class="content">Aggregator Server Metadata</span></a>
     <ol class="toc">
      <li><a href="#server-description"><span class="secno">4.1</span> <span class="content">Aggregator Server Description</span></a>
      <li><a href="#client-id-document"><span class="secno">4.2</span> <span class="content">Client ID Document</span></a>
      <li><a href="#server-level-transformation-catalog"><span class="secno">4.3</span> <span class="content">Server-level Transformation Catalog</span></a>
     </ol>
    <li>
     <a href="#aggregator-management"><span class="secno">5</span> <span class="content">Aggregator Management</span></a>
     <ol class="toc">
      <li><a href="#aggregator-registration"><span class="secno">5.1</span> <span class="content">Aggregator Registration Endpoint</span></a>
      <li>
       <a href="#aggregator-management-flows"><span class="secno">5.2</span> <span class="content">Aggregator Management Flows (Non-normative)</span></a>
       <ol class="toc">
        <li><a href="#creation-provision"><span class="secno">5.2.1</span> <span class="content">Creation <code>provision</code> Flow</span></a>
        <li><a href="#creation-authorization"><span class="secno">5.2.2</span> <span class="content">Creation <code>authorization_code</code> Flow</span></a>
        <li><a href="#creation-device-code"><span class="secno">5.2.3</span> <span class="content">Creation <code>device_code</code> Flow</span></a>
        <li><a href="#token-update"><span class="secno">5.2.4</span> <span class="content">Token Update Flow</span></a>
        <li><a href="#aggregator-listing"><span class="secno">5.2.5</span> <span class="content">Aggregator Listing Flow</span></a>
        <li><a href="#aggregator-deletion"><span class="secno">5.2.6</span> <span class="content">Aggregator Deletion Flow</span></a>
       </ol>
     </ol>
    <li>
     <a href="#aggregator-security-model"><span class="secno">6</span> <span class="content">Aggregator Security Model (Authentication &amp; Authorization)</span></a>
     <ol class="toc">
      <li><a href="#requesting-flow"><span class="secno">6.1</span> <span class="content">Upstream Access (Requesting)</span></a>
      <li><a href="#serving-flow"><span class="secno">6.2</span> <span class="content">Client Access (Serving)</span></a>
     </ol>
    <li>
     <a href="#aggregator-metadata"><span class="secno">7</span> <span class="content">Aggregator Metadata</span></a>
     <ol class="toc">
      <li><a href="#aggregator-description"><span class="secno">7.1</span> <span class="content">Aggregator Description</span></a>
      <li><a href="#instance-level-transformation-catalog"><span class="secno">7.2</span> <span class="content">Instance-level Transformations Catalog</span></a>
     </ol>
    <li>
     <a href="#aggregator-service-management"><span class="secno">8</span> <span class="content">Aggregator Service Management</span></a>
     <ol class="toc">
      <li><a href="#service-collection"><span class="secno">8.1</span> <span class="content">Service Collection Endpoint</span></a>
      <li><a href="#service-resource"><span class="secno">8.2</span> <span class="content">Service Resource</span></a>
      <li>
       <a href="#service-management-flows"><span class="secno">8.3</span> <span class="content">Service Management Flows (Non-normative)</span></a>
       <ol class="toc">
        <li><a href="#creating-a-service"><span class="secno">8.3.1</span> <span class="content">Creating a Service</span></a>
        <li><a href="#discovering-services"><span class="secno">8.3.2</span> <span class="content">Discovering Services</span></a>
        <li><a href="#using-a-service"><span class="secno">8.3.3</span> <span class="content">Using a Simple Service</span></a>
       </ol>
     </ol>
    <li>
     <a href="#vocabulary"><span class="secno">9</span> <span class="content">Vocabulary</span></a>
     <ol class="toc">
      <li>
       <a href="#vocabulary-classes"><span class="secno">9.1</span> <span class="content">Classes</span></a>
       <ol class="toc">
        <li><a href="#aggr-aggregator-class"><span class="secno">9.1.1</span> <span class="content">aggr:Aggregator</span></a>
        <li><a href="#aggr-service-class"><span class="secno">9.1.2</span> <span class="content">aggr:Service</span></a>
        <li><a href="#aggr-aggregator-server-class"><span class="secno">9.1.3</span> <span class="content">aggr:AggregatorServer</span></a>
        <li><a href="#aggr-service-collection-class"><span class="secno">9.1.4</span> <span class="content">aggr:ServiceCollection</span></a>
        <li><a href="#aggr-transformation-collection-class"><span class="secno">9.1.5</span> <span class="content">aggr:TransformationCollection</span></a>
        <li><a href="#aggr-registration-flow-class"><span class="secno">9.1.6</span> <span class="content">aggr:RegistrationFlow</span></a>
        <li><a href="#aggr-no-auth-flow-class"><span class="secno">9.1.7</span> <span class="content">aggr:NoAuthFlow</span></a>
        <li><a href="#aggr-provision-flow-class"><span class="secno">9.1.8</span> <span class="content">aggr:ProvisionFlow</span></a>
        <li><a href="#aggr-authorization-code-flow-class"><span class="secno">9.1.9</span> <span class="content">aggr:AuthorizationCodeFlow</span></a>
        <li><a href="#aggr-device-code-flow-class"><span class="secno">9.1.10</span> <span class="content">aggr:DeviceCodeFlow</span></a>
       </ol>
      <li>
       <a href="#vocabulary-properties"><span class="secno">9.2</span> <span class="content">Properties</span></a>
       <ol class="toc">
        <li><a href="#aggr-created-at-property"><span class="secno">9.2.1</span> <span class="content">aggr:createdAt</span></a>
        <li><a href="#aggr-login-status-property"><span class="secno">9.2.2</span> <span class="content">aggr:loginStatus</span></a>
        <li><a href="#aggr-token-expiry-property"><span class="secno">9.2.3</span> <span class="content">aggr:tokenExpiry</span></a>
        <li><a href="#aggr-transformations-endpoint-property"><span class="secno">9.2.4</span> <span class="content">aggr:transformationsEndpoint</span></a>
        <li><a href="#aggr-service-collection-endpoint-property"><span class="secno">9.2.5</span> <span class="content">aggr:serviceCollectionEndpoint</span></a>
        <li><a href="#aggr-service-property"><span class="secno">9.2.6</span> <span class="content">aggr:service</span></a>
        <li><a href="#aggr-has-transformation-property"><span class="secno">9.2.7</span> <span class="content">aggr:hasTransformation</span></a>
        <li><a href="#aggr-status-property"><span class="secno">9.2.8</span> <span class="content">aggr:status</span></a>
        <li><a href="#aggr-status-detail-property"><span class="secno">9.2.9</span> <span class="content">aggr:statusDetail</span></a>
        <li><a href="#aggr-registration-endpoint-property"><span class="secno">9.2.10</span> <span class="content">aggr:registrationEndpoint</span></a>
        <li><a href="#aggr-supported-registration-type-property"><span class="secno">9.2.11</span> <span class="content">aggr:supportedRegistrationType</span></a>
        <li><a href="#aggr-registration-request-format-supported-property"><span class="secno">9.2.12</span> <span class="content">aggr:registrationRequestFormatSupported</span></a>
        <li><a href="#aggr-spec-version-property"><span class="secno">9.2.13</span> <span class="content">aggr:specVersion</span></a>
        <li><a href="#aggr-client-id-property"><span class="secno">9.2.14</span> <span class="content">aggr:clientIdentifier</span></a>
        <li><a href="#aggr-transformation-catalog-property"><span class="secno">9.2.15</span> <span class="content">aggr:transformationCatalog</span></a>
       </ol>
      <li>
       <a href="#vocabulary-claim-types"><span class="secno">9.3</span> <span class="content">Claim Types</span></a>
       <ol class="toc">
        <li><a href="#aggr-transformation-description-claim-type"><span class="secno">9.3.1</span> <span class="content">aggr:transformation-description</span></a>
        <li><a href="#aggr-derivation-access-claim-type"><span class="secno">9.3.2</span> <span class="content">aggr:derivation-access</span></a>
       </ol>
     </ol>
    <li><a href="#conformance"><span class="secno"></span> <span class="content">
    Conformance</span></a>
    <li>
     <a href="#references"><span class="secno"></span> <span class="content">References</span></a>
     <ol class="toc">
      <li><a href="#normative"><span class="secno"></span> <span class="content">Normative References</span></a>
      <li><a href="#informative"><span class="secno"></span> <span class="content">Informative References</span></a>
     </ol>
    <li><a href="#issues-index"><span class="secno"></span> <span class="content">Issues Index</span></a>
   </ol>
  </nav>
  <main>
   <h2 class="heading settled" data-level="1" id="introduction"><span class="secno">1. </span><span class="content">Introduction</span><a class="self-link" href="#introduction"></a></h2>
   <p>This specification defines the Aggregator Protocol, an HTTP-based interface that lets a client create and manage Aggregator
Instances and configure Aggregator Services that execute data transformations. Transformations are described and discovered 
using the Function Ontology (FnO) <a data-link-type="biblio" href="#biblio-fno" title="Function Ontology (FnO)">[FNO]</a>; a service is configured by referencing a transformation (a <code>fno:Execution</code>) and 
providing its parameters, after which the client can retrieve the derived result from the output defined by that function.</p>
   <p>Clients start from the Aggregator Server Description at the server base URL to discover the registration endpoint, supported
registration flows, and the server’s transformation catalog (<a href="#aggregator-server-metadata">§ 4 Aggregator Server Metadata</a>). Using the registration 
endpoint, a client creates (or manages) an Aggregator Instance (<a href="#aggregator-registration">§ 5.1 Aggregator Registration Endpoint</a>) and then follows the 
instance’s Aggregator Description to find the instance’s service collection and transformations endpoint 
(<a href="#aggregator-description">§ 7.1 Aggregator Description</a> and <a href="#aggregator-service-management">§ 8 Aggregator Service Management</a>).</p>
   <p>All management operations are authenticated and authorized. This protocol integrates with OpenID Connect <a data-link-type="biblio" href="#biblio-oidc-core" title="OpenID Connect Core 1.0">[OIDC-Core]</a> for
identity and uses UMA-style authorization <a data-link-type="biblio" href="#biblio-uma" title="User-Managed Access (UMA) 2.0">[UMA]</a> for protected resources, scopes, and tickets as described in 
<a href="#aggregator-security-model">§ 6 Aggregator Security Model (Authentication &amp; Authorization)</a>.</p>
   <p>Servers MUST support JSON (<code>application/json</code>) where specified and MAY additionally provide semantically annotated RDF
representations (e.g., JSON-LD or Turtle) via HTTP content negotiation. The Aggregator vocabulary (<a href="#vocabulary">§ 9 Vocabulary</a>) provides 
stable IRIs for classes and predicates used throughout the specification.</p>
   <h2 class="heading settled" data-level="2" id="definitions"><span class="secno">2. </span><span class="content">Definitions</span><a class="self-link" href="#definitions"></a></h2>
   <p>This section defines terminology used throughout this specification. Where applicable, terms are aligned with external
specifications such as WebID Profiles <a data-link-type="biblio" href="#biblio-webid-profile" title="WebID Profile">[WEBID-PROFILE]</a>, OpenID Connect (OIDC) <a data-link-type="biblio" href="#biblio-oidc-core" title="OpenID Connect Core 1.0">[OIDC-Core]</a>, OAuth 2.0 <a data-link-type="biblio" href="#biblio-rfc6749" title="The OAuth 2.0 Authorization Framework">[RFC6749]</a>, and 
User-Managed Access (UMA) <a data-link-type="biblio" href="#biblio-uma" title="User-Managed Access (UMA) 2.0">[UMA]</a>.</p>
   <h3 class="heading settled" data-level="2.1" id="definitions-core"><span class="secno">2.1. </span><span class="content">Core Roles and Components</span><a class="self-link" href="#definitions-core"></a></h3>
   <ul>
    <li data-md>
     <p><strong>Client:</strong> An application acting on behalf of an end-user to create Aggregator Instances and configure Aggregator
Services.</p>
    <li data-md>
     <p><strong>Aggregator Server:</strong> The server deployment that exposes public discovery metadata and a registration API used to create
and manage Aggregator Instances.</p>
    <li data-md>
     <p><strong>Aggregator Instance</strong> (or “Aggregator”): A user- or tenant-scoped logical instance created via the registration
endpoint. An instance exposes an Aggregator Description and an authenticated management API for configuring services.</p>
    <li data-md>
     <p><strong>Aggregator Service</strong> (or “Service”): A configured data processing pipeline inside an Aggregator Instance. A service is
represented as an FnO execution (<code>fno:Execution</code>) that identifies the executed function and its inputs; outputs are 
described by the function’s output parameters (see <a href="#aggregator-service-management">§ 8 Aggregator Service Management</a>).</p>
    <li data-md>
     <p><strong>Transformation Catalog:</strong> A catalog that describes the transformations supported by the Aggregator Server or Aggregator
Instance (see <a href="#server-level-transformation-catalog">§ 4.3 Server-level Transformation Catalog</a> and <a href="#instance-level-transformation-catalog">§ 7.2 Instance-level Transformations Catalog</a>).</p>
   </ul>
   <h3 class="heading settled" data-level="2.2" id="definitions-security"><span class="secno">2.2. </span><span class="content">Identity, Authorization, and Tokens</span><a class="self-link" href="#definitions-security"></a></h3>
   <ul>
    <li data-md>
     <p><strong>User (End-user):</strong> A person or agent that owns or controls resources and uses a Client to configure an Aggregator
deployment.</p>
    <li data-md>
     <p><strong>WebID:</strong> An HTTP(S) IRI that identifies an agent and can be dereferenced to obtain a WebID Profile document mainly to
discover the user’s IdP (defined in <a data-link-type="biblio" href="#biblio-webid-profile" title="WebID Profile">[WEBID-PROFILE]</a>).</p>
    <li data-md>
     <p><strong>Identity Provider (IdP):</strong> An OpenID Connect Provider following the OIDC spec (<a data-link-type="biblio" href="#biblio-oidc-core" title="OpenID Connect Core 1.0">[OIDC-Core]</a>) that authenticates a user
based on it’s userID and issues ID tokens used by this protocol during registration and authorization workflows.</p>
    <li data-md>
     <p><strong>Authorization Server (AS):</strong> An OAuth 2.0 Authorization Server that supports UMA as defined in (<a data-link-type="biblio" href="#biblio-a4ds" title="Authorization for Data Spaces (A4DS)">[A4DS]</a>) and issues
Requesting Party Tokens (RPTs) for protected resources.</p>
    <li data-md>
     <p><strong>Resource Server (RS):</strong> An HTTP server that hosts protected resources. In UMA terminology, a Resource Server protects
resources and interacts with an Authorization Server to obtain UMA tickets and validate RPTs.</p>
    <li data-md>
     <p><strong>UMA Ticket:</strong> A value returned in a <code>WWW-Authenticate: UMA ...</code> challenge when a client requests a protected resource
without sufficient authorization. The client presents the ticket to the Authorization Server to obtain an RPT.</p>
    <li data-md>
     <p><strong>Requesting Party Token (RPT):</strong> An OAuth 2.0 token issued by an Authorization Server under UMA that encodes
permissions/scopes for a protected resource (see <a data-link-type="biblio" href="#biblio-rfc6750" title="The OAuth 2.0 Authorization Framework: Bearer Token Usage">[RFC6750]</a>).</p>
    <li data-md>
     <p><strong>ID Token:</strong> An OpenID Connect ID token representing the authenticated user (and, depending on the deployment,
the client). The protocol uses ID tokens as claim tokens in UMA exchanges and during registration flows as described in 
<a href="#aggregator-security-model">§ 6 Aggregator Security Model (Authentication &amp; Authorization)</a>.</p>
    <li data-md>
     <p><strong>Client ID Document:</strong> A dereferenceable client metadata document that follows the OAuth Client ID Metadata
Document specification <a data-link-type="biblio" href="#biblio-client-id" title="OAuth Client ID Metadata Document">[Client-ID]</a>.</p>
   </ul>
   <h3 class="heading settled" data-level="2.3" id="aggregator-server-namespaces"><span class="secno">2.3. </span><span class="content">Namespaces</span><a class="self-link" href="#aggregator-server-namespaces"></a></h3>
   <p>The following namespace prefixes are used throughout this specification and SHOULD appear in RDF serializations
(e.g., Turtle, JSON-LD contexts):</p>
   <ul>
    <li data-md>
     <p><code>aggr:</code> → <code>https://spec.knows.idlab.ugent.be/aggregator-protocol/latest/#</code></p>
    <li data-md>
     <p><code>dct:</code> → <code>http://purl.org/dc/terms/</code></p>
    <li data-md>
     <p><code>fno:</code> → <code>https://w3id.org/function/ontology#</code></p>
    <li data-md>
     <p><code>dcat:</code> → <code>https://www.w3.org/ns/dcat#</code></p>
    <li data-md>
     <p><code>dcterms:</code> → <code>http://purl.org/dc/terms/</code></p>
    <li data-md>
     <p><code>owl:</code> → <code>http://www.w3.org/2002/07/owl#</code></p>
    <li data-md>
     <p><code>rdf:</code> → <code>http://www.w3.org/1999/02/22-rdf-syntax-ns#</code></p>
    <li data-md>
     <p><code>rdfs:</code> → <code>http://www.w3.org/2000/01/rdf-schema#</code></p>
    <li data-md>
     <p><code>xsd:</code> → <code>http://www.w3.org/2001/XMLSchema#</code></p>
   </ul>
   <h2 class="heading settled" data-level="3" id="architecture-resource-model"><span class="secno">3. </span><span class="content">Architecture &amp; Resource Model</span><a class="self-link" href="#architecture-resource-model"></a></h2>
   <p>This section describes the high-level architecture of an Aggregator deployment and the resource model exposed by this
specification. It connects the terminology in <a href="#definitions">§ 2 Definitions</a> to the endpoint definitions in later sections.</p>
   <h3 class="heading settled" data-level="3.1" id="architecture-actors"><span class="secno">3.1. </span><span class="content">Actors and Responsibilities</span><a class="self-link" href="#architecture-actors"></a></h3>
   <p>The protocol distinguishes the following parties:</p>
   <ul>
    <li data-md>
     <p><strong>Client:</strong> An application acting on behalf of an end-user to create Aggregator Instances and configure Aggregator
Services.</p>
    <li data-md>
     <p><strong>Aggregator Server:</strong> The server that exposes public discovery information and a registration API to create Aggregator
Instances.</p>
    <li data-md>
     <p><strong>Aggregator Instance:</strong> A user-specific (or tenant-specific) logical instance created via registration, exposing instance
metadata and a management API.</p>
    <li data-md>
     <p><strong>Aggregator Service:</strong> A configured data-processing pipeline created and managed within an Aggregator Instance.</p>
    <li data-md>
     <p><strong>Identity Provider (IdP):</strong> Issues OIDC tokens used to prove identity as part of registration and upstream authorization
flows.</p>
    <li data-md>
     <p><strong>Authorization Server (AS):</strong> A UMA-capable OAuth2 Authorization Server that issues RPTs for protected resources.</p>
    <li data-md>
     <p><strong>Resource Server (RS):</strong> An upstream resource server hosting data that the Aggregator Service may access on behalf of the
user.</p>
   </ul>
   <h3 class="heading settled" data-level="3.2" id="resource-types"><span class="secno">3.2. </span><span class="content">Resource Types</span><a class="self-link" href="#resource-types"></a></h3>
   <p>This specification defines HTTP resources at three levels:</p>
   <ul>
    <li data-md>
     <p><strong>Aggregator Server resources:</strong> metadata and instance registration (see <a href="#aggregator-server-metadata">§ 4 Aggregator Server Metadata</a> and
<a href="#aggregator-registration">§ 5.1 Aggregator Registration Endpoint</a>).</p>
    <li data-md>
     <p><strong>Aggregator Instance resources:</strong> instance metadata and service management (see <a href="#aggregator-metadata">§ 7 Aggregator Metadata</a> and
<a href="#aggregator-service-management">§ 8 Aggregator Service Management</a>).</p>
    <li data-md>
     <p><strong>Aggregator Service resources:</strong> a service collection and individual services managed under the instance (see
<a href="#service-collection">§ 8.1 Service Collection Endpoint</a> and <a href="#service-resource">§ 8.2 Service Resource</a>).</p>
   </ul>
   <h3 class="heading settled" data-level="3.3" id="base-urls-and-addressing"><span class="secno">3.3. </span><span class="content">Base URLs and Addressing</span><a class="self-link" href="#base-urls-and-addressing"></a></h3>
   <p>An implementation MUST define a stable base URL for:</p>
   <ul>
    <li data-md>
     <p>the Aggregator Server (the <code>aggregator-server-url</code>); and</p>
    <li data-md>
     <p>each Aggregator Instance (the <code>aggregator-url</code>).</p>
   </ul>
   <p>An implementation MAY use either of the following instance addressing patterns:</p>
   <ul>
    <li data-md>
     <p><strong>Host-based instances:</strong> <code>https://{instance-id}.aggregator.example/</code></p>
    <li data-md>
     <p><strong>Path-based instances:</strong> <code>https://aggregator.example/{instance-id}/</code></p>
   </ul>
   <p>Clients SHOULD treat server-provided URLs as authoritative and avoid constructing URLs by string concatenation. Unless a
path is explicitly fixed, the concrete URLs shown in this document serve as illustrative defaults; deployments MAY use 
different locations as long as the relevant metadata resources advertise the authoritative links.</p>
   <h3 class="heading settled" data-level="3.4" id="discovery-and-entry-points"><span class="secno">3.4. </span><span class="content">Discovery and Entry Points</span><a class="self-link" href="#discovery-and-entry-points"></a></h3>
   <ul>
    <li data-md>
     <p>The Aggregator Server exposes a public discovery resource at its server base URL (see <a href="#server-description">§ 4.1 Aggregator Server Description</a>).</p>
    <li data-md>
     <p>Clients create (or obtain access to) an Aggregator Instance via the registration API (see <a href="#aggregator-registration">§ 5.1 Aggregator Registration Endpoint</a>).</p>
    <li data-md>
     <p>The resulting instance base URL is the entry point for instance metadata (see <a href="#aggregator-metadata">§ 7 Aggregator Metadata</a>) and instance
management (see <a href="#aggregator-service-management">§ 8 Aggregator Service Management</a>).</p>
   </ul>
   <h3 class="heading settled" data-level="3.5" id="security-boundaries"><span class="secno">3.5. </span><span class="content">Security Boundaries</span><a class="self-link" href="#security-boundaries"></a></h3>
   <p>All security requirements are defined in <a href="#aggregator-security-model">§ 6 Aggregator Security Model (Authentication &amp; Authorization)</a>. At a high level:</p>
   <ul>
    <li data-md>
     <p>Public (no authentication): the server description (see <a href="#server-description">§ 4.1 Aggregator Server Description</a>) and the resources it links to, such as
the server level transformation catalog and Client ID Document (see <a href="#server-level-transformation-catalog">§ 4.3 Server-level Transformation Catalog</a> and 
<a href="#client-id-document">§ 4.2 Client ID Document</a>).</p>
    <li data-md>
     <p>Protected (OIDC): the registration endpoint (see <a href="#aggregator-registration">§ 5.1 Aggregator Registration Endpoint</a>), and possibly the server description and
server level transformation catalog depending on the implementation.</p>
    <li data-md>
     <p>Protected (UMA): the instance metadata resource (see <a href="#aggregator-metadata">§ 7 Aggregator Metadata</a>) and all resources under the service
management API (see <a href="#aggregator-service-management">§ 8 Aggregator Service Management</a>).</p>
   </ul>
   <p>The aggregator and its clients SHOULD use secure transport (HTTPS) for all communication, and SHOULD use DPOP tokens
wherever possible to bind tokens to the client. Aggregator endpoints intended for browser-based clients MUST support CORS. 
Unless the client and Aggregator are tightly coupled and deployed under the same origin, the server MUST answer <code>OPTIONS</code> 
preflight requests and include appropriate <code>Access-Control-Allow-*</code> headers for the methods and headers used by this 
specification (including <code>Authorization</code>, <code>Content-Type</code>, and <code>Accept</code>). Implementations MAY restrict allowed origins to 
trusted client origins.</p>
   <h3 class="heading settled" data-level="3.6" id="example-url-layout"><span class="secno">3.6. </span><span class="content">Example URL Layout (Non-normative)</span><a class="self-link" href="#example-url-layout"></a></h3>
   <p>Given an Aggregator Server at <code>https://aggregator.example/</code> and a path-based Aggregator instance at
<code>https://aggregator.example/abc123/</code>:</p>
   <ul>
    <li data-md>
     <p>Server description: <code>https://aggregator.example/</code></p>
    <li data-md>
     <p>Registration: <code>https://aggregator.example/registration</code></p>
    <li data-md>
     <p>Transformation catalog: <code>https://aggregator.example/transformations</code></p>
    <li data-md>
     <p>Instance description: <code>https://aggregator.example/abc123/</code></p>
    <li data-md>
     <p>Instance Transformation catalog: <code>https://aggregator.example/abc123/config/transformations</code></p>
    <li data-md>
     <p>Service collection: <code>https://aggregator.example/abc123/config/services</code></p>
   </ul>
   <h2 class="heading settled" data-level="4" id="aggregator-server-metadata"><span class="secno">4. </span><span class="content">Aggregator Server Metadata</span><a class="self-link" href="#aggregator-server-metadata"></a></h2>
   <p>This section describes the public endpoints exposed by the Aggregator Server for discovery and metadata retrieval. Except
for the Aggregator Server Description at the server base URL, implementations MAY expose the remaining endpoints at 
deployment-specific URLs; the server description document MUST include absolute URLs for each resource so that clients can 
discover them.</p>
   <h3 class="heading settled" data-level="4.1" id="server-description"><span class="secno">4.1. </span><span class="content">Aggregator Server Description</span><a class="self-link" href="#server-description"></a></h3>
   <p>The Aggregator Server Description is a public document that allows clients to discover the Aggregator Server’s
endpoints and capabilities. This document MUST be available at the server base URL (i.e., <code>{aggregator-server-url}/</code>), MUST 
be accessible without authentication, and MUST provide at least the following information. Each JSON member is paired with 
an RDF predicate from <a href="#vocabulary">§ 9 Vocabulary</a> so the document can also be served as JSON-LD or other RDF formats using content 
negotiation based on <a data-link-type="biblio" href="#biblio-rfc9110" title="HTTP Semantics">[RFC9110]</a>:</p>
   <p>In semantically annotated representations, the Aggregator Server Description MUST state that the described resource has RDF
type <code>aggr:AggregatorServer</code> (<a href="#aggr-aggregator-server-class">§ 9.1.3 aggr:AggregatorServer</a>) (e.g., via <code>@type</code> in JSON-LD or <code>a aggr:AggregatorServer</code> 
in Turtle). Clients MAY rely on this type statement when consuming semantic representations.</p>
   <dl>
    <dt data-md><strong>registration_endpoint</strong> (REQUIRED):
    <dd data-md>
     <p>The value is a string containing the absolute URL of the Aggregator Registration Endpoint (<a href="#aggregator-registration">§ 5.1 Aggregator Registration Endpoint</a>);
in the RDF representations, this member maps to the predicate <code>aggr:registrationEndpoint</code> 
(<a href="#aggr-registration-endpoint-property">§ 9.2.10 aggr:registrationEndpoint</a>).</p>
    <dt data-md><strong>supported_registration_types</strong> (REQUIRED):
    <dd data-md>
     <p>The value is a JSON array of strings identifying the supported registration flow tokens at <code>registration_endpoint</code>; in
the RDF representations, each entry maps to an <code>aggr:supportedRegistrationType</code> triple 
(<a href="#aggr-supported-registration-type-property">§ 9.2.11 aggr:supportedRegistrationType</a>) whose object is the corresponding flow class IRI.</p>
    <dd data-md>
     <p>Each member MUST be one of the registration flow tokens defined in <a href="#aggregator-registration">§ 5.1 Aggregator Registration Endpoint</a>:</p>
     <ul>
      <li data-md>
       <p><code>"provision"</code> (RDF class <code>aggr:ProvisionFlow</code> (<a href="#aggr-provision-flow-class">§ 9.1.8 aggr:ProvisionFlow</a>))</p>
      <li data-md>
       <p><code>"authorization_code"</code> (RDF class <code>aggr:AuthorizationCodeFlow</code> (<a href="#aggr-authorization-code-flow-class">§ 9.1.9 aggr:AuthorizationCodeFlow</a>))</p>
      <li data-md>
       <p><code>"device_code"</code> (RDF class <code>aggr:DeviceCodeFlow</code> (<a href="#aggr-device-code-flow-class">§ 9.1.10 aggr:DeviceCodeFlow</a>))</p>
     </ul>
    <dt data-md><strong>registration_request_formats_supported</strong> (REQUIRED):
    <dd data-md>
     <p>The value is a JSON array of strings identifying the supported request formats for the
<code>registration_endpoint</code>. Each entry MUST be a media type; in RDF representations, each entry maps to
an <code>aggr:registrationRequestFormatSupported</code> triple (<a href="#aggr-registration-request-format-supported-property">§ 9.2.12 aggr:registrationRequestFormatSupported</a>).
Servers MUST include either <code>application/json</code> or <code>application/x-www-form-urlencoded</code> or both.</p>
    <dt data-md><strong>version</strong> (REQUIRED):
    <dd data-md>
     <p>The value is a string containing the semantic version (<a data-link-type="biblio" href="#biblio-semver" title="Semantic Versioning 2.0.0">[SEMVER]</a>) of the Aggregator specification that the server
adheres to; in the RDF representations, this member maps to the predicate <code>aggr:specVersion</code> 
(<a href="#aggr-spec-version-property">§ 9.2.13 aggr:specVersion</a>).</p>
    <dt data-md><strong>client_identifier</strong> (REQUIRED):
    <dd data-md>
     <p>The value is a string containing the absolute URL of the Client ID Document (<a href="#client-id-document">§ 4.2 Client ID Document</a>); in
the RDF representations, this member maps to the predicate <code>aggr:clientIdentifier</code> 
(<a href="#aggr-client-id-property">§ 9.2.14 aggr:clientIdentifier</a>).</p>
    <dt data-md><strong>transformation_catalog</strong> (REQUIRED):
    <dd data-md>
     <p>The value is a string containing the absolute URL of the Public Transformation Catalog
(<a href="#server-level-transformation-catalog">§ 4.3 Server-level Transformation Catalog</a>); in the RDF representations, this member maps to the predicate
<code>aggr:transformationCatalog</code> (<a href="#aggr-transformation-catalog-property">§ 9.2.15 aggr:transformationCatalog</a>).</p>
   </dl>
   <div class="example" id="example-97678f06">
    <a class="self-link" href="#example-97678f06"></a>

<pre class="highlight language-json"><c- p>{</c->
  <c- f>"@context"</c-><c- p>:</c-> <c- p>{</c->
    <c- f>"aggr"</c-><c- p>:</c-> <c- u>"https://spec.knows.idlab.ugent.be/aggregator-protocol/latest/#"</c-><c- p>,</c->
    <c- f>"provision"</c-><c- p>:</c-> <c- u>"aggr:ProvisionFlow"</c-><c- p>,</c->
    <c- f>"authorization_code"</c-><c- p>:</c-> <c- u>"aggr:AuthorizationCodeFlow"</c-><c- p>,</c->
    <c- f>"registration_request_formats_supported"</c-><c- p>:</c-> <c- u>"aggr:registrationRequestFormatSupported"</c-><c- p>,</c->
    <c- f>"registration_endpoint"</c-><c- p>:</c-> <c- p>{</c->
      <c- f>"@id"</c-><c- p>:</c-> <c- u>"aggr:registrationEndpoint"</c-><c- p>,</c->
      <c- f>"@type"</c-><c- p>:</c-> <c- u>"@id"</c->
    <c- p>},</c->
    <c- f>"supported_registration_types"</c-><c- p>:</c-> <c- p>{</c->
      <c- f>"@id"</c-><c- p>:</c-> <c- u>"aggr:supportedRegistrationType"</c-><c- p>,</c->
      <c- f>"@type"</c-><c- p>:</c-> <c- u>"@vocab"</c->
    <c- p>},</c->
    <c- f>"version"</c-><c- p>:</c-> <c- p>{</c->
      <c- f>"@id"</c-><c- p>:</c-> <c- u>"aggr:specVersion"</c->
    <c- p>},</c->
    <c- f>"client_identifier"</c-><c- p>:</c-> <c- p>{</c->
      <c- f>"@id"</c-><c- p>:</c-> <c- u>"aggr:clientIdentifier"</c-><c- p>,</c->
      <c- f>"@type"</c-><c- p>:</c-> <c- u>"@id"</c->
    <c- p>},</c->
    <c- f>"transformation_catalog"</c-><c- p>:</c-> <c- p>{</c->
      <c- f>"@id"</c-><c- p>:</c-> <c- u>"aggr:transformationCatalog"</c-><c- p>,</c->
      <c- f>"@type"</c-><c- p>:</c-> <c- u>"@id"</c->
    <c- p>}</c->
  <c- p>},</c->
  <c- f>"@id"</c-><c- p>:</c-> <c- u>"https://aggregator.example/"</c-><c- p>,</c->
  <c- f>"@type"</c-><c- p>:</c-> <c- u>"aggr:AggregatorServer"</c-><c- p>,</c->
  <c- f>"registration_endpoint"</c-><c- p>:</c-> <c- u>"https://aggregator.example/registration"</c-><c- p>,</c->
  <c- f>"supported_registration_types"</c-><c- p>:</c-> <c- p>[</c->
    <c- u>"provision"</c-><c- p>,</c->
    <c- u>"authorization_code"</c->
  <c- p>],</c->
  <c- f>"registration_request_formats_supported"</c-><c- p>:</c-> <c- p>[</c->
    <c- u>"application/json"</c-><c- p>,</c->
    <c- u>"application/x-www-form-urlencoded"</c->
  <c- p>],</c->
  <c- f>"version"</c-><c- p>:</c-> <c- u>"1.0.0"</c-><c- p>,</c->
  <c- f>"client_identifier"</c-><c- p>:</c-> <c- u>"https://aggregator.example/client.json"</c-><c- p>,</c->
  <c- f>"transformation_catalog"</c-><c- p>:</c-> <c- u>"https://aggregator.example/transformations"</c->
<c- p>}</c->
</pre>
   </div>
   <h3 class="heading settled" data-level="4.2" id="client-id-document"><span class="secno">4.2. </span><span class="content">Client ID Document</span><a class="self-link" href="#client-id-document"></a></h3>
   <p>Endpoint that exposes the Client ID Document of the aggregator used for authorization. Servers MAY host this document at any
URL; the <code>client_identifier</code> property in the Aggregator Server Description MUST contain the authoritative absolute URL. The 
Client ID Document MUST conform to the OAuth Client ID Metadata Document specification <a data-link-type="biblio" href="#biblio-client-id" title="OAuth Client ID Metadata Document">[Client-ID]</a>. In the case for the 
aggregator, the <code>redirect_uris</code> property is OPTIONAL instead of REQUIRED, as multiple clients MAY create an Aggregator on 
the same Aggregator Server (depending on the implementation). Adding this property allows an Aggregator Server 
implementation to restrict which clients may create aggregators on the server.</p>
   <h3 class="heading settled" data-level="4.3" id="server-level-transformation-catalog"><span class="secno">4.3. </span><span class="content">Server-level Transformation Catalog</span><a class="self-link" href="#server-level-transformation-catalog"></a></h3>
   <p>This endpoint returns a RDF document describing the transformations supported by the aggregator server on a server level.
Servers MAY publish this catalog at any deployment-specific URL; the Aggregator Server Description MUST advertise it via the 
<code>transformation_catalog</code> field. This RDF document SHOULD be exposed using content negotiation based on HTTP. The 
transformations MUST be described using FnO <a data-link-type="biblio" href="#biblio-fno" title="Function Ontology (FnO)">[FNO]</a>. The document MAY be protected using an OIDC ID Token.</p>
   <p>The types (<code>fno:type</code>) of the parameters and outputs of the functions SHOULD be a class (<code>owl:Class</code>) that is a subclass
(<code>rdfs:subClassOf</code>) of a Data Catalog (<a data-link-type="biblio" href="#biblio-data-catalog" title="Data Catalog Vocabulary">[Data-Catalog]</a>) entity like <code>dcat:DataService</code>. This entity SHOULD then be further 
described using Data Catalog properties to indicate the supported endpoints for the parameters and outputs. The Data 
Catalog Vocabulary recommends using entities from other vocabularies like Friend of a Friend (<a data-link-type="biblio" href="#biblio-foaf" title="Friend of a Friend (FOAF)">[FOAF]</a>) and Dublin Core 
Metadata Terms (<a data-link-type="biblio" href="#biblio-dcterms" title="Dublin Core Metadata Terms">[DCTERMS]</a>). Pre defined pipelines (using <code>fno:Compositions</code>) MAY also be described in this document. 
Finally, the catalog MAY also include external entities using <code>rdfs:seeAlso</code> to link to external functions, pipelines or 
Data Catalog entities.</p>
   <p>The specificity of the transformation is up to the server owner. The functions MAY have a link to an implementation with
<code>fno:Implementation</code> if needed.</p>
   <div class="example" id="example-71c80b7a">
    <a class="self-link" href="#example-71c80b7a"></a>

<pre class="highlight language-turtle"><c- k>@prefix</c-> <c- nn>aggr:</c-> <c- g>&lt;https://spec.knows.idlab.ugent.be/aggregator-protocol/latest/#></c-> <c- p>.</c->
<c- k>@prefix</c-> <c- nn>trans:</c-> <c- g>&lt;http://aggregator.example.org/transformations#></c-> <c- p>.</c->
<c- k>@prefix</c-> <c- nn>fno:</c-> <c- g>&lt;https://w3id.org/function/ontology#></c-> <c- p>.</c->
<c- k>@prefix</c-> <c- nn>rdf:</c-> <c- g>&lt;http://www.w3.org/1999/02/22-rdf-syntax-ns#></c-> <c- p>.</c->
<c- k>@prefix</c-> <c- nn>xsd:</c-> <c- g>&lt;http://www.w3.org/2001/XMLSchema#></c-> <c- p>.</c->

<c- g>&lt;></c-> <c- b>a</c-> <c- nn>aggr</c-><c- p>:</c-><c- f>TransformationCollection</c-> <c- p>;</c->
    <c- nn>dct</c-><c- p>:</c-><c- f>title</c-> <c- s>"Aggregator transformations"</c-> <c- p>;</c->
    <c- nn>aggr</c-><c- p>:</c-><c- f>hasTransformation</c-> <c- nn>trans</c-><c- p>:</c-><c- f>QuerySources</c-> <c- p>.</c->
    <c- nn>aggr</c-><c- p>:</c-><c- f>hasTransformation</c-> <c- g>&lt;https://external.example.org/AggregateSources></c-> <c- p>.</c->
    <c- nn>rdfs</c-><c- p>:</c-><c- f>seeAlso</c-> <c- g>&lt;https://external.example.org/AggregateSources></c-> <c- p>.</c->

<c- nn>trans</c-><c- p>:</c-><c- f>QuerySources</c->
    <c- b>a</c->                   <c- nn>fno</c-><c- p>:</c-><c- f>Function</c-> <c- p>;</c->
    <c- nn>fno</c-><c- p>:</c-><c- f>name</c->            <c- s>"A Aggregator Service that combines a list of sources"</c-><c- p>^^</c-><c- nn>xsd</c-><c- p>:</c-><c- f>string</c-> <c- p>;</c->
    <c- nn>fno</c-><c- p>:</c-><c- f>expects</c->         <c- p>(</c-> <c- nn>trans</c-><c- p>:</c-><c- f>Sources</c-> <c- nn>trans</c-><c- p>:</c-><c- f>Query</c-> <c- p>)</c-> <c- p>;</c->
    <c- nn>fno</c-><c- p>:</c-><c- f>returns</c->         <c- p>(</c-> <c- nn>trans</c-><c- p>:</c-><c- f>Result</c-> <c- p>)</c-> <c- p>.</c->

<c- nn>trans</c-><c- p>:</c-><c- f>Sources</c->
    <c- b>a</c->             <c- nn>fno</c-><c- p>:</c-><c- f>Parameter</c-> <c- p>;</c->
    <c- nn>fno</c-><c- p>:</c-><c- f>predicate</c-> <c- nn>trans</c-><c- p>:</c-><c- f>sources</c-> <c- p>;</c->
    <c- nn>fno</c-><c- p>:</c-><c- f>type</c->      <c- nn>rdf</c-><c- p>:</c-><c- f>List</c-> <c- p>;</c->
    <c- nn>fno</c-><c- p>:</c-><c- f>required</c->  <c- s>"true"</c-><c- p>^^</c-><c- nn>xsd</c-><c- p>:</c-><c- f>boolean</c-> <c- p>.</c->

<c- nn>trans</c-><c- p>:</c-><c- f>Query</c->
    <c- b>a</c->             <c- nn>fno</c-><c- p>:</c-><c- f>Parameter</c-> <c- p>;</c->
    <c- nn>fno</c-><c- p>:</c-><c- f>predicate</c-> <c- nn>trans</c-><c- p>:</c-><c- f>query</c-> <c- p>;</c->
    <c- nn>fno</c-><c- p>:</c-><c- f>type</c->      <c- nn>xsd</c-><c- p>:</c-><c- f>string</c-> <c- p>;</c->
    <c- nn>fno</c-><c- p>:</c-><c- f>required</c->  <c- s>"true"</c-><c- p>^^</c-><c- nn>xsd</c-><c- p>:</c-><c- f>boolean</c-> <c- p>.</c->

<c- nn>trans</c-><c- p>:</c-><c- f>Result</c->
    <c- b>a</c->             <c- nn>fno</c-><c- p>:</c-><c- f>Output</c-> <c- p>;</c->
    <c- nn>fno</c-><c- p>:</c-><c- f>predicate</c-> <c- nn>trans</c-><c- p>:</c-><c- f>result</c-> <c- p>;</c->
    <c- nn>fno</c-><c- p>:</c-><c- f>type</c->      <c- nn>trans</c-><c- p>:</c-><c- f>SPARQLProtocol</c-> <c- p>.</c->

<c- nn>trans</c-><c- p>:</c-><c- f>SPARQLProtocol</c->
    <c- b>a</c-> <c- nn>owl</c-><c- p>:</c-><c- f>Class</c-> <c- p>;</c->
    <c- nn>rdfs</c-><c- p>:</c-><c- f>subClassOf</c-> <c- nn>dcat</c-><c- p>:</c-><c- f>DataService</c-> <c- p>;</c->
    <c- nn>dcterms</c-><c- p>:</c-><c- f>conformsTo</c-> <c- g>&lt;https://www.w3.org/TR/sparql12-protocol/></c-> <c- p>.</c->
</pre>
   </div>
   <h2 class="heading settled" data-level="5" id="aggregator-management"><span class="secno">5. </span><span class="content">Aggregator Management</span><a class="self-link" href="#aggregator-management"></a></h2>
   
This section describes how Aggregator Instances are managed at the Aggregator Server level. Deployments define their own 
authorization policy for these endpoints, but they MUST require authenticated requests so the Aggregator provider can 
authorize a user to manage their aggregators. The tokens used in these requests (<code>IDP_client_token</code>) prove the identity of 
the user and the client (Client ID Document) used to access the Aggregator Server. Deployments MAY expose the same 
functionality at different paths, provided that the Aggregator Server Description advertises the authoritative URLs.


   <h3 class="heading settled" data-level="5.1" id="aggregator-registration"><span class="secno">5.1. </span><span class="content">Aggregator Registration Endpoint</span><a class="self-link" href="#aggregator-registration"></a></h3>
   
This section specifies the behavior of the <code>registration_endpoint</code> advertised by the Aggregator Server Description 
(<a href="#server-description">§ 4.1 Aggregator Server Description</a>). The endpoint supports creating Aggregator Instances, replacing the stored token set for an 
existing instance, and deleting an instance. If the <code>registration_type</code> isn’t <code>none</code> the endpoint SHOULD reject 
unauthenticated requests with <code>401 Unauthorized</code>.


   <p class="issue" id="issue-7876f244"><a class="self-link" href="#issue-7876f244"></a> should we allow a name field for the aggregator during creation?</p>
   <dl>
    <dt data-md><code>POST</code>
    <dd data-md>
     <p>Creates an Aggregator Instance or replaces the stored token set for an existing instance.
The request body MUST use a content type listed in <code>registration_request_formats_supported</code> and MUST include:
When using <code>application/json</code>, the body MUST be a JSON object. When using
<code>application/x-www-form-urlencoded</code>, the body parameters MUST be encoded as form fields with the same
member names.
The server MUST support <code>application/json</code> and MAY support <code>application/x-www-form-urlencoded</code>.</p>
     <ul>
      <li data-md>
       <p><strong>registration_type</strong> (REQUIRED):
The value is a string token; it MUST be one of the <code>supported_registration_types</code> advertised in the Aggregator 
Server Description (<a href="#server-description">§ 4.1 Aggregator Server Description</a>). The following string tokens are defined, each corresponding to an RDF 
class in the Aggregator vocabulary (<a href="#vocabulary">§ 9 Vocabulary</a>) for semantically annotated representations:</p>
       <ul>
        <li data-md>
         <p><code>"none"</code> ↔ <code>aggr:NoAuthFlow</code> (<a href="#aggr-no-auth-flow-class">§ 9.1.7 aggr:NoAuthFlow</a>)</p>
        <li data-md>
         <p><code>"provision"</code> ↔ <code>aggr:ProvisionFlow</code> (<a href="#aggr-provision-flow-class">§ 9.1.8 aggr:ProvisionFlow</a>)</p>
        <li data-md>
         <p><code>"authorization_code"</code> ↔ <code>aggr:AuthorizationCodeFlow</code> (<a href="#aggr-authorization-code-flow-class">§ 9.1.9 aggr:AuthorizationCodeFlow</a>)</p>
        <li data-md>
         <p><code>"device_code"</code> ↔ <code>aggr:DeviceCodeFlow</code> (<a href="#aggr-device-code-flow-class">§ 9.1.10 aggr:DeviceCodeFlow</a>)</p>
       </ul>
      <li data-md>
       <p><strong>aggregator</strong> (string, OPTIONAL): When present, the request targets an existing Aggregator Instance and the server
MUST replace its stored access token and refresh token with a new set obtained from the Identity Provider (IdP). 
This is not a refresh-token grant; it is a full re-authentication to obtain a fresh access token and refresh token.</p>
     </ul>
     <p>Depending on <code>registration_type</code>, additional members are defined:</p>
     <ul>
      <li data-md>
       <p><strong>registration_type: "none"</strong></p>
       <ul>
        <li data-md>
         <p>No additional members are required.</p>
       </ul>
       <p>In this flow the Aggregator Instance has no identity and all requests to upstream resource servers will be
unauthenticated. All hosted resources MUST be public or accessible without authentication. In this flow the 
registration post request MIGHT not require authentication, depending on the deployment’s policy.</p>
      <li data-md>
       <p><strong>registration_type: "provision"</strong></p>
       <ul>
        <li data-md>
         <p>No additional members are required.</p>
       </ul>
       <p>In this flow the Aggregator server MUST provision an identity for the Aggregator Instance that is
registered at the Identity Provider (IdP).</p>
      <li data-md>
       <p><strong>registration_type: "authorization_code"</strong>
The <code>authorization_code</code> flow uses two <code>POST</code> messages to the <code>registration_endpoint</code>. It is based on the OAuth 
2.0 Authorization Code grant <a data-link-type="biblio" href="#biblio-rfc6749" title="The OAuth 2.0 Authorization Framework">[RFC6749]</a> (https://datatracker.ietf.org/doc/html/rfc6749). The <strong>Start Request</strong> 
bootstraps PKCE <a data-link-type="biblio" href="#biblio-rfc7636" title="Proof Key for Code Exchange by OAuth Public Clients">[RFC7636]</a>, the request body MUST include:</p>
       <ul>
        <li data-md>
         <p><strong>registration_type</strong> (string, REQUIRED): <code>"authorization_code"</code>.</p>
        <li data-md>
         <p><strong>authorization_server</strong> (string, REQUIRED): The URL of the UMA Authorization Server that governs access to
resources exposed by the Aggregator.</p>
       </ul>
       <p>The server MUST respond with <code>201 Created</code> and a JSON object containing:</p>
       <ul>
        <li data-md>
         <p><strong>aggregator_client_id</strong> (string, REQUIRED): The Client ID Document of the aggregator.</p>
        <li data-md>
         <p><strong>code_challenge</strong> (string, REQUIRED)</p>
        <li data-md>
         <p><strong>code_challenge_method</strong> (string, REQUIRED)</p>
        <li data-md>
         <p><strong>state</strong> (string, REQUIRED)</p>
       </ul>
       <p>The server MAY also include IdP discovery hints (for example <code>issuer</code> or <code>authorization_endpoint</code>) if
the client cannot determine them through other means.</p>
       <p>The <strong>Finish Request</strong> redeems the authorization code, the request body MUST include:</p>
       <ul>
        <li data-md>
         <p><strong>registration_type</strong> (string, REQUIRED): <code>"authorization_code"</code>.</p>
        <li data-md>
         <p><strong>code</strong> (string, REQUIRED): The authorization code issued by the IdP.</p>
        <li data-md>
         <p><strong>redirect_uri</strong> (string, REQUIRED): The redirect URI used in the authorization request.</p>
        <li data-md>
         <p><strong>state</strong> (string, REQUIRED): The <code>state</code> returned by the start request.</p>
       </ul>
       <p>The finish request reuses the stored <code>authorization_server</code> from the start request and the client SHOULD NOT
include it again. This flow uses two Client ID Documents: the Aggregator Client ID Document and
the application Client ID Document identified by the client_id URI in the <code>aud</code> claim. If the Aggregator Client ID 
Document (<a href="#client-id-document">§ 4.2 Client ID Document</a>) doesn’t have
<code>redirect_uris</code> registered, the Aggregator Server MUST verify that <code>redirect_uri</code> in the request matches one of 
the redirect URIs registered in the Client ID Document of the client application. The client application’s
Client ID Document MUST be the client_id URI in the <code>aud</code> claim of the <code>IDP_client_token</code> from the authorization header
in the <strong>Start Request</strong> request. If the <code>aud</code> claim is missing or does not contain a dereferenceable client
identifier, the server MUST respond with <code>400 Bad Request</code>. In deployments where the client application does not
have a Client ID Document, the Aggregator Server MUST require <code>redirect_uris</code> to be registered in the 
Aggregator Client ID Document which will be validated by the IDP. If the Aggregator Client ID Document has 
<code>redirect_uris</code> registered, it MAY skip the Client ID Document check of the client application. In all cases, 
the server MUST verify that the <code>state</code> matches the stored state for the pending registration.</p>
      <li data-md>
       <p><strong>registration_type: "device_code"</strong>
The <code>device_code</code> flow uses two <code>POST</code> messages to the <code>registration_endpoint</code> and follows the OAuth 2.0
Device Authorization Grant <a data-link-type="biblio" href="#biblio-rfc8628" title="OAuth 2.0 Device Authorization Grant">[RFC8628]</a>. This flow is intended for headless components (for example CLI tools) 
to authenticate an Aggregator Instance where the <code>authorization_code</code> flow is not practical. The <strong>Start Request</strong> 
initiates device authorization flow and the request body MUST include:</p>
       <ul>
        <li data-md>
         <p><strong>registration_type</strong> (string, REQUIRED): <code>"device_code"</code>.</p>
        <li data-md>
         <p><strong>authorization_server</strong> (string, REQUIRED): The URL of the UMA Authorization Server that governs access to
resources exposed by the Aggregator.</p>
       </ul>
       <p>The server MUST determine the IdP from the <code>IDP_client_token</code> in the authorization header (for example,
via the <code>iss</code> claim and discovery), request device authorization at the IdP, securely store the returned 
device_code, and respond with 201 Created and a JSON object containing:</p>
       <ul>
        <li data-md>
         <p><strong>state</strong> (string, REQUIRED): Opaque value used by the client to poll completion of the device flow.</p>
        <li data-md>
         <p><strong>user_code</strong> (string, REQUIRED): The end-user verification code issued by the IdP.</p>
        <li data-md>
         <p><strong>verification_uri</strong> (string, REQUIRED): The end-user verification URI on the IdP.</p>
        <li data-md>
         <p><strong>verification_uri_complete</strong> (string, OPTIONAL): A verification URI that includes the "user_code" (or other
information with the same function as the "user_code"), which is designed for non-textual transmission.</p>
        <li data-md>
         <p><strong>expires_in</strong> (number, REQUIRED): The lifetime in seconds of the device authorization session.</p>
        <li data-md>
         <p><strong>interval</strong> (number, OPTIONAL): Minimum polling interval in seconds, this may differ from the interval the
IdP recommends.</p>
       </ul>
       <p>The <code>device_code</code> is confidential and MUST NOT be returned to the client. The <strong>Poll Request</strong> checks whether the
user has authorized the device code. The client uses the <code>state</code> value to poll for completion, the request body 
MUST include:</p>
       <ul>
        <li data-md>
         <p><strong>registration_type</strong> (string, REQUIRED): <code>"device_code"</code>.</p>
        <li data-md>
         <p><strong>state</strong> (string, REQUIRED): The <code>state</code> value returned by the start request.</p>
       </ul>
       <p>Unlike a traditional OAuth device flow, the client does not poll the IdP directly. Upon receiving a poll request,
the Aggregator MUST attempt to redeem the stored device_code at the IdP token endpoint 
(grant_type=urn:ietf:params:oauth:grant-type:device_code). If authorization is not yet complete, the server MUST 
respond with 202 Accepted. When authorization succeeds, the server creates (or updates) the Aggregator Instance and 
responds as for other successful create/update operations (see below). If the device authorization session has 
expired, the server MUST respond with 400 Bad Request. The device authorization session MUST be bound to the 
authenticated caller.</p>
     </ul>
     <p><strong>Success responses</strong>
For successful <code>POST</code> requests that create/update an Aggregator Instance (i.e., provision, the 
authorization_code finish request, and successful device_code poll requests), the server MUST respond with:</p>
     <ul>
      <li data-md>
       <p><code>201 Created</code> when it created a new Aggregator Instance (i.e., no <code>aggregator</code> was provided).</p>
      <li data-md>
       <p><code>200 OK</code> when it replaced the token set for an existing Aggregator Instance (i.e., <code>aggregator</code> was provided).</p>
     </ul>
     <p>For successful <code>POST</code> requests that create/update an Aggregator Instance (i.e., all types except the
<code>authorization_code</code> and <code>device_code</code> start requests), the response MUST be a JSON object and MUST include:</p>
     <ul>
      <li data-md>
       <p><strong>aggregator</strong> (string, REQUIRED): Absolute URL of the Aggregator Instance base URL that dereferences to
the Aggregator Description (<a href="#aggregator-description">§ 7.1 Aggregator Description</a>).</p>
      <li data-md>
       <p><strong>subject</strong> (string, OPTIONAL): The WebID or Client_ID for which OIDC tokens were created. This MUST be
added to the response when the request was a registration type <code>provision</code>.</p>
      <li data-md>
       <p><strong>idp</strong> (string, OPTIONAL): The Identity Provider (IdP) that issued the OIDC tokens for the Aggregator
Instance. This MUST be added to the response when the request was a registration type <code>provision</code> and
the subject is not a WebID.</p>
     </ul>
     <p>The server MUST NOT return any IdP access tokens, refresh tokens, or user credentials to the client.
When a registration flow completes successfully (for example <code>provision</code>, <code>authorization_code</code> finish, or a successful
<code>device_code</code> poll), the server obtains and stores an IdP access token for the Aggregator Instance (the
<code>IDP_aggregator_token</code>) and an optionally accompanying refresh token. These tokens are used by the Aggregator for 
upstream access and are not returned to the client.</p>
     <p><strong>Token replacement rules</strong>
To update the tokens for an existing Aggregator Instance, the client MUST include the <code>aggregator</code> member along with 
the other required members for the selected <code>registration_type</code>. This SHOULD only be done for the following 
<code>registration_type</code> values, for other values the server SHOULD respond with <code>400 Bad Request</code>:</p>
     <ul>
      <li data-md>
       <p><code>authorization_code</code>: To obtain a new access token and refresh token after the previous ones have expired.</p>
      <li data-md>
       <p><code>device_code</code>: To obtain a new access token and refresh token after the previous ones have expired.</p>
     </ul>
    <dt data-md><code>GET</code>
    <dd data-md>
     <p>This method returns the list of Aggregator Instances owned by the authenticated user. The server MUST respond with
<code>200 OK</code> and a JSON array containing zero or more Aggregator Description URLs (<a href="#aggregator-description">§ 7.1 Aggregator Description</a>).</p>
    <dt data-md><code>DELETE</code>
    <dd data-md>
     <p>Deletes an existing Aggregator Instance. The request body MUST use a content type listed in
<code>registration_request_formats_supported</code>. When using <code>application/json</code>, the body MUST be a JSON object.
When using <code>application/x-www-form-urlencoded</code>, the body parameters MUST be encoded as form fields with
the same member names. The request body MUST include:</p>
     <ul>
      <li data-md>
       <p><strong>aggregator</strong> (string, REQUIRED): Absolute URL of the Aggregator Instance base URL that dereferences to
the Aggregator Description (<a href="#aggregator-description">§ 7.1 Aggregator Description</a>).</p>
     </ul>
     <p>If deletion succeeds the server MUST respond with <code>204 No Content</code>.</p>
   </dl>
   <p>For error conditions, the server MUST respond with:</p>
   <ul>
    <li data-md>
     <p><code>400 Bad Request</code> for a malformed request body or missing/invalid request members for the selected <code>registration_type</code>.</p>
    <li data-md>
     <p><code>401 Unauthorized</code> when the request is missing authentication or when the <code>IDP_client_token</code> is invalid.</p>
    <li data-md>
     <p><code>403 Forbidden</code> when the authenticated user is not allowed to manage the requested Aggregator Instance.</p>
    <li data-md>
     <p><code>404 Not Found</code> when <code>aggregator</code> is provided but does not identify an existing Aggregator Instance. A <code>403 Forbidden</code>
MAY also be returned in this case.</p>
    <li data-md>
     <p><code>415 Unsupported Media Type</code> when the request format is not listed in <code>registration_request_formats_supported</code>.</p>
   </ul>
   <h3 class="heading settled" data-level="5.2" id="aggregator-management-flows"><span class="secno">5.2. </span><span class="content">Aggregator Management Flows (Non-normative)</span><a class="self-link" href="#aggregator-management-flows"></a></h3>
   
This section gives non-normative examples of how a client can use the <code>registration_endpoint</code> to create,
delete, and re-authenticate an Aggregator Instance.


   <h4 class="heading settled" data-level="5.2.1" id="creation-provision"><span class="secno">5.2.1. </span><span class="content">Creation <code>provision</code> Flow</span><a class="self-link" href="#creation-provision"></a></h4>
   <p>The <code>provision</code> flow allows clients to create an Aggregator with its own identity.
This lets resource owners target access-control policies at the aggregator’s dedicated WebID instead of having
the aggregator impersonate another user’s WebID.</p>
   <p><strong>1. Client starts flow with Aggregator Server</strong></p>
   <p>The client calls the registration endpoint authenticated with its <code>IDP_client_token</code>.</p>
   <div class="example" id="example-fda899ad">
    <a class="self-link" href="#example-fda899ad"></a>

<pre class="highlight language-http"><c- nf>POST</c-> <c- nn>/registration</c-> <c- kr>HTTP</c-><c- o>/</c-><c- m>1.1</c->
<c- e>Authorization</c-><c- o>:</c-> <c- l>Bearer &lt;IDP_client_token></c->
<c- e>Content-Type</c-><c- o>:</c-> <c- l>application/json</c->

<c- p>{</c->
  <c- f>"registration_type"</c-><c- p>:</c-> <c- u>"provision"</c->
<c- p>}</c->
</pre>
   </div>
   <p><strong>2. Aggregator Server provisions an account at an IDP</strong></p>
   <p>The Aggregator Server provisions an account at an IDP.
This might be linked to a WebID document that conforms to the WebID Profile specification <a data-link-type="biblio" href="#biblio-webid-profile" title="WebID Profile">[WEBID-PROFILE]</a>.
Using the credentials of this account the Aggregator Server can perform a client credentials grant to obtain
the <code>IDP_aggregator_token</code> (and accompanying refresh token) to authorize the aggregator acting under its own
WebID.</p>
   <p><strong>3. Aggregator Server creates an aggregator</strong></p>
   <p>Using the obtained tokens, the Aggregator Server creates an aggregator linked to the user, and returns the
aggregator description (<a href="#aggregator-description">§ 7.1 Aggregator Description</a>).
The aggregator should not give these tokens or credentials to the client.</p>
   <div class="example" id="example-5a4cae7b">
    <a class="self-link" href="#example-5a4cae7b"></a>

<pre class="highlight language-http"><c- kr>HTTP</c-><c- o>/</c-><c- m>1.1</c-> <c- m>201</c-> <c- ne>Created</c->
<c- e>Content-Type</c-><c- o>:</c-> <c- l>application/json</c->

<c- p>{</c->
  <c- f>"aggregator"</c-><c- p>:</c-> <c- u>"https://aggregator.example/aggregators/agg-7890/"</c-><c- p>,</c->
  <c- f>"subject"</c-><c- p>:</c-> <c- u>"https://aggregator.example/webid#me"</c->
<c- p>}</c->
</pre>
   </div>
   <p>Or with a non-WebID subject:</p>
   <div class="example" id="example-304c375b">
    <a class="self-link" href="#example-304c375b"></a>

<pre class="highlight language-http"><c- kr>HTTP</c-><c- o>/</c-><c- m>1.1</c-> <c- m>201</c-> <c- ne>Created</c->
<c- e>Content-Type</c-><c- o>:</c-> <c- l>application/json</c->

<c- p>{</c->
  <c- f>"aggregator"</c-><c- p>:</c-> <c- u>"https://aggregator.example/aggregators/agg-7890/"</c-><c- p>,</c->
  <c- f>"subject"</c-><c- p>:</c-> <c- u>"aggregator@example.com"</c-><c- p>,</c->
  <c- f>"idp"</c-><c- p>:</c-> <c- u>"https://idp.example/"</c->
<c- p>}</c->
</pre>
   </div>
   <h4 class="heading settled" data-level="5.2.2" id="creation-authorization"><span class="secno">5.2.2. </span><span class="content">Creation <code>authorization_code</code> Flow</span><a class="self-link" href="#creation-authorization"></a></h4>
   <p>The <code>authorization_code</code> flow allows clients to create an aggregator that acts on behalf of the end-user, but
with a token that is scoped specifically for the aggregator. This flow follows the OAuth 2.0 Authorization
Code grant <a data-link-type="biblio" href="#biblio-rfc6749" title="The OAuth 2.0 Authorization Framework">[RFC6749]</a> (https://datatracker.ietf.org/doc/html/rfc6749).</p>
   <p><img alt="PlantUML Diagram" src="uml/deec535dc3f87ed134bdf6b424eb7f9854c54de7.svg"></p>
   <p><strong>1. Client starts flow with Aggregator Server</strong></p>
   <p>The client begins by asking the Aggregator to bootstrap an authorization_code registration and indicate which
authorization server should be used. The Aggregator identifies the client application from the
<code>IDP_client_token</code> and responds with the public parameters required for the OIDC authorization request.</p>
   <div class="example" id="example-aacab791">
    <a class="self-link" href="#example-aacab791"></a>

<pre class="highlight language-http"><c- nf>POST</c-> <c- nn>/registration</c-> <c- kr>HTTP</c-><c- o>/</c-><c- m>1.1</c->
<c- e>Authorization</c-><c- o>:</c-> <c- l>Bearer &lt;IDP_client_token></c->
<c- e>Content-Type</c-><c- o>:</c-> <c- l>application/json</c->

<c- p>{</c->
  <c- f>"registration_type"</c-><c- p>:</c-> <c- u>"authorization_code"</c-><c- p>,</c->
  <c- f>"authorization_server"</c-><c- p>:</c-> <c- u>"https://as.example"</c->
<c- p>}</c->
</pre>
   </div>
   <p><strong>1.2 Aggregator responds with public parameters</strong></p>
   <p>The Aggregator generates the PKCE verifier/challenge pair plus a random <code>state</code>, persists them together with
the pending registration, and returns only the public portions (<code>aggregator_client_id</code>, <code>code_challenge</code>,
<code>code_challenge_method</code>, <code>state</code>) to the client application. The <code>authorization_server</code> value identifies the
UMA Authorization Server (AS) that governs access to resources exposed by the Aggregator. The aggregator uses
the <code>IDP_client_token</code> to identify the user’s IdP and Application Client ID Document for the subsequent OIDC
exchange.</p>
   <div class="example" id="example-1405d0cd">
    <a class="self-link" href="#example-1405d0cd"></a>

<pre class="highlight language-http"><c- kr>HTTP</c-><c- o>/</c-><c- m>1.1</c-> <c- m>201</c-> <c- ne>Created</c->
<c- e>Content-Type</c-><c- o>:</c-> <c- l>application/json</c->

<c- p>{</c->
  <c- f>"aggregator_client_id"</c-><c- p>:</c-> <c- u>"https://aggregator.example/client.jsonld"</c-><c- p>,</c->
  <c- f>"code_challenge"</c-><c- p>:</c-> <c- u>"1uLSZp2..."</c-><c- p>,</c->
  <c- f>"code_challenge_method"</c-><c- p>:</c-> <c- u>"S256"</c-><c- p>,</c->
  <c- f>"state"</c-><c- p>:</c-> <c- u>"1eb7c8f5..."</c->
<c- p>}</c->
</pre>
   </div>
   <p><strong>2. Client sends the end-user through the IDP authorization endpoint</strong></p>
   <p>Using the information supplied by the Aggregator, the client constructs an authorization request against the IdP.</p>
   <div class="example" id="example-4e262fa9">
    <a class="self-link" href="#example-4e262fa9"></a>

<pre class="highlight language-http">GET https://idp.example/authorize?
    response_type=code&amp;
    client_id=https%3A%2F%2Faggregator.example%2Fclient.jsonld&amp;
    redirect_uri=https%3A%2F%2Fapp.example%2Fcallback&amp;
    scope=openid%20webid%20offline_access&amp;
    code_challenge=1uLSZp2...&amp;
    code_challenge_method=S256&amp;
    state=1eb7c8f5...
</pre>
   </div>
   <p><strong>2.1 IDP dereferences the Aggregator Client ID Document</strong></p>
   <p>If the IDP does not already have the <code>aggregator_client_id</code> registered, it dereferences the Aggregator’s
Client ID Document to retrieve the client metadata (for example redirect URIs and other policy-required fields).</p>
   <p><strong>3. User authenticates and consents at the IDP</strong></p>
   <p>The IDP performs its usual login and consent screens, after which it issues an authorization_code tied to the
Aggregator’s client.</p>
   <p><strong>4. IDP redirects the user agent back to the client’s redirect_uri</strong></p>
   <p>The IDP redirects the user agent back to the client application with the authorization code and the original <code>state</code>.</p>
   <div class="example" id="example-8056924a">
    <a class="self-link" href="#example-8056924a"></a>

<pre class="highlight language-http"><c- kr>HTTP</c-><c- o>/</c-><c- m>1.1</c-> <c- m>302</c-> <c- ne>Found</c->
<c- e>Location</c-><c- o>:</c-> <c- l>https://app.example/callback?code=SplxlOBeZQQYbYS6WxSbIA&amp;state=1eb7c8f5...</c->
</pre>
   </div>
   <p><strong>5. Client posts the authorization code back to the Aggregator</strong></p>
   <p>The client sends the code, redirect URI, and echoed state to the registration endpoint so the Aggregator can finish the flow.</p>
   <div class="example" id="example-db4c31f6">
    <a class="self-link" href="#example-db4c31f6"></a>

<pre class="highlight language-http"><c- nf>POST</c-> <c- nn>/registration</c-> <c- kr>HTTP</c-><c- o>/</c-><c- m>1.1</c->
<c- e>Authorization</c-><c- o>:</c-> <c- l>Bearer &lt;IDP_client_token></c->
<c- e>Content-Type</c-><c- o>:</c-> <c- l>application/json</c->

<c- p>{</c->
  <c- f>"registration_type"</c-><c- p>:</c-> <c- u>"authorization_code"</c-><c- p>,</c->
  <c- f>"code"</c-><c- p>:</c-> <c- u>"SplxlOBeZQQYbYS6WxSbIA"</c-><c- p>,</c->
  <c- f>"redirect_uri"</c-><c- p>:</c-> <c- u>"https://app.example/callback"</c-><c- p>,</c->
  <c- f>"state"</c-><c- p>:</c-> <c- u>"1eb7c8f5..."</c->
<c- p>}</c->
</pre>
   </div>
   <p><strong>5.1 Aggregator dereferences the client application’s Client ID Document</strong></p>
   <p>If no specific redirect URIs were given in the Client ID Document, the Aggregator dereferences the
<code>https://app.example/client.jsonld</code> JSON-LD document to confirm the registered redirect URIs. The aggregator then verifies 
that the supplied <code>redirect_uri</code> belongs to that set and that the returned <code>state</code> matches the stored state.</p>
   <p><strong>5.2 Aggregator redeems the authorization code at the IDP token endpoint</strong></p>
   <div class="example" id="example-bc068b46">
    <a class="self-link" href="#example-bc068b46"></a>

<pre class="highlight language-http"><c- nf>POST</c-> <c- nn>/token</c-> <c- kr>HTTP</c-><c- o>/</c-><c- m>1.1</c->
<c- e>Host</c-><c- o>:</c-> <c- l>idp.example</c->
<c- e>Content-Type</c-><c- o>:</c-> <c- l>application/x-www-form-urlencoded</c->
<c- e>Authorization</c-><c- o>:</c-> <c- l>Basic &lt;aggregator-client-auth></c->

<c- f>grant_type</c-><c- o>=</c-><c- s>authorization_code</c-><c- p>&amp;</c->
<c- f>code</c-><c- o>=</c-><c- s>SplxlOBeZQQYbYS6WxSbIA</c-><c- p>&amp;</c->
<c- f>redirect_uri</c-><c- o>=</c-><c- s>https%3A%2F%2Fapp.example%2Fcallback</c-><c- p>&amp;</c->
<c- f>client_id</c-><c- o>=</c-><c- s>https%3A%2F%2Faggregator.example%2Fclient.jsonld</c-><c- p>&amp;</c->
<c- f>code_verifier</c-><c- o>=</c-><c- s>Hjs8...stored...</c->
</pre>
   </div>
   <p>The IDP verifies the authorization_code, ensures the redirect_uri matches the original authorization request,
and recomputes the PKCE challenge from the supplied <code>code_verifier</code>. If everything matches, it returns:</p>
   <div class="example" id="example-c7298ed8">
    <a class="self-link" href="#example-c7298ed8"></a>

<pre class="highlight language-http"><c- kr>HTTP</c-><c- o>/</c-><c- m>1.1</c-> <c- m>200</c-> <c- ne>OK</c->
<c- e>Content-Type</c-><c- o>:</c-> <c- l>application/json</c->

<c- p>{</c->
  <c- f>"access_token"</c-><c- p>:</c-> <c- u>"&lt;IDP_aggregator_token>"</c-><c- p>,</c->
  <c- f>"refresh_token"</c-><c- p>:</c-> <c- u>"&lt;refresh_token>"</c-><c- p>,</c->
  <c- f>"token_type"</c-><c- p>:</c-> <c- u>"Bearer"</c-><c- p>,</c->
  <c- f>"expires_in"</c-><c- p>:</c-> <c- mi>3600</c->
<c- p>}</c->
</pre>
   </div>
   <p><strong>5.3 Aggregator finalizes the account and responds</strong></p>
   <p>Using the issued tokens, the Aggregator creates the aggregator account linked to the user and returns the
aggregator description (<a href="#aggregator-description">§ 7.1 Aggregator Description</a>).</p>
   <div class="example" id="example-6848442c">
    <a class="self-link" href="#example-6848442c"></a>

<pre class="highlight language-http"><c- kr>HTTP</c-><c- o>/</c-><c- m>1.1</c-> <c- m>201</c-> <c- ne>Created</c->
<c- e>Content-Type</c-><c- o>:</c-> <c- l>application/json</c->

<c- p>{</c->
  <c- f>"aggregator"</c-><c- p>:</c-> <c- u>"https://aggregator.example/aggregators/agg-6780/"</c->
<c- p>}</c->
</pre>
   </div>
   <h4 class="heading settled" data-level="5.2.3" id="creation-device-code"><span class="secno">5.2.3. </span><span class="content">Creation <code>device_code</code> Flow</span><a class="self-link" href="#creation-device-code"></a></h4>
   <p>The <code>device_code</code> flow allows headless components (for example CLI tools) to authenticate an Aggregator
Instance by using the OAuth 2.0 Device Authorization Grant <a data-link-type="biblio" href="#biblio-rfc8628" title="OAuth 2.0 Device Authorization Grant">[RFC8628]</a>.</p>
   <p><img alt="PlantUML Diagram" src="uml/a12c6f7df76b4b8687e24d18c25d7ec5dc259807.svg"></p>
   <p><strong>1. Client starts flow with Aggregator Server</strong></p>
   <p>The client calls the registration endpoint authenticated with its <code>IDP_client_token</code>, indicating the
authorization server that governs access to resources exposed by the Aggregator.</p>
   <div class="example" id="example-55946594">
    <a class="self-link" href="#example-55946594"></a>

<pre class="highlight language-http"><c- nf>POST</c-> <c- nn>/registration</c-> <c- kr>HTTP</c-><c- o>/</c-><c- m>1.1</c->
<c- e>Authorization</c-><c- o>:</c-> <c- l>Bearer &lt;IDP_client_token></c->
<c- e>Content-Type</c-><c- o>:</c-> <c- l>application/json</c->

<c- p>{</c->
  <c- f>"registration_type"</c-><c- p>:</c-> <c- u>"device_code"</c-><c- p>,</c->
  <c- f>"authorization_server"</c-><c- p>:</c-> <c- u>"https://as.example"</c->
<c- p>}</c->
</pre>
   </div>
   <p><strong>1.1 Aggregator Server returns device authorization parameters</strong></p>
   <p>The Aggregator requests device authorization parameters from the IdP and returns the user code,
verification URI(s), and polling state to the client.</p>
   <div class="example" id="example-68586188">
    <a class="self-link" href="#example-68586188"></a>

<pre class="highlight language-http"><c- kr>HTTP</c-><c- o>/</c-><c- m>1.1</c-> <c- m>201</c-> <c- ne>Created</c->
<c- e>Content-Type</c-><c- o>:</c-> <c- l>application/json</c->

<c- p>{</c->
  <c- f>"state"</c-><c- p>:</c-> <c- u>"state-abc"</c-><c- p>,</c->
  <c- f>"user_code"</c-><c- p>:</c-> <c- u>"WDJB-MJHT"</c-><c- p>,</c->
  <c- f>"verification_uri"</c-><c- p>:</c-> <c- u>"https://idp.example/activate"</c-><c- p>,</c->
  <c- f>"verification_uri_complete"</c-><c- p>:</c-> <c- u>"https://idp.example/activate?user_code=WDJB-MJHT"</c-><c- p>,</c->
  <c- f>"expires_in"</c-><c- p>:</c-> <c- mi>600</c-><c- p>,</c->
  <c- f>"interval"</c-><c- p>:</c-> <c- mi>5</c->
<c- p>}</c->
</pre>
   </div>
   <p><strong>2. User authorizes at the IdP</strong></p>
   <p>The client prompts the user to visit the verification URI and enter the user code to authorize access.</p>
   <p><strong>3. Client polls Aggregator Server</strong></p>
   <p>The client polls the registration endpoint using the <code>state</code> value, waiting at least the returned
<code>interval</code> (if provided) between polls. The Aggregator polls the IdP token endpoint using the stored
device code until the user authorizes or the device code expires.</p>
   <div class="example" id="example-44f49335">
    <a class="self-link" href="#example-44f49335"></a>

<pre class="highlight language-http"><c- nf>POST</c-> <c- nn>/registration</c-> <c- kr>HTTP</c-><c- o>/</c-><c- m>1.1</c->
<c- e>Authorization</c-><c- o>:</c-> <c- l>Bearer &lt;IDP_client_token></c->
<c- e>Content-Type</c-><c- o>:</c-> <c- l>application/json</c->

<c- p>{</c->
  <c- f>"registration_type"</c-><c- p>:</c-> <c- u>"device_code"</c-><c- p>,</c->
  <c- f>"state"</c-><c- p>:</c-> <c- u>"state-abc"</c->
<c- p>}</c->
</pre>
   </div>
   <p>If authorization is not yet complete, the Aggregator responds with <code>202 Accepted</code>:</p>
   <div class="example" id="example-0c5f9c95">
    <a class="self-link" href="#example-0c5f9c95"></a>

<pre class="highlight language-http"><c- kr>HTTP</c-><c- o>/</c-><c- m>1.1</c-> <c- m>202</c-> <c- ne>Accepted</c->
</pre>
   </div>
   <p>Once authorization succeeds, the Aggregator creates the Aggregator Instance and responds as for other
successful create operations:</p>
   <div class="example" id="example-be37bf48">
    <a class="self-link" href="#example-be37bf48"></a>

<pre class="highlight language-http"><c- kr>HTTP</c-><c- o>/</c-><c- m>1.1</c-> <c- m>201</c-> <c- ne>Created</c->
<c- e>Content-Type</c-><c- o>:</c-> <c- l>application/json</c->

<c- p>{</c->
  <c- f>"aggregator"</c-><c- p>:</c-> <c- u>"https://aggregator.example/aggregators/agg-5670/"</c->
<c- p>}</c->
</pre>
   </div>
   <p><strong>Example server-side token polling (Non-normative)</strong></p>
   <p>While polling, the IdP can return an authorization-pending error:</p>
   <div class="example" id="example-f241f144">
    <a class="self-link" href="#example-f241f144"></a>

<pre class="highlight language-http"><c- nf>POST</c-> <c- nn>/token</c-> <c- kr>HTTP</c-><c- o>/</c-><c- m>1.1</c->
<c- e>Host</c-><c- o>:</c-> <c- l>idp.example</c->
<c- e>Content-Type</c-><c- o>:</c-> <c- l>application/x-www-form-urlencoded</c->

<c- f>grant_type</c-><c- o>=</c-><c- s>urn:ietf:params:oauth:grant-type:device_code</c-><c- p>&amp;</c->
<c- f>device_code</c-><c- o>=</c-><c- s>GmRhmhcxhwAzkoEqiMEg_DnyEysNkuNhszIySk9eS</c->
</pre>
   </div>
   <div class="example" id="example-4b9f1703">
    <a class="self-link" href="#example-4b9f1703"></a>

<pre class="highlight language-http"><c- kr>HTTP</c-><c- o>/</c-><c- m>1.1</c-> <c- m>400</c-> <c- ne>Bad Request</c->
<c- e>Content-Type</c-><c- o>:</c-> <c- l>application/json</c->

<c- p>{</c->
  <c- f>"error"</c-><c- p>:</c-> <c- u>"authorization_pending"</c->
<c- p>}</c->
</pre>
   </div>
   <p>Once the user completes authorization, the IdP returns the token set:</p>
   <div class="example" id="example-9b4d3749">
    <a class="self-link" href="#example-9b4d3749"></a>

<pre class="highlight language-http"><c- kr>HTTP</c-><c- o>/</c-><c- m>1.1</c-> <c- m>200</c-> <c- ne>OK</c->
<c- e>Content-Type</c-><c- o>:</c-> <c- l>application/json</c->

<c- p>{</c->
  <c- f>"access_token"</c-><c- p>:</c-> <c- u>"&lt;IDP_aggregator_token>"</c-><c- p>,</c->
  <c- f>"refresh_token"</c-><c- p>:</c-> <c- u>"&lt;refresh_token>"</c-><c- p>,</c->
  <c- f>"token_type"</c-><c- p>:</c-> <c- u>"Bearer"</c-><c- p>,</c->
  <c- f>"expires_in"</c-><c- p>:</c-> <c- mi>7200</c->
<c- p>}</c->
</pre>
   </div>
   <h4 class="heading settled" data-level="5.2.4" id="token-update"><span class="secno">5.2.4. </span><span class="content">Token Update Flow</span><a class="self-link" href="#token-update"></a></h4>
   <p>This flow allows users to replace the stored access token and refresh token for an existing Aggregator Instance.
This is not a refresh-token grant: even refresh tokens can expire, so the client repeats the original
registration flow to obtain a new set of tokens (and refresh tokens) for the Aggregator Instance.</p>
   <p>The flow is the same as creating an Aggregator Instance but an <code>aggregator</code> member is provided in the start request.
The exact steps depend on the <code>registration_type</code> used when creating the Aggregator Instance.
For example, for the <code>authorization_code</code> flow:</p>
   <div class="example" id="example-5a534bad">
    <a class="self-link" href="#example-5a534bad"></a>

<pre class="highlight language-http"><c- nf>POST</c-> <c- nn>/registration</c-> <c- kr>HTTP</c-><c- o>/</c-><c- m>1.1</c->
<c- e>Authorization</c-><c- o>:</c-> <c- l>Bearer &lt;IDP_client_token></c->
<c- e>Content-Type</c-><c- o>:</c-> <c- l>application/json</c->
{
    <c- f>"registration_type"</c-><c- p>:</c-> <c- u>"authorization_code"</c-><c- p>,</c->
    <c- f>"aggregator"</c-><c- p>:</c-> <c- u>"https://aggregator.example/aggregators/agg-7890/"</c->
<c- p>}</c->
</pre>
   </div>
   <h4 class="heading settled" data-level="5.2.5" id="aggregator-listing"><span class="secno">5.2.5. </span><span class="content">Aggregator Listing Flow</span><a class="self-link" href="#aggregator-listing"></a></h4>
   <p>This flow allows users to list Aggregator Instances by sending a <code>GET</code> request to the <code>registration_endpoint</code>.</p>
   <div class="example" id="example-768f98fe">
    <a class="self-link" href="#example-768f98fe"></a>

<pre class="highlight language-http"><c- nf>GET</c-> <c- nn>/registration</c-> <c- kr>HTTP</c-><c- o>/</c-><c- m>1.1</c->
<c- e>Authorization</c-><c- o>:</c-> <c- l>Bearer &lt;IDP_client_token></c->
</pre>
   </div>
   <div class="example" id="example-26c34fa9">
    <a class="self-link" href="#example-26c34fa9"></a>

<pre class="highlight language-http"><c- kr>HTTP</c-><c- o>/</c-><c- m>1.1</c-> <c- m>200</c-> <c- ne>OK</c->
<c- e>Content-Type</c-><c- o>:</c-> <c- l>application/json</c->

<c- p>[</c->
  <c- u>"https://aggregator.example/aggregators/agg-7890/"</c-><c- p>,</c->
  <c- u>"https://aggregator.example/aggregators/agg-9012/"</c->
<c- p>]</c->
</pre>
   </div>
   <h4 class="heading settled" data-level="5.2.6" id="aggregator-deletion"><span class="secno">5.2.6. </span><span class="content">Aggregator Deletion Flow</span><a class="self-link" href="#aggregator-deletion"></a></h4>
   <p>This flow allows users to delete an existing Aggregator Instance by sending a <code>DELETE</code> request to the
<code>registration_endpoint</code> with the <code>aggregator</code> member.</p>
   <div class="example" id="example-d6e96089">
    <a class="self-link" href="#example-d6e96089"></a>

<pre class="highlight language-http"><c- nf>DELETE</c-> <c- nn>/registration</c-> <c- kr>HTTP</c-><c- o>/</c-><c- m>1.1</c->
<c- e>Authorization</c-><c- o>:</c-> <c- l>Bearer &lt;IDP_client_token></c->
<c- e>Content-Type</c-><c- o>:</c-> <c- l>application/json</c->
{
    <c- f>"aggregator"</c-><c- p>:</c-> <c- u>"https://aggregator.example/aggregators/agg-7890/"</c->
<c- p>}</c->
</pre>
   </div>
   <h2 class="heading settled" data-level="6" id="aggregator-security-model"><span class="secno">6. </span><span class="content">Aggregator Security Model (Authentication &amp; Authorization)</span><a class="self-link" href="#aggregator-security-model"></a></h2>
   <p>This section describes how the Aggregator handles authentication and authorization for:</p>
   <ul>
    <li data-md>
     <p>outgoing requests from the Aggregator to upstream Resource Servers; and</p>
    <li data-md>
     <p>incoming requests from Clients to the Aggregator.</p>
   </ul>
   <p>The Aggregator relies on the Authorization for Data Spaces (A4DS) specification <a data-link-type="biblio" href="#biblio-a4ds" title="Authorization for Data Spaces (A4DS)">[A4DS]</a> to authenticate Clients and
authorize access to resources. For streaming or non-HTTP interfaces, the Aggregator MAY additionally use the Service 
Authorization for Data Spaces (SA4DS) specification <a data-link-type="biblio" href="#biblio-sa4ds" title="Service Authorization for Data Spaces (SA4DS)">[SA4DS]</a>. All Aggregator endpoints are protected using User-Managed 
Access (UMA) <a data-link-type="biblio" href="#biblio-uma" title="User-Managed Access (UMA) 2.0">[UMA]</a>.</p>
   <p>In this section, the <strong>Upstream Resource Server (URS)</strong> is the Resource Server that hosts the original data the
Aggregator consumes. The <strong>Upstream Authorization Server (UAS)</strong> is the Authorization Server that protects that URS and
issues access tokens for those upstream resources. The <strong>Aggregator Authorization Server (AAS)</strong> is the Authorization
Server that protects the Aggregator itself and issues tokens (e.g., UMA RPTs) for access to derived resources.</p>
   <p class="note" role="note"><span class="marker">NOTE:</span> The following behavior extends the A4DS specification and is intended to be incorporated in a future version of A4DS.</p>
   <h3 class="heading settled" data-level="6.1" id="requesting-flow"><span class="secno">6.1. </span><span class="content">Upstream Access (Requesting)</span><a class="self-link" href="#requesting-flow"></a></h3>
   <p><strong>Normative requirements</strong></p>
   <p>The Aggregator Service MUST obtain upstream access tokens according to A4DS and UMA and MUST present the ID token
(<code>IDP_aggregator_token</code>) obtained during aggregator registration (<a href="#aggregator-registration">§ 5.1 Aggregator Registration Endpoint</a>). When the Aggregator 
Service intends to create derived resources, it MUST request scope <code>urn:knows:uma:scopes:derivation-creation</code>. The 
Aggregator Service MAY include a transformation description immediately. If not, the Upstream Authorization Server MAY 
require transformation description claims; if it does, it MUST respond with a UMA <code>need_info</code> error and <code>required_claims</code> 
as defined by A4DS. If the UAS requests it via <code>need_info</code>, the Aggregator Service MUST include a transformation 
description claim token using UMA claims pushing (<a data-link-type="biblio" href="#biblio-a4ds" title="Authorization for Data Spaces (A4DS)">[A4DS]</a>). The <code>claim_type</code> for this description is 
<code>https://spec.knows.idlab.ugent.be/aggregator-protocol/latest/#transformation-description</code>. The <code>claim_token_format</code>
values identify acceptable RDF serializations as URIs (e.g., <code>http://www.w3.org/ns/formats/Turtle</code>).</p>
   <p>If the UAS allows, the Aggregator Service to create this derived resource it MUST include a <code>derivation_resource_id</code> field
in the response next to the access token. This <code>derivation_resource_id</code> is a unique identifier that links the requested data 
and the intended transformation to the derived resource that the Aggregator Service will create. If the Aggregator Service 
previously obtained a <code>derivation_resource_id</code> for the same upstream resource and transformation, it SHOULD include it in 
the token request using the <code>derivation_resource_id</code> field. If the hint is still valid and bound to the authenticated 
Aggregator and resource, the UAS SHOULD reuse it; otherwise it SHOULD ignore it and issue a new identifier. The UAS MUST 
include a <code>derivation_resource_id</code> in successful access-token responses for derivation creation. Access tokens MAY be 
reused until they expire or are revoked.</p>
   <p>The Aggregator Service MUST modify the asset (<a data-link-type="biblio" href="#biblio-a4ds" title="Authorization for Data Spaces (A4DS)">[A4DS]</a>) representing the derived resource on the AAS with a <code>derived_from</code>
entry containing the <code>issuer</code> (the UAS) and <code>derivation_resource_id</code>, and the AAS MUST expire previous access tokens 
for that derived resource. The Aggregator Service SHOULD only use the data from resource after a successful resource 
registration update at the AAS. When a derived resource is no longer used, the Aggregator Service SHOULD remove the 
<code>derived_from</code> entry, MAY expire previous access tokens, and SHOULD delete the <code>derivation_resource_id</code> at the UAS.</p>
   <p class="issue" id="issue-3e489c46"><a class="self-link" href="#issue-3e489c46"></a> How should the Aggregator Service delete the <code>derivation_resource_id</code> at the UAS?</p>
   <p><strong>Non-normative flow and examples</strong></p>
   <p><img alt="PlantUML Diagram" src="uml/669783804232596bae20ca25e05bccdf94541936.svg"></p>
   <p><strong>1. Requesting the upstream resource without token</strong></p>
   <p>The Aggregator Service requests the upstream resource without an access token. If the resource is protected
with UMA, the Upstream Resource Server responds with a <code>401 Unauthorized</code> status and a UMA ticket.</p>
   <div class="example" id="example-ed9c0e3b">
    <a class="self-link" href="#example-ed9c0e3b"></a>

<pre class="highlight language-http"><c- nf>GET</c-> <c- nn>/resource/123</c-> <c- kr>HTTP</c-><c- o>/</c-><c- m>1.1</c->
<c- e>Host</c-><c- o>:</c-> <c- l>upstream.example.org</c->
</pre>
   </div>
   <p><strong>1.1 URS requests ticket from UAS</strong></p>
   <p>The Upstream Resource Server requests a UMA ticket from its Upstream Authorization Server, as described in A4DS (<a data-link-type="biblio" href="#biblio-a4ds" title="Authorization for Data Spaces (A4DS)">[A4DS]</a>).</p>
   <p><strong>1.2 URS returns ticket</strong></p>
   <p>The Upstream Resource Server returns the ticket it got from the UAS to the Aggregator Service.</p>
   <div class="example" id="example-4a9c9701">
    <a class="self-link" href="#example-4a9c9701"></a>

<pre class="highlight language-http"><c- kr>HTTP</c-><c- o>/</c-><c- m>1.1</c-> <c- m>401</c-> <c- ne>Unauthorized</c->
<c- e>WWW-Authenticate</c-><c- o>:</c-> <c- l>UMA realm="solid", as_uri="https://upstream.as.example.org/uma", ticket="tkt-URS"</c->
</pre>
   </div>
   <p><strong>2. Requesting an access token from the UAS</strong></p>
   <p>Using the <code>IDP_aggregator_token</code> obtained during registration, the Aggregator Service requests an access token from the
Upstream Authorization Server (of the Upstream Resource Server). The request typically includes the derivation-creation 
scope when creating derived resources. If the Upstream Authorization Server needs details about the intended transformation, 
it can request them using UMA <code>need_info</code> with a transformation claim type:</p>
   <div class="example" id="example-e7501f8a">
    <a class="self-link" href="#example-e7501f8a"></a>

<pre class="highlight language-json"><c- p>{</c->
  <c- f>"error"</c-><c- p>:</c-> <c- u>"need_info"</c-><c- p>,</c->
  <c- f>"ticket"</c-><c- p>:</c-> <c- u>"d9c3b6f2-0f7a-4c6e-9d2f-1a7c4e9b8a21"</c-><c- p>,</c->
  <c- f>"required_claims"</c-><c- p>:</c-> <c- p>[</c->
    <c- p>{</c->
      <c- f>"claim_type"</c-><c- p>:</c-> <c- u>"https://spec.knows.idlab.ugent.be/aggregator-protocol/latest/#transformation-description"</c-><c- p>,</c->
      <c- f>"friendly_name"</c-><c- p>:</c-> <c- u>"Intended data transformation"</c-><c- p>,</c->
      <c- f>"claim_token_format"</c-><c- p>:</c-> <c- p>[</c->
        <c- u>"http://www.w3.org/ns/formats/Turtle"</c-><c- p>,</c->
        <c- u>"http://www.w3.org/ns/formats/JSON-LD"</c->
      <c- p>],</c->
      <c- f>"claim_description"</c-><c- p>:</c-> <c- u>"Describe the transformation that will be executed on the requested data (e.g. query, mapping, model, or workflow reference)."</c->
    <c- p>}</c->
  <c- p>]</c->
<c- p>}</c->
</pre>
   </div>
   <p>The Aggregator then resubmits the token request with an additional claim token describing the intended transformation.
If the service description or transformation catalogs are dereferenceable by the UAS, the Aggregator can provide those
URIs rather than embedding a full description.</p>
   <p>If the Aggregator has previously obtained a <code>derivation_resource_id</code> for the same upstream resource and transformation,
it should include it as a hint using the <code>derivation_resource_id</code> parameter.</p>
   <p>Example token request after a <code>need_info</code> response (includes transformation claim):</p>
   <div class="example" id="example-44f63fec">
    <a class="self-link" href="#example-44f63fec"></a>

<pre class="highlight language-http"><c- nf>POST</c-> <c- nn>/token</c-> <c- kr>HTTP</c-><c- o>/</c-><c- m>1.1</c->
<c- e>Host</c-><c- o>:</c-> <c- l>upstream.as.example.org</c->
<c- e>Content-Type</c-><c- o>:</c-> <c- l>application/json</c->
{
    <c- f>"grant_type"</c-><c- p>:</c-> <c- u>"urn:ietf:params:oauth:grant-type:uma-ticket"</c-><c- p>,</c->
    <c- f>"ticket"</c-><c- p>:</c-> <c- u>"tkt-URS"</c-><c- p>,</c->
    <c- f>"scope"</c-><c- p>:</c-> <c- u>"urn:knows:uma:scopes:derivation-creation"</c-><c- p>,</c->
    <c- f>"derivation_resource_id"</c-><c- p>:</c-> <c- u>"handle-id-1"</c-><c- p>,</c->
    <c- f>"claim_token"</c-><c- p>:</c-> <c- u>"&lt;transformation_description>"</c-><c- p>,</c->
    <c- f>"claim_token_format"</c-><c- p>:</c-> <c- u>"http://www.w3.org/ns/formats/Turtle"</c->
<c- p>}</c->
</pre>
   </div>
   <p><strong>2.1 UAS validates the IDP_aggregator_token</strong></p>
   <p>The Upstream Authorization Server validates the <code>IDP_aggregator_token</code> with the Identity Provider that issued it.</p>
   <p><strong>2.2 UAS returns access token and derivation resource identifier</strong></p>
   <p>Adding the derivation-creation scope signals to the Upstream Authorization Server that the Aggregator intends
to create a derived resource based on the requested upstream resource.
The Upstream Authorization Server includes a <code>derivation_resource_id</code> in the response. The <code>derivation_resource_id</code> is a
unique identifier that the Aggregator will use to reference this upstream resource when creating derived resources. The
Upstream Authorization Server can link this identifier to the Aggregator’s identity and intended use to manage and track
derived resources.</p>
   <div class="example" id="example-e8eb7071">
    <a class="self-link" href="#example-e8eb7071"></a>

<pre class="highlight language-http"><c- kr>HTTP</c-><c- o>/</c-><c- m>1.1</c-> <c- m>200</c-> <c- ne>OK</c->
<c- e>Content-Type</c-><c- o>:</c-> <c- l>application/json</c->
{
    <c- f>"access_token"</c-><c- p>:</c-> <c- u>"&lt;upstream_access_token>"</c-><c- p>,</c->
    <c- f>"derivation_resource_id"</c-><c- p>:</c-> <c- u>"handle-id-1"</c->
<c- p>}</c->
</pre>
   </div>
   <p><strong>3. Accessing the upstream resource with token</strong></p>
   <p>The Aggregator Service then requests the resource from the Upstream Resource Server using the access token
obtained from the Upstream Authorization Server.
This access token MAY be used multiple times until it expires or is revoked.</p>
   <p><strong>4. Resource registration of the Aggregator Service</strong></p>
   <p>Finally, the Aggregator Service updates the resource registration at its own Authorization Server to signal that it used
this <code>derivation_resource_id</code> to create derived resources.</p>
   <div class="example" id="example-0eba4989">
    <a class="self-link" href="#example-0eba4989"></a>

<pre class="highlight language-http"><c- nf>PUT</c-> <c- nn>/resource-registration/agg-service-123</c-> <c- kr>HTTP</c-><c- o>/</c-><c- m>1.1</c->
<c- e>Host</c-><c- o>:</c-> <c- l>as.example.org</c->
<c- e>Content-Type</c-><c- o>:</c-> <c- l>application/json</c->
{
  ...
  <c- f>"derived_from"</c-><c- p>:</c-> <c- p>[</c->
    <c- p>{</c->
      <c- f>"issuer"</c-><c- p>:</c-> <c- u>"https://as.example.org"</c-><c- p>,</c->
      <c- f>"derivation_resource_id"</c-><c- p>:</c-> <c- u>"handle-id-1"</c->
    <c- p>}</c->
  <c- p>]</c->
<c- p>}</c->
</pre>
   </div>
   <p>If a resource is no longer used, the Aggregator Service can update the resource registration to remove the
<code>derivation_resource_id</code> from the <code>derived_from</code> relations and delete the identifier at the Upstream Authorization
Server, following the Resource ID deletion procedure.</p>
   <h3 class="heading settled" data-level="6.2" id="serving-flow"><span class="secno">6.2. </span><span class="content">Client Access (Serving)</span><a class="self-link" href="#serving-flow"></a></h3>
   <p><strong>Normative requirements</strong></p>
   <p>All endpoints on the Aggregator SHOULD be protected using an AS defined during registration. The Aggregator acts as a
Resource Server in UMA terminology. So when the Aggregator receives a request without a valid Requesting Party Token (RPT) 
from a client it MUST request a UMA ticket from its Authorization Server and return <code>401 Unauthorized</code> with that ticket.
RPT validity is discussed in more detail in <a data-link-type="biblio" href="#biblio-a4ds" title="Authorization for Data Spaces (A4DS)">[A4DS]</a>. If this is a request for a derived resource, the Aggregator Service 
SHOULD make sure that the <code>derivation_resource_id</code> used to create the derived resource is still valid by inspecting the 
asset on the UAS.</p>
   <p class="issue" id="issue-68530d09"><a class="self-link" href="#issue-68530d09"></a> How does the Aggregator Service inspect the asset on the UAS? Probably via the same endpoint as an RS would do it
in A4DS. Can the aggregator also do a GET to this endpoint to verify the validity of the derivation_resource_id?</p>
   <p>The Client SHOULD present the UMA ticket from the Aggregator response to the AAS to obtain an RPT as defined in <a data-link-type="biblio" href="#biblio-a4ds" title="Authorization for Data Spaces (A4DS)">[A4DS]</a>.
Additionally to A4DS, if this is a request to access a derived resource, the requested resource may have a <code>derived_from</code> 
entry in its registration that includes one or more <code>issuer</code> (the UAS) and <code>derivation_resource_id</code> entries. If no claims 
are given by the Client for these derived resources, the AAS MUST respond with a <code>need_info</code> error and include a 
<code>required_claims</code> list where each object MUST contain:</p>
   <ul>
    <li data-md>
     <p><code>claim_type</code>: MUST equal <code>https://spec.knows.idlab.ugent.be/aggregator-protocol/latest/#derivation-access</code>.</p>
    <li data-md>
     <p><code>claim_token_format</code>: MUST equal <code>urn:ietf:params:oauth:token-type:access_token</code>.</p>
    <li data-md>
     <p><code>issuer</code>: The UAS that issued the upstream access token.</p>
    <li data-md>
     <p><code>derivation_resource_id</code>: The derived resource identifier received from the UAS.</p>
    <li data-md>
     <p><code>resource_scopes</code>: A list of scopes for the derived resource (e.g., <code>urn:knows:uma:scopes:read</code>)</p>
   </ul>
   <p class="issue" id="issue-c93571db"><a class="self-link" href="#issue-c93571db"></a> Maybe the resource_scopes should be send during the access token request from the Aggregator to the UAS?
Maybe we could send <code>derived_resource_scopes</code> to the UAS and during resource registration send this to the AAS as well?
This scope should be the same as the one required to access the derived resource.</p>
   <p>If the Client
does not present a valid RPT for the requested derived resource, the Aggregator Service MUST request a UMA ticket from its
Authorization Server and return <code>401 Unauthorized</code> with that ticket. During ticket creation, the Aggregator Service
SHOULD validate that the <code>derivation_resource_id</code> used to create the derived resource is still valid; it MUST do this by
inspecting the asset on the UAS, this is defined in <a data-link-type="biblio" href="#biblio-a4ds" title="Authorization for Data Spaces (A4DS)">[A4DS]</a>. It should use the <code>IDP_aggregator_token</code> in the authorization 
header. If the <code>derivation_resource_id</code> is no longer valid, the Aggregator Service MUST treat the derived resource as 
invalid and MUST recreate the Aggregator Service (including its resource registrations).</p>
   <p>If upstream access is required, the Aggregator Authorization Server MAY respond with a <code>need_info</code> error. In that case, it
MUST include the <code>issuer</code>, <code>derivation_resource_id</code>, and <code>resource_scopes</code> entries in <code>required_claims</code>. The Client SHOULD
request upstream access tokens with the required scopes (including a derivation scope) and present them as claim tokens.
The Aggregator Authorization Server MUST validate provided upstream access tokens with the corresponding upstream
Authorization Servers; if checks succeed, it issues an RPT for the derived resource. The Aggregator Service MUST validate
or introspect the RPT before serving the derived resource. The Aggregator MAY implement SA4DS for streaming or non-HTTP
interfaces.</p>
   <p><strong>Non-normative flow and examples</strong></p>
   <p><img alt="PlantUML Diagram" src="uml/afb7a80951e97459e09c2ef8bf7ea932702af8b6.svg"></p>
   <p><strong>1. Client requests derived resource from Aggregator Service without token</strong></p>
   <p>The Client sends a request to the Aggregator Service for a derived resource without including a valid
Requesting Party Token (RPT), or with an RPT that does not grant sufficient permission.</p>
   <div class="example" id="example-6592a9b4">
    <a class="self-link" href="#example-6592a9b4"></a>

<pre class="highlight language-http"><c- nf>GET</c-> <c- nn>/aggregator/derived-resource-123</c-> <c- kr>HTTP</c-><c- o>/</c-><c- m>1.1</c->
<c- e>Host</c-><c- o>:</c-> <c- l>agg.example.org</c->
</pre>
   </div>
   <p>When a Client requests access to a derived resource from the Aggregator Service, a normal UMA flow follows.</p>
   <p><strong>1.1 Aggregator Service requests UMA ticket from its Authorization Server</strong></p>
   <p>The Aggregator Service, acting as a UMA Resource Server, requests a UMA ticket for the requested derived resource from its
Authorization Server.</p>
   <p><strong>1.2 Aggregator Service returns 401 Unauthorized with ticket</strong></p>
   <p>If the Client did not present a valid RPT, or if the RPT does not cover the requested permission, the
Aggregator Service returns a <code>401 Unauthorized</code> response containing the UMA ticket issued by its
Authorization Server.</p>
   <div class="example" id="example-6c571c36">
    <a class="self-link" href="#example-6c571c36"></a>

<pre class="highlight language-http"><c- kr>HTTP</c-><c- o>/</c-><c- m>1.1</c-> <c- m>401</c-> <c- ne>Unauthorized</c->
<c- e>WWW-Authenticate</c-><c- o>:</c-> <c- l>UMA realm="aggregator", as_uri="https://agg-as.example.org/", ticket="tkt-1"</c->
</pre>
   </div>
   <p><strong>2. Client presents ticket to Aggregator Authorization Server</strong></p>
   <p>The Client discovers the Aggregator Authorization Server (for example, via the <code>as_uri</code> parameter in the
<code>WWW-Authenticate</code> header) and sends a UMA grant request to exchange the ticket for an RPT.
The Client includes any claim tokens it already has (for example, its <code>IDP_client_token</code>) in the request.</p>
   <div class="example" id="example-5bce5b0f">
    <a class="self-link" href="#example-5bce5b0f"></a>

<pre class="highlight language-json"><c- p>{</c->
  <c- f>"grant_type"</c-><c- p>:</c-> <c- u>"urn:ietf:params:oauth:grant-type:uma-ticket"</c-><c- p>,</c->
  <c- f>"ticket"</c-><c- p>:</c-> <c- u>"tkt-1"</c-><c- p>,</c->
  <c- f>"claim_token"</c-><c- p>:</c-> <c- u>"&lt;IDP_client_token>"</c-><c- p>,</c->
  <c- f>"claim_token_format"</c-><c- p>:</c-> <c- u>"http://openid.net/specs/openid-connect-core-1_0.html#IDToken"</c->
<c- p>}</c->
</pre>
   </div>
   <p><strong>2.1 Aggregator Authorization Server introspects Client access tokens</strong></p>
   <p>If access to the derived resource depends on access to upstream resources, and the Client has not yet presented suitable
upstream access tokens, the Aggregator Authorization Server responds with a <code>need_info</code> error requesting additional claim 
tokens for the upstream resources. In that case, the Authorization Server adds the <code>issuer</code>, <code>derivation_resource_id</code>, and 
<code>resource_scopes</code> entries to the <code>required_claims</code> array to indicate which upstream Authorization Server and which resource 
the Client must obtain access tokens from.</p>
   <ul>
    <li data-md>
     <p>**<code>issuer</code>:** identifies the upstream Authorization Server.</p>
    <li data-md>
     <p>**<code>derivation_resource_id</code>:** Is the resource id the UAS used to identify the upstream resource when the Aggregator
requested access.</p>
    <li data-md>
     <p>**<code>resource_scopes</code>:** list enumerates the resource scopes required for this request from the UAS.</p>
   </ul>
   <div class="example" id="example-5a72ef78">
    <a class="self-link" href="#example-5a72ef78"></a>

<pre class="highlight language-json"><c- p>{</c->
  <c- f>"error"</c-><c- p>:</c-> <c- u>"need_info"</c-><c- p>,</c->
  <c- f>"ticket"</c-><c- p>:</c-> <c- u>"tkt-2"</c-><c- p>,</c->
  <c- f>"required_claims"</c-><c- p>:</c-> <c- p>[</c->
    <c- p>{</c->
      <c- f>"claim_type"</c-><c- p>:</c-> <c- u>"https://spec.knows.idlab.ugent.be/aggregator-protocol/latest/#derivation-access"</c-><c- p>,</c->
      <c- f>"claim_token_format"</c-><c- p>:</c-> <c- u>"urn:ietf:params:oauth:token-type:access_token"</c-><c- p>,</c->
      <c- f>"issuer"</c-><c- p>:</c-> <c- u>"https://as.example.org"</c-><c- p>,</c->
      <c- f>"derivation_resource_id"</c-><c- p>:</c-> <c- u>"handle-id-1"</c-><c- p>,</c->
      <c- f>"resource_scopes"</c-><c- p>:</c-> <c- p>[</c-> <c- u>"urn:knows:uma:scopes:derivation-read"</c-> <c- p>]</c->
    <c- p>}</c->
  <c- p>]</c->
<c- p>}</c->
</pre>
   </div>
   <p><strong>3. Client requests upstream access tokens</strong></p>
   <p>The Client then requests access tokens from the UAS with the required permissions (resource_id &amp; resource_scopes).</p>
   <div class="example" id="example-55187c47">
    <a class="self-link" href="#example-55187c47"></a>

<pre class="highlight language-json"><c- p>{</c->
  <c- f>"grant_type"</c-><c- p>:</c-> <c- u>"urn:ietf:params:oauth:grant-type:uma-ticket"</c-><c- p>,</c->
  <c- f>"permissions"</c-><c- p>:</c-> <c- p>[</c->
    <c- p>{</c->
      <c- f>"resource_id"</c-><c- p>:</c-> <c- u>"handle-id-1"</c-><c- p>,</c->
      <c- f>"resource_scopes"</c-><c- p>:</c-> <c- p>[</c-> <c- u>"urn:knows:uma:scopes:derivation-read"</c-> <c- p>]</c->
    <c- p>}</c->
  <c- p>],</c->
  <c- f>"claim_token"</c-><c- p>:</c-> <c- u>"&lt;IDP_aggregator_token>"</c-><c- p>,</c->
  <c- f>"claim_token_format"</c-><c- p>:</c-> <c- u>"http://openid.net/specs/openid-connect-core-1_0.html#IDToken"</c->
<c- p>}</c->
</pre>
   </div>
   <p><strong>3.1 UAS returns upstream access tokens</strong></p>
   <p>The UAS validates the claims and policies and issues an access token for the derivation resource.</p>
   <div class="example" id="example-bc292dbb">
    <a class="self-link" href="#example-bc292dbb"></a>

<pre class="highlight language-json"><c- p>{</c->
    <c- f>"access_token"</c-><c- p>:</c-> <c- u>"&lt;upstream_access_token>"</c->
<c- p>}</c->
</pre>
   </div>
   <p><strong>4. Client presents upstream tokens to Aggregator Authorization Server</strong></p>
   <p>Once the Client has obtained the required upstream access tokens, it sends another request to the Aggregator Authorization
Server, presenting the upstream access tokens (here only one) as claim tokens together with the new ticket.</p>
   <div class="example" id="example-41711c51">
    <a class="self-link" href="#example-41711c51"></a>

<pre class="highlight language-json"><c- p>{</c->
  <c- f>"grant_type"</c-><c- p>:</c-> <c- u>"urn:ietf:params:oauth:grant-type:uma-ticket"</c-><c- p>,</c->
  <c- f>"ticket"</c-><c- p>:</c-> <c- u>"tkt-2"</c-><c- p>,</c->
  <c- f>"claim_token_format"</c-><c- p>:</c-> <c- u>"urn:ietf:params:oauth:token-type:access_token"</c-><c- p>,</c->
  <c- f>"claim_token"</c-><c- p>:</c-> <c- u>"&lt;upstream_access_token>"</c->
<c- p>}</c->
</pre>
   </div>
   <p><strong>4.1 AAS verifies upstream tokens and returns RPT</strong></p>
   <p>The Aggregator Authorization Server verifies the provided access tokens with the upstream Authorization
Servers to confirm that the Client is authorized to access the upstream resources. If all policy checks
succeed, it issues an RPT for the requested derived resource.</p>
   <div class="example" id="example-ed6dace2">
    <a class="self-link" href="#example-ed6dace2"></a>

<pre class="highlight language-json"><c- p>{</c->
    <c- f>"access_token"</c-><c- p>:</c-> <c- u>"RPT-agg-1"</c-><c- p>,</c->
    <c- f>"token_type"</c-><c- p>:</c-> <c- u>"Bearer"</c-><c- p>,</c->
    <c- f>"expires_in"</c-><c- p>:</c-> <c- mi>3600</c->
<c- p>}</c->
</pre>
   </div>
   <p><strong>5. Client requests derived resource from Aggregator Service with RPT</strong></p>
   <p>Finally, the Client retries the original request to the Aggregator Service, this time including the RPT it
obtained from the Aggregator Authorization Server.</p>
   <div class="example" id="example-c5be6fd3">
    <a class="self-link" href="#example-c5be6fd3"></a>

<pre class="highlight language-http"><c- nf>GET</c-> <c- nn>/aggregator/derived-resource-123</c-> <c- kr>HTTP</c-><c- o>/</c-><c- m>1.1</c->
<c- e>Host</c-><c- o>:</c-> <c- l>agg.example.org</c->
<c- e>Authorization</c-><c- o>:</c-> <c- l>Bearer RPT-agg-1</c->
</pre>
   </div>
   <p><strong>5.1 Aggregator Service introspects RPT</strong></p>
   <p>The Aggregator Service introspects the RPT with the Aggregator Authorization Server to validate it and determine the
permissions granted to the Client.</p>
   <div class="example" id="example-8cc68324">
    <a class="self-link" href="#example-8cc68324"></a>

<pre class="highlight language-http"><c- nf>POST</c-> <c- nn>/introspect</c-> <c- kr>HTTP</c-><c- o>/</c-><c- m>1.1</c->
<c- e>Host</c-><c- o>:</c-> <c- l>agg-as.example.org</c->
<c- e>Accept</c-><c- o>:</c-> <c- l>application/json</c->
<c- e>Content-Type</c-><c- o>:</c-> <c- l>application/x-www-form-urlencoded</c->
token=RPT-agg-1
</pre>
   </div>
   <p><strong>5.2 AAS returns authorization result</strong></p>
   <p>The Aggregator Authorization Server responds to the introspection request indicating whether the RPT is active and what
permissions it grants.</p>
   <div class="example" id="example-2d638f72">
    <a class="self-link" href="#example-2d638f72"></a>

<pre class="highlight language-json"><c- p>{</c->
    <c- f>"active"</c-><c- p>:</c-> <c- kc>true</c-><c- p>,</c->
<c- p>}</c->
</pre>
   </div>
   <p><strong>5.3 Aggregator Service returns derived resource</strong></p>
   <p>The Aggregator Service returns the requested derived resource to the Client.</p>
   <h2 class="heading settled" data-level="7" id="aggregator-metadata"><span class="secno">7. </span><span class="content">Aggregator Metadata</span><a class="self-link" href="#aggregator-metadata"></a></h2>
   <p>This endpoint provides metadata about the Aggregator Instance. Deployments MAY choose arbitrary paths for instance-level
endpoints. The Aggregator Metadata representation MUST include absolute URLs for those resources (e.g., the
<code>transformation_catalog</code> and <code>service_collection_endpoint</code> fields) so clients can discover the deployment-specific layout.</p>
   <h3 class="heading settled" data-level="7.1" id="aggregator-description"><span class="secno">7.1. </span><span class="content">Aggregator Description</span><a class="self-link" href="#aggregator-description"></a></h3>
   <p>The Aggregator Metadata resource (<code>aggregator-url</code>) allows clients to retrieve the current status of their aggregator.
This endpoint MUST be guarded by the authentication and authorization mechanisms described in the 
<a href="#aggregator-security-model">§ 6 Aggregator Security Model (Authentication &amp; Authorization)</a>. It MUST be accessible as JSON using <code>application/json</code> and MAY additionally expose 
semantically annotated RDF representations (for example JSON-LD or Turtle) using HTTP content negotiation based on 
<a data-link-type="biblio" href="#biblio-rfc9110" title="HTTP Semantics">[RFC9110]</a>.</p>
   <p>The endpoint MUST return at least the following information about the aggregator, but additional fields MAY be
included as needed. Each field SHOULD be expressed using the RDF properties defined in <a href="#vocabulary">§ 9 Vocabulary</a> so the document MAY 
be served as JSON-LD or other RDF formats. In semantically annotated representations, the Aggregator Description MUST state 
that the described resource has RDF type <code>aggr:Aggregator</code> (<a href="#aggr-aggregator-class">§ 9.1.1 aggr:Aggregator</a>) (e.g., via <code>@type</code> in JSON-LD or 
<code>a aggr:Aggregator</code> in Turtle). Clients MAY rely on this type statement when consuming semantic representations.</p>
   <dl>
    <dt data-md><strong>id</strong> (OPTIONAL):
    <dd data-md>
     <p>The value is a string containing the absolute URL that identifies the Aggregator Instance (typically the
instance base URL itself); in the RDF representations, this is the RDF subject (i.e., <code>@id</code>) of the
<code>aggr:Aggregator</code> resource (<a href="#aggr-aggregator-class">§ 9.1.1 aggr:Aggregator</a>).</p>
    <dt data-md><strong>created_at</strong> (REQUIRED):
    <dd data-md>
     <p>The value is a string timestamp (recommended: <code>xsd:dateTime</code> lexical form, e.g., RFC 3339 <a data-link-type="biblio" href="#biblio-rfc3339" title="Date and Time on the Internet: Timestamps">[RFC3339]</a>); in
the RDF representations, this member maps to the predicate <code>aggr:createdAt</code>
(<a href="#aggr-created-at-property">§ 9.2.1 aggr:createdAt</a>).</p>
    <dt data-md><strong>login_status</strong> (REQUIRED):
    <dd data-md>
     <p>The value is a boolean that indicates whether the stored token set for the aggregator is currently valid;
in the RDF representations, this member maps to the predicate <code>aggr:loginStatus</code>
(<a href="#aggr-login-status-property">§ 9.2.2 aggr:loginStatus</a>).</p>
    <dt data-md><strong>token_expiry</strong> (OPTIONAL):
    <dd data-md>
     <p>The value is a string timestamp indicating when the aggregator’s access token will expire (recommended:
<code>xsd:dateTime</code> lexical form, e.g., RFC 3339 <a data-link-type="biblio" href="#biblio-rfc3339" title="Date and Time on the Internet: Timestamps">[RFC3339]</a>); in the RDF representations, this member maps to
the predicate <code>aggr:tokenExpiry</code> (<a href="#aggr-token-expiry-property">§ 9.2.3 aggr:tokenExpiry</a>).</p>
    <dt data-md><strong>transformation_catalog</strong> (REQUIRED):
    <dd data-md>
     <p>The value is a string containing the absolute URL of the instance’s Transformations Endpoint
(<a href="#instance-level-transformation-catalog">§ 7.2 Instance-level Transformations Catalog</a>); in the RDF representations, this member maps to the predicate
<code>aggr:transformationsEndpoint</code> (<a href="#aggr-transformations-endpoint-property">§ 9.2.4 aggr:transformationsEndpoint</a>).</p>
    <dt data-md><strong>service_collection_endpoint</strong> (REQUIRED):
    <dd data-md>
     <p>The value is a string containing the absolute URL of the instance’s Service Collection to create and fetch the Aggregator
Services (<a href="#service-collection">§ 8.1 Service Collection Endpoint</a>); in the RDF representations, this member maps to the predicate
<code>aggr:serviceCollectionEndpoint</code> (<a href="#aggr-service-collection-endpoint-property">§ 9.2.5 aggr:serviceCollectionEndpoint</a>).</p>
   </dl>
   <p>This document MAY be the WebID of the Aggregator Instance when the <code>provision</code> flow <a href="#creation-provision">§ 5.2.1 Creation provision Flow</a> was used. In
that case this document MUST be an RDF document that conforms to the WebID Profile specification <a data-link-type="biblio" href="#biblio-webid-profile" title="WebID Profile">[WEBID-PROFILE]</a>.</p>
   <div class="example" id="example-5d28864e">
    <a class="self-link" href="#example-5d28864e"></a>

<pre class="highlight language-json"><c- p>{</c->
  <c- f>"@context"</c-><c- p>:</c-> <c- p>{</c->
    <c- f>"id"</c-><c- p>:</c-> <c- u>"@id"</c-><c- p>,</c->
    <c- f>"aggr"</c-><c- p>:</c-> <c- u>"https://spec.knows.idlab.ugent.be/aggregator-protocol/latest/#"</c-><c- p>,</c->
    <c- f>"oidcIssuer"</c-><c- p>:</c-> <c- u>"http://www.w3.org/ns/solid/terms#oidcIssuer"</c-><c- p>,</c->
    <c- f>"xsd"</c-><c- p>:</c-> <c- u>"http://www.w3.org/2001/XMLSchema#"</c-><c- p>,</c->

    <c- f>"created_at"</c-><c- p>:</c-> <c- p>{</c->
      <c- f>"@id"</c-><c- p>:</c-> <c- u>"aggr:createdAt"</c-><c- p>,</c->
      <c- f>"@type"</c-><c- p>:</c-> <c- u>"xsd:dateTime"</c->
    <c- p>},</c->
    <c- f>"login_status"</c-><c- p>:</c-> <c- p>{</c->
      <c- f>"@id"</c-><c- p>:</c-> <c- u>"aggr:loginStatus"</c-><c- p>,</c->
      <c- f>"@type"</c-><c- p>:</c-> <c- u>"xsd:boolean"</c->
    <c- p>},</c->
    <c- f>"token_expiry"</c-><c- p>:</c-> <c- p>{</c->
      <c- f>"@id"</c-><c- p>:</c-> <c- u>"aggr:tokenExpiry"</c-><c- p>,</c->
      <c- f>"@type"</c-><c- p>:</c-> <c- u>"xsd:dateTime"</c->
    <c- p>},</c->
    <c- f>"transformation_catalog"</c-><c- p>:</c-> <c- p>{</c->
      <c- f>"@id"</c-><c- p>:</c-> <c- u>"aggr:transformationsEndpoint"</c-><c- p>,</c->
      <c- f>"@type"</c-><c- p>:</c-> <c- u>"@id"</c->
    <c- p>},</c->
    <c- f>"service_collection_endpoint"</c-><c- p>:</c-> <c- p>{</c->
      <c- f>"@id"</c-><c- p>:</c-> <c- u>"aggr:serviceCollectionEndpoint"</c-><c- p>,</c->
      <c- f>"@type"</c-><c- p>:</c-> <c- u>"@id"</c->
    <c- p>}</c->
  <c- p>},</c->
  <c- f>"id"</c-><c- p>:</c-> <c- u>"https://aggregator.example/aggregators/agg-7890/"</c-><c- p>,</c->
  <c- f>"@type"</c-><c- p>:</c-> <c- u>"aggr:Aggregator"</c-><c- p>,</c->
  <c- f>"created_at"</c-><c- p>:</c-> <c- u>"2025-12-17T17:20:00Z"</c-><c- p>,</c->
  <c- f>"login_status"</c-><c- p>:</c-> <c- kc>true</c-><c- p>,</c->
  <c- f>"token_expiry"</c-><c- p>:</c-> <c- u>"2025-12-17T18:20:00Z"</c-><c- p>,</c->
  <c- f>"transformation_catalog"</c-><c- p>:</c-> <c- u>"https://aggregator.example/aggregators/agg-7890/transformations"</c-><c- p>,</c->
  <c- f>"service_collection_endpoint"</c-><c- p>:</c-> <c- u>"https://aggregator.example/aggregators/agg-7890/config/services"</c-><c- p>,</c->
  <c- f>"oidcIssuer"</c-><c- p>:</c-> <c- u>"https://issuer.example/"</c->
<c- p>}</c->
</pre>
   </div>
   <h3 class="heading settled" data-level="7.2" id="instance-level-transformation-catalog"><span class="secno">7.2. </span><span class="content">Instance-level Transformations Catalog</span><a class="self-link" href="#instance-level-transformation-catalog"></a></h3>
   <p>This endpoint is the instance-level extension on the public Transformation Catalog defined in
<a href="#server-level-transformation-catalog">§ 4.3 Server-level Transformation Catalog</a>. Implementations MAY expose it at any URL, but the Aggregator Description MUST 
advertise the correct location via its <code>transformation_catalog</code> field (<code>aggr:transformationsEndpoint</code>). It allows aggregator 
implementations to expose user-specific transformations, or protected/private transformations. This endpoint, contrasting 
to the public Transformation Catalog, MAY be user specific and MUST require authentication. The endpoint MAY return a 404 
Not Found if no user-specific transformations are available. A client SHOULD combine the information from this endpoint 
with the public Transformation Catalog to get a complete view on the available transformations. The endpoint follows the 
same content negotiation rules and other requirements as the public Transformation Catalog.</p>
   <h2 class="heading settled" data-level="8" id="aggregator-service-management"><span class="secno">8. </span><span class="content">Aggregator Service Management</span><a class="self-link" href="#aggregator-service-management"></a></h2>
   <p>The Aggregator Service Management endpoint gives an authenticated client a complete view on the Aggregator Services.
It lets an authenticated client see all the running Aggregator Services and create, inspect, and remove individual 
Aggregator Services. Implementations MAY use different URLs as long as the Aggregator Description document (described in
<a href="#aggregator-description">§ 7.1 Aggregator Description</a>) links to the concrete entry points. All described endpoints in this section MUST be protected 
by the authentication and authorization mechanisms defined in <a href="#aggregator-security-model">§ 6 Aggregator Security Model (Authentication &amp; Authorization)</a>.</p>
   <h3 class="heading settled" data-level="8.1" id="service-collection"><span class="secno">8.1. </span><span class="content">Service Collection Endpoint</span><a class="self-link" href="#service-collection"></a></h3>
   <p class="issue" id="issue-e6c8b095"><a class="self-link" href="#issue-e6c8b095"></a> Do we define the exact scopes here?</p>
   <p>This endpoint allows to create and fetch the collection of configured Aggregator Services. The location of this resource is
advertised in the Aggregator Description (<a href="#aggregator-description">§ 7.1 Aggregator Description</a>) via the <code>service_collection_endpoint</code> field.
Clients MUST treat that advertised URL as authoritative and MUST NOT assume a fixed path (the examples in this section use 
<code>/services</code> purely for illustration). The Aggregator MUST register this UMA resource with the Authorization Server and 
advertise the <code>read</code> and <code>create</code> scopes so that clients can both inspect and add members.</p>
   <dl>
    <dt data-md><code>HEAD</code>
    <dd data-md>
     <p>If the Service Collection exists, the server MUST respond with <code>200 OK</code>, <code>Content-Type: application/json</code>, and an <code>ETag</code>
header whose value changes whenever a service is added or removed. The <code>ETag</code> allows clients to detect collection 
changes without re-downloading it. This request MUST be authorized with a <code>read</code> scope on the Service Collection 
resource.</p>
    <dt data-md><code>GET</code>
    <dd data-md>
     <p>Returns the list of Aggregator Service resources (<a href="#service-resource">§ 8.2 Service Resource</a>). The server MUST set the same <code>ETag</code> value as
the <code>HEAD</code> response. This request MUST be authorized with a <code>read</code> scope on the Service Collection resource. The server 
MUST support JSON and MAY additionally expose semantically annotated RDF representations (for example JSON-LD or Turtle) 
using HTTP content negotiation based on <a data-link-type="biblio" href="#biblio-rfc9110" title="HTTP Semantics">[RFC9110]</a>. The payload MUST include at least the following fields:</p>
     <dl>
      <dt data-md><strong>services</strong> (REQUIRED):
      <dd data-md>
       <p>The value is a JSON array of strings where each member MUST be an absolute URL of a Service Resource that can be
dereferenced by the client. In semantically annotated representations, this member maps to the predicate 
<code>aggr:service</code> (<a href="#aggr-service-property">§ 9.2.6 aggr:service</a>).</p>
      <dt data-md><strong>id</strong> (OPTIONAL):
      <dd data-md>
       <p>The value is a string containing the absolute URL that identifies this Service Collection. This MUST be the same URL
as the request target. In semantically annotated representations, this is the RDF subject (i.e., <code>@id</code>) of the
<code>aggr:ServiceCollection</code> resource (<a href="#aggr-service-collection-class">§ 9.1.4 aggr:ServiceCollection</a>).</p>
     </dl>
     <div class="example" id="example-9fa5fbac">
      <a class="self-link" href="#example-9fa5fbac"></a>

<pre class="highlight language-json"><c- p>{</c->
  <c- f>"@context"</c-><c- p>:</c-> <c- p>{</c->
    <c- f>"id"</c-><c- p>:</c-> <c- u>"@id"</c-><c- p>,</c->
    <c- f>"services"</c-><c- p>:</c-> <c- p>{</c->
      <c- f>"@id"</c-><c- p>:</c-> <c- u>"aggr:service"</c-><c- p>,</c->
      <c- f>"@container"</c-><c- p>:</c-> <c- u>"@set"</c-><c- p>,</c->
      <c- f>"@type"</c-><c- p>:</c-> <c- u>"@id"</c->
    <c- p>},</c->
    <c- f>"aggr"</c-><c- p>:</c-> <c- u>"https://spec.knows.idlab.ugent.be/aggregator-protocol/latest/#"</c->
  <c- p>},</c->
  <c- f>"id"</c-><c- p>:</c-> <c- u>"https://aggregator.example.org/services"</c-><c- p>,</c->
  <c- f>"services"</c-><c- p>:</c-> <c- p>[</c->
    <c- u>"https://aggregator.example.org/services/410b093c-04b3-4fac-87be-4d393f40b2e5"</c-><c- p>,</c->
    <c- u>"https://aggregator.example.org/services/42"</c->
  <c- p>]</c->
<c- p>}</c->
</pre>
     </div>
    <dt data-md><code>POST</code>
    <dd data-md>
     <p>This request allows a client to create a new Aggregator Service. The request MUST be authorized with a <code>create</code> scope
on the Service Collection resource. The request body MUST contain an <code>fno:Execution</code> that references a transformation 
from the public or instance-level transformation catalog, unless it references a client-provided <code>fno:Composition</code> 
handled as described below (implementations MAY decide on the exact semantic media type using HTTP content negotiation 
based on <a data-link-type="biblio" href="#biblio-rfc9110" title="HTTP Semantics">[RFC9110]</a>). This execution description MUST conform to the FnO specification <a data-link-type="biblio" href="#biblio-fno" title="Function Ontology (FnO)">[FNO]</a> and MUST include 
exactly one <code>fno:executes</code> with the IRI of the function to execute. The client SHOULD either use a blank node or an IRI 
as the subject of the <code>fno:Execution</code>, using an IRI allows the client to suggest a specific identifier for the created 
service. Servers MAY honor this suggested identifier; if they do, the created service URL MUST equal the suggested IRI.
Servers that do not honor client-suggested identifiers MUST ignore the suggestion and generate their own identifier.
If <code>fno:executes</code> references a <code>fno:Composition</code> provided by the client, the server MUST either reject the
request with <code>400 Bad Request</code> or accept it and publish the composition in the instance-level transformation catalog.
On success, the server MUST:</p>
     <ol>
      <li data-md>
       <p>Persist the new service and change the collection <code>ETag</code>.</p>
      <li data-md>
       <p>Register a new UMA resource for the created Service Resource URL (e.g., <code>/services/{service_id}</code>) with the <code>read</code>
and <code>delete</code> scopes so the creator—or any other party with an RPT containing those scopes—can manage the service.</p>
      <li data-md>
       <p>Return <code>201 Created</code>, with the Aggregator Service resource representation (as defined in <a href="#service-resource">§ 8.2 Service Resource</a>)
in the response body.</p>
     </ol>
     <p>If the request body is invalid the server MUST respond with <code>400 Bad Request</code>. Failures while instantiating
the service MUST result in <code>500 Internal Server Error</code>. If the server honors a suggested identifier and the suggested 
identifier is not available, the server MUST respond with <code>409 Conflict</code>.</p>
   </dl>
   <h3 class="heading settled" data-level="8.2" id="service-resource"><span class="secno">8.2. </span><span class="content">Service Resource</span><a class="self-link" href="#service-resource"></a></h3>
   <p>Operations on the service resource MUST require the <code>read</code> scope for <code>HEAD</code> and <code>GET</code> requests and the <code>delete</code> scope for
<code>DELETE</code> requests. The service resource URL MUST be one of the URLs returned by the collection resource; a request for a 
non-existent service MUST return <code>404 Not Found</code>, while malformed service URLs MUST yield <code>400 Bad Request</code>. In 
semantically annotated representations, the service resource MUST also be typed as <code>fno:Execution</code>.</p>
   <dl>
    <dt data-md><code>HEAD</code>
    <dd data-md>
     <p>If the Service Resource exists, the server MUST respond with <code>200 OK</code> and <code>ETag</code>, and <code>Content-Type</code> headers
whose value MUST change whenever the service state changes.</p>
    <dt data-md><code>GET</code>
    <dd data-md>
     <p>If no <code>Accept</code> header was set by the user, a JSON representation of the service MUST be returned with <code>200 OK</code> and
with a <code>Content-Type: application/json</code>. The user MAY request semantic representations using HTTP content negotiation 
based on <a data-link-type="biblio" href="#biblio-rfc9110" title="HTTP Semantics">[RFC9110]</a>. The representation MUST include at least the following fields:</p>
     <dl>
      <dt data-md><strong>id</strong> (REQUIRED):
      <dd data-md>
       <p>The value is a string containing the absolute URL of this Service Resource. In semantically annotated
representations, this is the RDF subject (i.e., <code>@id</code>) of the <code>aggr:Service</code> class (<a href="#aggr-service-class">§ 9.1.2 aggr:Service</a>).</p>
      <dt data-md><strong>type</strong> (REQUIRED):
      <dd data-md>
       <p>The value is a array of strings indicating the RDF types of this service. This array MUST include <code>aggr:Service</code> and
<code>fno:Execution</code>. In semantically annotated representations, this represents the type (<code>@type</code> in JSON-LD) of the 
service.</p>
      <dt data-md><strong>status</strong> (REQUIRED):
      <dd data-md>
       <p>The value is a string indicating the current status of the service (e.g., <code>"starting"</code>, <code>"running"</code>, <code>"stopped"</code>, or
<code>"errored"</code>). In semantically annotated representations, this member maps to the predicate <code>aggr:status</code>
(<a href="#aggr-status-property">§ 9.2.8 aggr:status</a>).</p>
      <dt data-md><strong>status_detail</strong> (OPTIONAL):
      <dd data-md>
       <p>The value is a string providing a human-readable detail about the current status (for example, a stop reason or
error message). When <code>status</code> is <code>"errored"</code>, the server SHOULD include this field. In semantically annotated 
representations, this member maps to the predicate <code>aggr:statusDetail</code> (<a href="#aggr-status-detail-property">§ 9.2.9 aggr:statusDetail</a>).</p>
      <dt data-md><strong>created_at</strong> (REQUIRED):
      <dd data-md>
       <p>The value is a string timestamp (recommended: <code>xsd:dateTime</code> lexical form, e.g., RFC 3339 <a data-link-type="biblio" href="#biblio-rfc3339" title="Date and Time on the Internet: Timestamps">[RFC3339]</a>). In
semantically annotated representations, this member maps to the predicate <code>aggr:createdAt</code> 
(<a href="#aggr-created-at-property">§ 9.2.1 aggr:createdAt</a>).</p>
      <dt data-md><strong>executes</strong> (REQUIRED):
      <dd data-md>
       <p>The value is a string containing the IRI of the FnO function being executed. In semantically annotated
representations, this member maps to the predicate <code>fno:executes</code>.</p>
     </dl>
     <p>The representation MUST also include any required input and output parameters for the executed FnO function, using the
FnO parameters and outputs predicates defined in the function’s FnO description. The representation MAY include 
additional fields (e.g., <code>fno:name</code>, <code>fno:solves</code>, etc.) as needed. The specification does not mandate a specific
serialization for these additional fields; clients MUST be prepared to handle arbitrary RDF properties in semantically 
annotated representations.</p>
    <dt data-md><code>DELETE</code>
    <dd data-md>
     <p>Stops and removes the service. The Aggregator MUST stop the running transformation, delete the persisted service entry,
change the collection <code>ETag</code>, unregister the service’s UMA resource, and respond with <code>204 No Content</code>. Clients that 
held the service identifier MUST treat it as invalid after receiving the success response.</p>
   </dl>
   <h3 class="heading settled" data-level="8.3" id="service-management-flows"><span class="secno">8.3. </span><span class="content">Service Management Flows (Non-normative)</span><a class="self-link" href="#service-management-flows"></a></h3>
   <p>This section gives some examples on how a client can create, find, use and delete services on the Aggregator. This section
is non-normative, and is only meant to illustrate the usage of the various endpoints defined in this specification. This 
section assumes the client has already created an Aggregator using the Aggregator Registration API 
(<a href="#aggregator-registration">§ 5.1 Aggregator Registration Endpoint</a>) and is able to authenticate using the mechanisms defined in <a href="#aggregator-security-model">§ 6 Aggregator Security Model (Authentication &amp; Authorization)</a>.</p>
   <h4 class="heading settled" data-level="8.3.1" id="creating-a-service"><span class="secno">8.3.1. </span><span class="content">Creating a Service</span><a class="self-link" href="#creating-a-service"></a></h4>
   <p>To create a new Aggregator Service, a client starts by doing a <code>POST</code> request to the Service Collection endpoint (i.e., the
URL advertised via <code>service_collection_endpoint</code> in the Aggregator Description; this section uses <code>/services</code> as an 
example). The body of the post is an execution of an FnO function <a data-link-type="biblio" href="#biblio-fno" title="Function Ontology (FnO)">[FNO]</a>.</p>
   <div class="example" id="example-7a7e128b">
    <a class="self-link" href="#example-7a7e128b"></a>

<pre class="highlight language-http"><c- nf>POST</c-> <c- nn>/services</c-> <c- kr>HTTP</c-><c- o>/</c-><c- m>1.1</c->
<c- e>Host</c-><c- o>:</c-> <c- l>aggregator.example.org</c->
<c- e>Content-Type</c-><c- o>:</c-> <c- l>text/turtle</c->

<c- k>@prefix</c-> <c- nn>trans:</c-> <c- g>&lt;http://aggregator.example.org/transformations#></c-> <c- p>.</c->
<c- k>@prefix</c-> <c- nn>fno:</c-> <c- g>&lt;https://w3id.org/function/ontology#></c-> <c- p>.</c->

<c- nn>_</c-><c- p>:</c-><c- f>execution</c-> <c- b>a</c-> <c- nn>fno</c-><c- p>:</c-><c- f>Execution</c-> <c- p>;</c->
    <c- nn>fno</c-><c- p>:</c-><c- f>executes</c-> <c- nn>trans</c-><c- p>:</c-><c- f>QuerySources</c-> <c- p>;</c->
    <c- nn>trans</c-><c- p>:</c-><c- f>query</c-> <c- s>"SELECT * WHERE { ?s ?p ?o }"</c-> <c- p>;</c->
    <c- nn>trans</c-><c- p>:</c-><c- f>sources</c-> <c- p>(</c-> <c- g>&lt;http://example.org/source/1></c-> <c- g>&lt;http://example.org/source/2></c-> <c- p>)</c-> <c- p>.</c->
</pre>
   </div>
   <p>The Aggregator fetches a ticket from the Authorization Server with the resource_id <code>1a2b-creation-endpoint</code> it got during
asset creation (see <a data-link-type="biblio" href="#biblio-a4ds" title="Authorization for Data Spaces (A4DS)">[A4DS]</a>).</p>
   <div class="example" id="example-64b00d3d">
    <a class="self-link" href="#example-64b00d3d"></a>

<pre class="highlight language-http">HTTP/1.1 /ticket
Host: as.example.org
Content-Type: application/json
{
    "resource_id": "1a2b-creation-endpoint",
    "resource_scopes": ["https://example.org/modes/create"]
}
</pre>
   </div>
   <p>This returns a ticket that represents the permissions needed for this request to the RS (the Aggregator in this case).</p>
   <div class="example" id="example-51cf50b7">
    <a class="self-link" href="#example-51cf50b7"></a>

<pre class="highlight language-http"><c- kr>HTTP</c-><c- o>/</c-><c- m>1.1</c-> <c- m>200</c-> <c- ne>OK</c->
<c- e>Content-Type</c-><c- o>:</c-> <c- l>application/json</c->
{
    <c- f>"ticket"</c-><c- p>:</c-> <c- u>"service-creation-ticket-xyz"</c->
<c- p>}</c->
</pre>
   </div>
   <p>This ticket is then returned to the client in a <code>401 Unauthorized</code> response.</p>
   <div class="example" id="example-b6299811">
    <a class="self-link" href="#example-b6299811"></a>

<pre class="highlight language-http"><c- kr>HTTP</c-><c- o>/</c-><c- m>1.1</c-> <c- m>401</c-> <c- ne>Unauthorized</c->
<c- e>WWW-Authenticate</c-><c- o>:</c-> <c- l>UMA as_uri="https://as.example.org", ticket="service-creation-ticket-xyz"</c->
</pre>
   </div>
   <p>The client then requests an RPT from the AS using the ticket, as defined in <a href="#aggregator-security-model">§ 6 Aggregator Security Model (Authentication &amp; Authorization)</a>.
The original request can then be retried, this time including the RPT in the <code>Authorization</code> header.</p>
   <div class="example" id="example-96a85109">
    <a class="self-link" href="#example-96a85109"></a>

<pre class="highlight language-http"><c- nf>POST</c-> <c- nn>/services</c-> <c- kr>HTTP</c-><c- o>/</c-><c- m>1.1</c->
<c- e>Host</c-><c- o>:</c-> <c- l>aggregator.example.org</c->
<c- e>Authorization</c-><c- o>:</c-> <c- l>Bearer ey...</c->
<c- e>Content-Type</c-><c- o>:</c-> <c- l>text/turtle</c->

<c- k>@prefix</c-> <c- nn>trans:</c-> <c- g>&lt;http://aggregator.example.org/transformations#></c-> <c- p>.</c->
<c- k>@prefix</c-> <c- nn>fno:</c-> <c- g>&lt;https://w3id.org/function/ontology#></c-> <c- p>.</c->

<c- nn>_</c-><c- p>:</c-><c- f>execution</c-> <c- b>a</c-> <c- nn>fno</c-><c- p>:</c-><c- f>Execution</c-> <c- p>;</c->
    <c- nn>fno</c-><c- p>:</c-><c- f>executes</c-> <c- nn>trans</c-><c- p>:</c-><c- f>QuerySources</c-> <c- p>;</c->
    <c- nn>trans</c-><c- p>:</c-><c- f>query</c-> <c- s>"SELECT * WHERE { ?s ?p ?o }"</c-> <c- p>;</c->
    <c- nn>trans</c-><c- p>:</c-><c- f>sources</c-> <c- p>(</c-> <c- g>&lt;http://example.org/source/1></c-> <c- g>&lt;http://example.org/source/2></c-> <c- p>)</c-> <c- p>.</c->
</pre>
   </div>
   <p>If the request is valid, the Aggregator will create a new service, register the appropriate UMA resource, and
return a <code>201 Created</code> response with the service representation in the body.</p>
   <div class="example" id="example-773defe9">
    <a class="self-link" href="#example-773defe9"></a>

<pre class="highlight language-http"><c- kr>HTTP</c-><c- o>/</c-><c- m>1.1</c-> <c- m>201</c-> <c- ne>Created</c->
<c- e>Content-Type</c-><c- o>:</c-> <c- l>text/turtle</c->

<c- k>@prefix</c-> <c- nn>aggr:</c-> <c- g>&lt;https://spec.knows.idlab.ugent.be/aggregator-protocol/latest/#></c-> <c- p>.</c->
<c- k>@prefix</c-> <c- nn>fno:</c-> <c- g>&lt;https://w3id.org/function/ontology#></c-> <c- p>.</c->
<c- k>@prefix</c-> <c- nn>trans:</c-> <c- g>&lt;http://aggregator.example.org/transformations#></c-> <c- p>.</c->
<c- k>@prefix</c-> <c- nn>xsd:</c-> <c- g>&lt;http://www.w3.org/2001/XMLSchema#></c-> <c- p>.</c->

<c- g>&lt;https://aggregator.example.org/services/410b093c-04b3-4fac-87be-4d393f40b2e5></c->
    <c- b>a</c-> <c- nn>aggr</c-><c- p>:</c-><c- f>Service</c-> <c- p>;</c->
    <c- b>a</c-> <c- nn>fno</c-><c- p>:</c-><c- f>Execution</c-> <c- p>;</c->
    <c- nn>aggr</c-><c- p>:</c-><c- f>status</c-> <c- s>"running"</c-> <c- p>;</c->
    <c- nn>aggr</c-><c- p>:</c-><c- f>statusDetail</c-> <c- s>""</c-> <c- p>;</c->
    <c- nn>aggr</c-><c- p>:</c-><c- f>createdAt</c-> <c- s>"2024-01-01T12:00:00Z"</c-><c- p>^^</c-><c- nn>xsd</c-><c- p>:</c-><c- f>dateTime</c-> <c- p>;</c->
    <c- nn>fno</c-><c- p>:</c-><c- f>executes</c-> <c- nn>trans</c-><c- p>:</c-><c- f>QuerySources</c-> <c- p>;</c->
    <c- nn>trans</c-><c- p>:</c-><c- f>query</c-> <c- s>"SELECT * WHERE { ?s ?p ?o }"</c-> <c- p>;</c->
    <c- nn>trans</c-><c- p>:</c-><c- f>sources</c-> <c- p>(</c-> <c- g>&lt;http://example.org/source/1></c-> <c- g>&lt;http://example.org/source/2></c-> <c- p>)</c-> <c- p>;</c->
    <c- nn>trans</c-><c- p>:</c-><c- f>result</c-> <c- g>&lt;https://aggregator.example.org/services/410b093c-04b3-4fac-87be-4d393f40b2e5#result></c-> <c- p>.</c->

<c- g>&lt;https://aggregator.example.org/services/410b093c-04b3-4fac-87be-4d393f40b2e5#result></c->
    <c- b>a</c-> <c- nn>trans</c-><c- p>:</c-><c- f>SPARQLProtocol</c-> <c- p>;</c->
    <c- nn>dcat</c-><c- p>:</c-><c- f>endpointURL</c-> <c- g>&lt;https://aggregator.example.org/410b093c-04b3-4fac-87be-4d393f40b2e5/></c-> <c- p>.</c->
</pre>
   </div>
   <h4 class="heading settled" data-level="8.3.2" id="discovering-services"><span class="secno">8.3.2. </span><span class="content">Discovering Services</span><a class="self-link" href="#discovering-services"></a></h4>
   <p>To discover the services currently registered on the Aggregator, a client can do a <code>GET</code> request to the
Service Collection endpoint (this section uses <code>/services</code> as an example).
After authenticating using the mechanisms defined in <a href="#aggregator-security-model">§ 6 Aggregator Security Model (Authentication &amp; Authorization)</a>, the Aggregator will
return a list with the registered service from <a href="#creating-a-service">§ 8.3.1 Creating a Service</a>.</p>
   <div class="example" id="example-a7ef4bda">
    <a class="self-link" href="#example-a7ef4bda"></a>

<pre class="highlight language-http"><c- kr>HTTP</c-><c- o>/</c-><c- m>1.1</c-> <c- m>200</c-> <c- ne>OK</c->
<c- e>Content-Type</c-><c- o>:</c-> <c- l>text/turtle</c->

<c- k>@prefix</c-> <c- nn>aggr:</c-> <c- g>&lt;https://spec.knows.idlab.ugent.be/aggregator-protocol/latest/#></c-> <c- p>.</c->
<c- k>@prefix</c-> <c- nn>xsd:</c-> <c- g>&lt;http://www.w3.org/2001/XMLSchema#></c-> <c- p>.</c->
<c- g>&lt;></c-> <c- b>a</c-> <c- nn>aggr</c-><c- p>:</c-><c- f>ServiceCollection</c-> <c- p>;</c->
    <c- nn>aggr</c-><c- p>:</c-><c- f>service</c-> <c- g>&lt;https://aggregator.example.org/services/410b093c-04b3-4fac-87be-4d393f40b2e5></c-> <c- p>.</c->
</pre>
   </div>
   <p>Dereferencing this URL will return the full service representation.</p>
   <div class="example" id="example-050a4bc6">
    <a class="self-link" href="#example-050a4bc6"></a>

<pre class="highlight language-http"><c- kr>HTTP</c-><c- o>/</c-><c- m>1.1</c-> <c- m>201</c-> <c- ne>Created</c->
<c- e>Content-Type</c-><c- o>:</c-> <c- l>text/turtle</c->

<c- k>@prefix</c-> <c- nn>aggr:</c-> <c- g>&lt;https://spec.knows.idlab.ugent.be/aggregator-protocol/latest/#></c-> <c- p>.</c->
<c- k>@prefix</c-> <c- nn>fno:</c-> <c- g>&lt;https://w3id.org/function/ontology#></c-> <c- p>.</c->
<c- k>@prefix</c-> <c- nn>trans:</c-> <c- g>&lt;http://aggregator.example.org/transformations#></c-> <c- p>.</c->
<c- k>@prefix</c-> <c- nn>xsd:</c-> <c- g>&lt;http://www.w3.org/2001/XMLSchema#></c-> <c- p>.</c->

<c- g>&lt;https://aggregator.example.org/services/410b093c-04b3-4fac-87be-4d393f40b2e5></c->
    <c- b>a</c-> <c- nn>aggr</c-><c- p>:</c-><c- f>Service</c-> <c- p>;</c->
    <c- b>a</c-> <c- nn>fno</c-><c- p>:</c-><c- f>Execution</c-> <c- p>;</c->
    <c- nn>aggr</c-><c- p>:</c-><c- f>status</c-> <c- s>"starting"</c-> <c- p>;</c->
    <c- nn>aggr</c-><c- p>:</c-><c- f>statusDetail</c-> <c- s>""</c-> <c- p>;</c->
    <c- nn>aggr</c-><c- p>:</c-><c- f>createdAt</c-> <c- s>"2024-01-01T12:00:00Z"</c-><c- p>^^</c-><c- nn>xsd</c-><c- p>:</c-><c- f>dateTime</c-> <c- p>;</c->
    <c- nn>fno</c-><c- p>:</c-><c- f>executes</c-> <c- nn>trans</c-><c- p>:</c-><c- f>QuerySources</c-> <c- p>;</c->
    <c- nn>trans</c-><c- p>:</c-><c- f>query</c-> <c- s>"SELECT * WHERE { ?s ?p ?o }"</c-> <c- p>;</c->
    <c- nn>trans</c-><c- p>:</c-><c- f>sources</c-> <c- p>(</c-> <c- g>&lt;http://example.org/source/1></c-> <c- g>&lt;http://example.org/source/2></c-> <c- p>)</c-> <c- p>;</c->
    <c- nn>trans</c-><c- p>:</c-><c- f>result</c-> <c- g>&lt;https://aggregator.example.org/services/410b093c-04b3-4fac-87be-4d393f40b2e5#result></c-> <c- p>.</c->

<c- g>&lt;https://aggregator.example.org/services/410b093c-04b3-4fac-87be-4d393f40b2e5#result></c->
    <c- b>a</c-> <c- nn>trans</c-><c- p>:</c-><c- f>SPARQLProtocol</c-> <c- p>;</c->
    <c- nn>dcat</c-><c- p>:</c-><c- f>endpointURL</c-> <c- g>&lt;https://aggregator.example.org/410b093c-04b3-4fac-87be-4d393f40b2e5/></c-> <c- p>.</c->
</pre>
   </div>
   <h4 class="heading settled" data-level="8.3.3" id="using-a-service"><span class="secno">8.3.3. </span><span class="content">Using a Simple Service</span><a class="self-link" href="#using-a-service"></a></h4>
   <p>After discovering the service, the client can use the transformation catalog to find out what <code>trans:QuerySources</code> does,
and how to use the output. In this example, the client sees that the function produces an output parameter <code>trans:result</code> 
that is a <code>trans:SPARQLProtocol</code> conforming to the SPARQL protocol with an endpointURL at 
<code>https://aggregator.example.org/410b093c-04b3-4fac-87be-4d393f40b2e5/</code> where the query results can be accessed. The client 
can then do a <code>GET</code> request to that URL, again authenticating using the mechanisms defined in 
<a href="#aggregator-security-model">§ 6 Aggregator Security Model (Authentication &amp; Authorization)</a>. This time the client might need to gather multiple access claims from the AS’s of 
<code>http://example.org/source/1</code> and <code>http://example.org/source/2</code>. After receiving an access token from the Aggregator 
Authorization Server, the client can redo the <code>GET</code> request to 
<code>https://aggregator.example.org/410b093c-04b3-4fac-87be-4d393f40b2e5/</code> to get the query results.</p>
   <h2 class="heading settled" data-level="9" id="vocabulary"><span class="secno">9. </span><span class="content">Vocabulary</span><a class="self-link" href="#vocabulary"></a></h2>
   <p>The Aggregator vocabulary is defined in the <code>aggr:</code> namespace
(<code>https://spec.knows.idlab.ugent.be/aggregator-protocol/latest/#</code>). The following classes and properties are used 
throughout this specification.</p>
   <h3 class="heading settled" data-level="9.1" id="vocabulary-classes"><span class="secno">9.1. </span><span class="content">Classes</span><a class="self-link" href="#vocabulary-classes"></a></h3>
   <h4 class="heading settled" data-level="9.1.1" id="aggr-aggregator-class"><span class="secno">9.1.1. </span><span class="content">aggr:Aggregator</span><a class="self-link" href="#aggr-aggregator-class"></a></h4>
   
Describes an Aggregator Instance (its base URL is the Aggregator Description resource).


   <p><strong>type:</strong> <a href="https://www.w3.org/TR/rdf-schema/#ch_class">rdfs:Class</a><br>
<strong>subClassOf:</strong> <a href="https://schema.org/Service">schema:Service</a><br>
<strong>subClassOf:</strong> <a href="https://xmlns.com/foaf/0.1/Agent">foaf:Agent</a></p>
   <h4 class="heading settled" data-level="9.1.2" id="aggr-service-class"><span class="secno">9.1.2. </span><span class="content">aggr:Service</span><a class="self-link" href="#aggr-service-class"></a></h4>
   
Represents a configured Aggregator pipeline that can be created, inspected, and removed via the Service
Management API (e.g., <code>/config/services/{service_id}</code>).


   <p><strong>type:</strong> <a href="https://www.w3.org/TR/rdf-schema/#ch_class">rdfs:Class</a><br>
<strong>subClassOf:</strong> <a href="https://www.w3.org/TR/prov-o/#Activity">prov:Activity</a>,
<a href="https://w3id.org/function/spec/#Execution">fno:Execution</a></p>
   <h4 class="heading settled" data-level="9.1.3" id="aggr-aggregator-server-class"><span class="secno">9.1.3. </span><span class="content">aggr:AggregatorServer</span><a class="self-link" href="#aggr-aggregator-server-class"></a></h4>
   
Describes the Aggregator Server Description document that advertises discovery metadata.


   <p><strong>type:</strong> <a href="https://www.w3.org/TR/rdf-schema/#ch_class">rdfs:Class</a><br>
<strong>subClassOf:</strong> <a href="https://schema.org/Service">schema:Service</a></p>
   <h4 class="heading settled" data-level="9.1.4" id="aggr-service-collection-class"><span class="secno">9.1.4. </span><span class="content">aggr:ServiceCollection</span><a class="self-link" href="#aggr-service-collection-class"></a></h4>
   
Describes the service collection resource (e.g., <code>/config/services</code>).


   <p><strong>type:</strong> <a href="https://www.w3.org/TR/rdf-schema/#ch_class">rdfs:Class</a><br>
<strong>subClassOf:</strong> <a href="https://schema.org/Collection">schema:Collection</a>,
<a href="https://www.hydra-cg.com/spec/latest/core/#collections">hydra:Collection</a></p>
   <h4 class="heading settled" data-level="9.1.5" id="aggr-transformation-collection-class"><span class="secno">9.1.5. </span><span class="content">aggr:TransformationCollection</span><a class="self-link" href="#aggr-transformation-collection-class"></a></h4>
   
Describes a transformation catalog resource that lists the transformations supported by an Aggregator Server
(and optionally instance-specific transformations).


   <p><strong>type:</strong> <a href="https://www.w3.org/TR/rdf-schema/#ch_class">rdfs:Class</a><br>
<strong>subClassOf:</strong> <a href="https://schema.org/Collection">schema:Collection</a>,
<a href="https://www.hydra-cg.com/spec/latest/core/#collections">hydra:Collection</a></p>
   <h4 class="heading settled" data-level="9.1.6" id="aggr-registration-flow-class"><span class="secno">9.1.6. </span><span class="content">aggr:RegistrationFlow</span><a class="self-link" href="#aggr-registration-flow-class"></a></h4>
   
Describes a registration flow supported by an Aggregator Server.
This specification models each flow as an RDF class so that <code>aggr:supportedRegistrationType</code> can be
semantically annotated by referencing the relevant flow class (e.g., <code>aggr:AuthorizationCodeFlow</code>).


   <p><strong>type:</strong> <a href="https://www.w3.org/TR/rdf-schema/#ch_class">rdfs:Class</a><br>
<strong>subClassOf:</strong> <a href="https://www.w3.org/TR/rdf-schema/#ch_class">rdfs:Class</a></p>
   <h4 class="heading settled" data-level="9.1.7" id="aggr-no-auth-flow-class"><span class="secno">9.1.7. </span><span class="content">aggr:NoAuthFlow</span><a class="self-link" href="#aggr-no-auth-flow-class"></a></h4>
   
Registration flow where the Aggregator Instance does not authenticate and only accesses public resources.


   <p><strong>type:</strong> <a href="https://www.w3.org/TR/rdf-schema/#ch_class">rdfs:Class</a><br>
<strong>subClassOf:</strong> <code>aggr:RegistrationFlow</code></p>
   <h4 class="heading settled" data-level="9.1.8" id="aggr-provision-flow-class"><span class="secno">9.1.8. </span><span class="content">aggr:ProvisionFlow</span><a class="self-link" href="#aggr-provision-flow-class"></a></h4>
   
Registration flow where the Aggregator Server provisions an Aggregator Instance with its own identity.


   <p><strong>type:</strong> <a href="https://www.w3.org/TR/rdf-schema/#ch_class">rdfs:Class</a><br>
<strong>subClassOf:</strong> <code>aggr:RegistrationFlow</code></p>
   <h4 class="heading settled" data-level="9.1.9" id="aggr-authorization-code-flow-class"><span class="secno">9.1.9. </span><span class="content">aggr:AuthorizationCodeFlow</span><a class="self-link" href="#aggr-authorization-code-flow-class"></a></h4>
   
Registration flow based on OAuth 2.0 Authorization Code <a data-link-type="biblio" href="#biblio-rfc6749" title="The OAuth 2.0 Authorization Framework">[RFC6749]</a> (https://datatracker.ietf.org/doc/html/rfc6749)
(via OpenID Connect), where the Aggregator acts on behalf of an end-user with a token scoped to the
Aggregator.


   <p><strong>type:</strong> <a href="https://www.w3.org/TR/rdf-schema/#ch_class">rdfs:Class</a><br>
<strong>subClassOf:</strong> <code>aggr:RegistrationFlow</code></p>
   <h4 class="heading settled" data-level="9.1.10" id="aggr-device-code-flow-class"><span class="secno">9.1.10. </span><span class="content">aggr:DeviceCodeFlow</span><a class="self-link" href="#aggr-device-code-flow-class"></a></h4>
   
Registration flow based on OAuth 2.0 Device Authorization Grant <a data-link-type="biblio" href="#biblio-rfc8628" title="OAuth 2.0 Device Authorization Grant">[RFC8628]</a>.


   <p><strong>type:</strong> <a href="https://www.w3.org/TR/rdf-schema/#ch_class">rdfs:Class</a><br>
<strong>subClassOf:</strong> <code>aggr:RegistrationFlow</code></p>
   <h3 class="heading settled" data-level="9.2" id="vocabulary-properties"><span class="secno">9.2. </span><span class="content">Properties</span><a class="self-link" href="#vocabulary-properties"></a></h3>
   <h4 class="heading settled" data-level="9.2.1" id="aggr-created-at-property"><span class="secno">9.2.1. </span><span class="content">aggr:createdAt</span><a class="self-link" href="#aggr-created-at-property"></a></h4>
   
Timestamp when an <code>aggr:Aggregator</code> or <code>aggr:Service</code> was created.


   <p><strong>type:</strong> <a href="https://www.w3.org/TR/rdf-schema/#ch_property">rdf:Property</a><br>
<strong>domain:</strong> <code>aggr:Aggregator</code>, <code>aggr:Service</code><br>
<strong>range:</strong> <a href="https://www.w3.org/TR/xmlschema11-2/#dateTime">xsd:dateTime</a></p>
   <h4 class="heading settled" data-level="9.2.2" id="aggr-login-status-property"><span class="secno">9.2.2. </span><span class="content">aggr:loginStatus</span><a class="self-link" href="#aggr-login-status-property"></a></h4>
   
Indicates whether the stored token set for an <code>aggr:Aggregator</code> is currently valid.


   <p><strong>type:</strong> <a href="https://www.w3.org/TR/rdf-schema/#ch_property">rdf:Property</a><br>
<strong>domain:</strong> <code>aggr:Aggregator</code><br>
<strong>range:</strong> <a href="https://www.w3.org/TR/xmlschema11-2/#boolean">xsd:boolean</a></p>
   <h4 class="heading settled" data-level="9.2.3" id="aggr-token-expiry-property"><span class="secno">9.2.3. </span><span class="content">aggr:tokenExpiry</span><a class="self-link" href="#aggr-token-expiry-property"></a></h4>
   
Timestamp when the current access token for an <code>aggr:Aggregator</code> will expire.


   <p><strong>type:</strong> <a href="https://www.w3.org/TR/rdf-schema/#ch_property">rdf:Property</a><br>
<strong>domain:</strong> <code>aggr:Aggregator</code><br>
<strong>range:</strong> <a href="https://www.w3.org/TR/xmlschema11-2/#dateTime">xsd:dateTime</a></p>
   <h4 class="heading settled" data-level="9.2.4" id="aggr-transformations-endpoint-property"><span class="secno">9.2.4. </span><span class="content">aggr:transformationsEndpoint</span><a class="self-link" href="#aggr-transformations-endpoint-property"></a></h4>
   
Links an <code>aggr:Aggregator</code> to its (possibly private) transformations endpoint.


   <p><strong>type:</strong> <a href="https://www.w3.org/TR/rdf-schema/#ch_property">rdf:Property</a><br>
<strong>domain:</strong> <code>aggr:Aggregator</code><br>
<strong>range:</strong> <a href="https://www.w3.org/TR/xmlschema11-2/#anyURI">xsd:anyURI</a></p>
   <h4 class="heading settled" data-level="9.2.5" id="aggr-service-collection-endpoint-property"><span class="secno">9.2.5. </span><span class="content">aggr:serviceCollectionEndpoint</span><a class="self-link" href="#aggr-service-collection-endpoint-property"></a></h4>
   
Links an <code>aggr:Aggregator</code> to its service collection endpoint.


   <p><strong>type:</strong> <a href="https://www.w3.org/TR/rdf-schema/#ch_property">rdf:Property</a><br>
<strong>domain:</strong> <code>aggr:Aggregator</code><br>
<strong>range:</strong> <a href="https://www.w3.org/TR/xmlschema11-2/#anyURI">xsd:anyURI</a></p>
   <h4 class="heading settled" data-level="9.2.6" id="aggr-service-property"><span class="secno">9.2.6. </span><span class="content">aggr:service</span><a class="self-link" href="#aggr-service-property"></a></h4>
   
Links an <code>aggr:ServiceCollection</code> to the <code>aggr:Service</code> instances it advertises.


   <p><strong>type:</strong> <a href="https://www.w3.org/TR/rdf-schema/#ch_property">rdf:Property</a><br>
<strong>domain:</strong> <code>aggr:ServiceCollection</code><br>
<strong>range:</strong> <code>aggr:Service</code></p>
   <h4 class="heading settled" data-level="9.2.7" id="aggr-has-transformation-property"><span class="secno">9.2.7. </span><span class="content">aggr:hasTransformation</span><a class="self-link" href="#aggr-has-transformation-property"></a></h4>
   
Links an <code>aggr:TransformationCollection</code> to the transformations it advertises.


   <p><strong>type:</strong> <a href="https://www.w3.org/TR/rdf-schema/#ch_property">rdf:Property</a><br>
<strong>domain:</strong> <code>aggr:TransformationCollection</code><br>
<strong>range:</strong> <a href="https://w3id.org/function/spec/#Function">fno:Function</a></p>
   <h4 class="heading settled" data-level="9.2.8" id="aggr-status-property"><span class="secno">9.2.8. </span><span class="content">aggr:status</span><a class="self-link" href="#aggr-status-property"></a></h4>
   
Provides the lifecycle phase of an <code>aggr:Service</code> (values such as <code>running</code>, <code>stopped</code>, or <code>error</code>).


   <p><strong>type:</strong> <a href="https://www.w3.org/TR/rdf-schema/#ch_property">rdf:Property</a><br>
<strong>domain:</strong> <code>aggr:Service</code><br>
<strong>range:</strong> <a href="https://www.w3.org/TR/xmlschema11-2/#string">xsd:string</a></p>
   <h4 class="heading settled" data-level="9.2.9" id="aggr-status-detail-property"><span class="secno">9.2.9. </span><span class="content">aggr:statusDetail</span><a class="self-link" href="#aggr-status-detail-property"></a></h4>
   
Provides a human-readable explanation of the current <code>aggr:Service</code> status (for example, a stop reason or error message).


   <p><strong>type:</strong> <a href="https://www.w3.org/TR/rdf-schema/#ch_property">rdf:Property</a><br>
<strong>domain:</strong> <code>aggr:Service</code><br>
<strong>range:</strong> <a href="https://www.w3.org/TR/xmlschema11-2/#string">xsd:string</a></p>
   <h4 class="heading settled" data-level="9.2.10" id="aggr-registration-endpoint-property"><span class="secno">9.2.10. </span><span class="content">aggr:registrationEndpoint</span><a class="self-link" href="#aggr-registration-endpoint-property"></a></h4>
   
Links an <code>aggr:AggregatorServer</code> to its registration endpoint.


   <p><strong>type:</strong> <a href="https://www.w3.org/TR/rdf-schema/#ch_property">rdf:Property</a><br>
<strong>domain:</strong> <code>aggr:AggregatorServer</code><br>
<strong>range:</strong> <a href="https://www.w3.org/TR/xmlschema11-2/#anyURI">xsd:anyURI</a></p>
   <h4 class="heading settled" data-level="9.2.11" id="aggr-supported-registration-type-property"><span class="secno">9.2.11. </span><span class="content">aggr:supportedRegistrationType</span><a class="self-link" href="#aggr-supported-registration-type-property"></a></h4>
   
Lists the registration flows advertised by an <code>aggr:AggregatorServer</code>.


   <p><strong>type:</strong> <a href="https://www.w3.org/TR/rdf-schema/#ch_property">rdf:Property</a><br>
<strong>domain:</strong> <code>aggr:AggregatorServer</code><br>
<strong>range:</strong> <a href="https://www.w3.org/TR/rdf-schema/#ch_class">rdfs:Class</a> (expected to be an <code>aggr:RegistrationFlow</code> class)</p>
   <h4 class="heading settled" data-level="9.2.12" id="aggr-registration-request-format-supported-property"><span class="secno">9.2.12. </span><span class="content">aggr:registrationRequestFormatSupported</span><a class="self-link" href="#aggr-registration-request-format-supported-property"></a></h4>
   
Lists the supported request formats for an <code>aggr:AggregatorServer</code> registration endpoint.


   <p><strong>type:</strong> <a href="https://www.w3.org/TR/rdf-schema/#ch_property">rdf:Property</a><br>
<strong>domain:</strong> <code>aggr:AggregatorServer</code><br>
<strong>range:</strong> <a href="https://www.w3.org/TR/xmlschema11-2/#string">xsd:string</a></p>
   <h4 class="heading settled" data-level="9.2.13" id="aggr-spec-version-property"><span class="secno">9.2.13. </span><span class="content">aggr:specVersion</span><a class="self-link" href="#aggr-spec-version-property"></a></h4>
   
States which version of this specification an <code>aggr:AggregatorServer</code> implements.


   <p><strong>type:</strong> <a href="https://www.w3.org/TR/rdf-schema/#ch_property">rdf:Property</a><br>
<strong>domain:</strong> <code>aggr:AggregatorServer</code><br>
<strong>range:</strong> <a href="https://www.w3.org/TR/xmlschema11-2/#string">xsd:string</a></p>
   <h4 class="heading settled" data-level="9.2.14" id="aggr-client-id-property"><span class="secno">9.2.14. </span><span class="content">aggr:clientIdentifier</span><a class="self-link" href="#aggr-client-id-property"></a></h4>
   
Links an <code>aggr:AggregatorServer</code> to its Client ID Document.


   <p><strong>type:</strong> <a href="https://www.w3.org/TR/rdf-schema/#ch_property">rdf:Property</a><br>
<strong>domain:</strong> <code>aggr:AggregatorServer</code><br>
<strong>range:</strong> <a href="https://www.w3.org/TR/xmlschema11-2/#anyURI">xsd:anyURI</a></p>
   <h4 class="heading settled" data-level="9.2.15" id="aggr-transformation-catalog-property"><span class="secno">9.2.15. </span><span class="content">aggr:transformationCatalog</span><a class="self-link" href="#aggr-transformation-catalog-property"></a></h4>
   
References the Aggregator Server’s public transformation catalog.


   <p><strong>type:</strong> <a href="https://www.w3.org/TR/rdf-schema/#ch_property">rdf:Property</a><br>
<strong>domain:</strong> <code>aggr:AggregatorServer</code><br>
<strong>range:</strong> <a href="https://www.w3.org/TR/xmlschema11-2/#anyURI">xsd:anyURI</a></p>
   <h3 class="heading settled" data-level="9.3" id="vocabulary-claim-types"><span class="secno">9.3. </span><span class="content">Claim Types</span><a class="self-link" href="#vocabulary-claim-types"></a></h3>
   <h4 class="heading settled" data-level="9.3.1" id="aggr-transformation-description-claim-type"><span class="secno">9.3.1. </span><span class="content">aggr:transformation-description</span><a class="self-link" href="#aggr-transformation-description-claim-type"></a></h4>
   
Identifier for the UMA <code>claim_type</code> used to request or provide a transformation description.


   <p><strong>type:</strong> <a href="https://www.w3.org/TR/rdf-schema/#ch_resource">rdfs:Resource</a></p>
   <p>Claim tokens of this type MUST be RDF descriptions of the intended transformation (for example an <code>fno:Execution</code> or a
reference to a transformation catalog entry). Acceptable <code>claim_token_format</code> values are URIs identifying RDF 
serializations (such as <code>http://www.w3.org/ns/formats/Turtle</code> and <code>http://www.w3.org/ns/formats/JSON-LD</code>).</p>
   <h4 class="heading settled" data-level="9.3.2" id="aggr-derivation-access-claim-type"><span class="secno">9.3.2. </span><span class="content">aggr:derivation-access</span><a class="self-link" href="#aggr-derivation-access-claim-type"></a></h4>
   
Identifier for the UMA <code>claim_type</code> used to request or provide upstream access tokens for derived resources.


   <p><strong>type:</strong> <a href="https://www.w3.org/TR/rdf-schema/#ch_resource">rdfs:Resource</a></p>
   <p>Claim tokens of this type MUST be access tokens issued by the upstream Authorization Server for the
<code>derivation_resource_id</code> referenced in the claim request.</p>
  </main>
  <div data-fill-with="conformance">
   <h2 class="heading no-num no-ref settled" id="conformance"><span class="content">
    Conformance</span><a class="self-link" href="#conformance"></a></h2>
   <p>
            Conformance requirements are expressed with a combination of descriptive assertions and RFC 2119 terminology.
            The key words “MUST”, “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”, “RECOMMENDED”, “MAY”, and “OPTIONAL”
            in the normative parts of this document
            are to be interpreted as described in RFC 2119.
            However, for readability,
            these words do not appear in all uppercase letters in this specification.

        </p>
   <p>
            All of the text of this specification is normative
            except sections explicitly marked as non-normative, examples, and notes. <a data-link-type="biblio" href="#biblio-rfc2119" title="Key words for use in RFCs to Indicate Requirement Levels">[RFC2119]</a>

        </p>
   <p>
            Examples in this specification are introduced with the words “for example”
            or are set apart from the normative text with <code>class="example"</code>, like this:

        </p>
   <div class="example" id="example-example"><a class="self-link" href="#example-example"></a>
            This is an example of an informative example.
        </div>
   <p>
            Informative notes begin with the word “Note”
            and are set apart from the normative text with <code>class="note"</code>, like this:

        </p>
   <p class="note" role="note">
            Note, this is an informative note.</p>
  </div>
<script>
(function() {
  "use strict";
  var collapseSidebarText = '<span aria-hidden="true">←</span> '
                          + '<span>Collapse Sidebar</span>';
  var expandSidebarText   = '<span aria-hidden="true">→</span> '
                          + '<span>Pop Out Sidebar</span>';
  var tocJumpText         = '<span aria-hidden="true">↑</span> '
                          + '<span>Jump to Table of Contents</span>';

  var sidebarMedia = window.matchMedia('screen and (min-width: 78em)');
  var autoToggle   = function(e){ toggleSidebar(e.matches) };
  if(sidebarMedia.addListener) {
    sidebarMedia.addListener(autoToggle);
  }

  function toggleSidebar(on) {
    if (on == undefined) {
      on = !document.body.classList.contains('toc-sidebar');
    }

    /* Don't scroll to compensate for the ToC if we're above it already. */
    var headY = 0;
    var head = document.querySelector('.head');
    if (head) {
      // terrible approx of "top of ToC"
      headY += head.offsetTop + head.offsetHeight;
    }
    var skipScroll = window.scrollY < headY;

    var toggle = document.getElementById('toc-toggle');
    var tocNav = document.getElementById('toc');
    if (on) {
      var tocHeight = tocNav.offsetHeight;
      document.body.classList.add('toc-sidebar');
      document.body.classList.remove('toc-inline');
      toggle.innerHTML = collapseSidebarText;
      if (!skipScroll) {
        window.scrollBy(0, 0 - tocHeight);
      }
      tocNav.focus();
      sidebarMedia.addListener(autoToggle); // auto-collapse when out of room
    }
    else {
      document.body.classList.add('toc-inline');
      document.body.classList.remove('toc-sidebar');
      toggle.innerHTML = expandSidebarText;
      if (!skipScroll) {
        window.scrollBy(0, tocNav.offsetHeight);
      }
      if (toggle.matches(':hover')) {
        /* Unfocus button when not using keyboard navigation,
           because I don't know where else to send the focus. */
        toggle.blur();
      }
    }
  }

  function createSidebarToggle() {
    /* Create the sidebar toggle in JS; it shouldn't exist when JS is off. */
    var toggle = document.createElement('a');
      /* This should probably be a button, but appearance isn't standards-track.*/
    toggle.id = 'toc-toggle';
    toggle.class = 'toc-toggle';
    toggle.href = '#toc';
    toggle.innerHTML = collapseSidebarText;

    sidebarMedia.addListener(autoToggle);
    var toggler = function(e) {
      e.preventDefault();
      sidebarMedia.removeListener(autoToggle); // persist explicit off states
      toggleSidebar();
      return false;
    }
    toggle.addEventListener('click', toggler, false);


    /* Get <nav id=toc-nav>, or make it if we don't have one. */
    var tocNav = document.getElementById('toc-nav');
    if (!tocNav) {
      tocNav = document.createElement('p');
      tocNav.id = 'toc-nav';
      /* Prepend for better keyboard navigation */
      document.body.insertBefore(tocNav, document.body.firstChild);
    }
    /* While we're at it, make sure we have a Jump to Toc link. */
    var tocJump = document.getElementById('toc-jump');
    if (!tocJump) {
      tocJump = document.createElement('a');
      tocJump.id = 'toc-jump';
      tocJump.href = '#toc';
      tocJump.innerHTML = tocJumpText;
      tocNav.appendChild(tocJump);
    }

    tocNav.appendChild(toggle);
  }

  var toc = document.getElementById('toc');
  if (toc) {
    createSidebarToggle();
    toggleSidebar(sidebarMedia.matches);

    /* If the sidebar has been manually opened and is currently overlaying the text
       (window too small for the MQ to add the margin to body),
       then auto-close the sidebar once you click on something in there. */
    toc.addEventListener('click', function(e) {
      if(e.target.tagName.toLowerCase() == "a" && document.body.classList.contains('toc-sidebar') && !sidebarMedia.matches) {
        toggleSidebar(false);
      }
    }, false);
  }
  else {
    console.warn("Can't find Table of Contents. Please use <nav id='toc'> around the ToC.");
  }

  /* Wrap tables in case they overflow */
  var tables = document.querySelectorAll(':not(.overlarge) > table.data, :not(.overlarge) > table.index');
  var numTables = tables.length;
  for (var i = 0; i < numTables; i++) {
    var table = tables[i];
    var wrapper = document.createElement('div');
    wrapper.className = 'overlarge';
    table.parentNode.insertBefore(wrapper, table);
    wrapper.appendChild(table);
  }

})();
</script>
  <h2 class="heading no-num no-ref settled" id="references"><span class="content">References</span><a class="self-link" href="#references"></a></h2>
  <h3 class="heading no-num no-ref settled" id="normative"><span class="content">Normative References</span><a class="self-link" href="#normative"></a></h3>
  <dl>
   <dt id="biblio-a4ds">[A4DS]
   <dd><a href="https://spec.knows.idlab.ugent.be/A4DS/L1/latest/"><cite>Authorization for Data Spaces (A4DS)</cite></a>. URL: <a href="https://spec.knows.idlab.ugent.be/A4DS/L1/latest/">https://spec.knows.idlab.ugent.be/A4DS/L1/latest/</a>
   <dt id="biblio-client-id">[Client-ID]
   <dd>Aaron Parecki; Emelia Smith. <a href="https://datatracker.ietf.org/doc/draft-parecki-oauth-client-id-metadata-document/"><cite>OAuth Client ID Metadata Document</cite></a>. 10 January 2025. Internet-Draft. URL: <a href="https://datatracker.ietf.org/doc/draft-parecki-oauth-client-id-metadata-document/">https://datatracker.ietf.org/doc/draft-parecki-oauth-client-id-metadata-document/</a>
   <dt id="biblio-data-catalog">[Data-Catalog]
   <dd><a href="https://www.w3.org/TR/vocab-dcat-3/"><cite>Data Catalog Vocabulary</cite></a>. URL: <a href="https://www.w3.org/TR/vocab-dcat-3/">https://www.w3.org/TR/vocab-dcat-3/</a>
   <dt id="biblio-dcterms">[DCTERMS]
   <dd><a href="https://www.dublincore.org/specifications/dublin-core/dcmi-terms/"><cite>Dublin Core Metadata Terms</cite></a>. URL: <a href="https://www.dublincore.org/specifications/dublin-core/dcmi-terms/">https://www.dublincore.org/specifications/dublin-core/dcmi-terms/</a>
   <dt id="biblio-fno">[FNO]
   <dd><a href="https://w3id.org/function/spec/"><cite>Function Ontology (FnO)</cite></a>. URL: <a href="https://w3id.org/function/spec/">https://w3id.org/function/spec/</a>
   <dt id="biblio-foaf">[FOAF]
   <dd><a href="http://xmlns.com/foaf/0.1/"><cite>Friend of a Friend (FOAF)</cite></a>. URL: <a href="http://xmlns.com/foaf/0.1/">http://xmlns.com/foaf/0.1/</a>
   <dt id="biblio-oidc-core">[OIDC-Core]
   <dd><a href="https://openid.net/specs/openid-connect-core-1_0.html"><cite>OpenID Connect Core 1.0</cite></a>. URL: <a href="https://openid.net/specs/openid-connect-core-1_0.html">https://openid.net/specs/openid-connect-core-1_0.html</a>
   <dt id="biblio-rfc2119">[RFC2119]
   <dd>S. Bradner. <a href="https://datatracker.ietf.org/doc/html/rfc2119"><cite>Key words for use in RFCs to Indicate Requirement Levels</cite></a>. March 1997. Best Current Practice. URL: <a href="https://datatracker.ietf.org/doc/html/rfc2119">https://datatracker.ietf.org/doc/html/rfc2119</a>
   <dt id="biblio-sa4ds">[SA4DS]
   <dd><a href="https://solid.github.io/service-authorization-for-data-spaces/"><cite>Service Authorization for Data Spaces (SA4DS)</cite></a>. URL: <a href="https://solid.github.io/service-authorization-for-data-spaces/">https://solid.github.io/service-authorization-for-data-spaces/</a>
   <dt id="biblio-semver">[SEMVER]
   <dd><a href="https://semver.org/"><cite>Semantic Versioning 2.0.0</cite></a>. URL: <a href="https://semver.org/">https://semver.org/</a>
   <dt id="biblio-uma">[UMA]
   <dd><a href="https://docs.kantarainitiative.org/uma/rec-uma-core.html"><cite>User-Managed Access (UMA) 2.0</cite></a>. URL: <a href="https://docs.kantarainitiative.org/uma/rec-uma-core.html">https://docs.kantarainitiative.org/uma/rec-uma-core.html</a>
   <dt id="biblio-webid-profile">[WEBID-PROFILE]
   <dd><a href="https://solid.github.io/webid-profile/"><cite>WebID Profile</cite></a>. URL: <a href="https://solid.github.io/webid-profile/">https://solid.github.io/webid-profile/</a>
  </dl>
  <h3 class="heading no-num no-ref settled" id="informative"><span class="content">Informative References</span><a class="self-link" href="#informative"></a></h3>
  <dl>
   <dt id="biblio-rfc3339">[RFC3339]
   <dd>G. Klyne; C. Newman. <a href="https://www.rfc-editor.org/rfc/rfc3339"><cite>Date and Time on the Internet: Timestamps</cite></a>. July 2002. Proposed Standard. URL: <a href="https://www.rfc-editor.org/rfc/rfc3339">https://www.rfc-editor.org/rfc/rfc3339</a>
   <dt id="biblio-rfc6749">[RFC6749]
   <dd>D. Hardt, Ed.. <a href="https://www.rfc-editor.org/rfc/rfc6749"><cite>The OAuth 2.0 Authorization Framework</cite></a>. October 2012. Proposed Standard. URL: <a href="https://www.rfc-editor.org/rfc/rfc6749">https://www.rfc-editor.org/rfc/rfc6749</a>
   <dt id="biblio-rfc6750">[RFC6750]
   <dd>M. Jones; D. Hardt. <a href="https://www.rfc-editor.org/rfc/rfc6750"><cite>The OAuth 2.0 Authorization Framework: Bearer Token Usage</cite></a>. October 2012. Proposed Standard. URL: <a href="https://www.rfc-editor.org/rfc/rfc6750">https://www.rfc-editor.org/rfc/rfc6750</a>
   <dt id="biblio-rfc7636">[RFC7636]
   <dd>N. Sakimura, Ed.; J. Bradley; N. Agarwal. <a href="https://www.rfc-editor.org/rfc/rfc7636"><cite>Proof Key for Code Exchange by OAuth Public Clients</cite></a>. September 2015. Proposed Standard. URL: <a href="https://www.rfc-editor.org/rfc/rfc7636">https://www.rfc-editor.org/rfc/rfc7636</a>
   <dt id="biblio-rfc8628">[RFC8628]
   <dd>W. Denniss; et al. <a href="https://www.rfc-editor.org/rfc/rfc8628"><cite>OAuth 2.0 Device Authorization Grant</cite></a>. August 2019. Proposed Standard. URL: <a href="https://www.rfc-editor.org/rfc/rfc8628">https://www.rfc-editor.org/rfc/rfc8628</a>
   <dt id="biblio-rfc9110">[RFC9110]
   <dd>R. Fielding, Ed.; M. Nottingham, Ed.; J. Reschke, Ed.. <a href="https://httpwg.org/specs/rfc9110.html"><cite>HTTP Semantics</cite></a>. June 2022. Internet Standard. URL: <a href="https://httpwg.org/specs/rfc9110.html">https://httpwg.org/specs/rfc9110.html</a>
  </dl>
  <h2 class="heading no-num no-ref settled" id="issues-index"><span class="content">Issues Index</span><a class="self-link" href="#issues-index"></a></h2>
  <div style="counter-reset:issue">
   <div class="issue"> should we allow a name field for the aggregator during creation? <a class="issue-return" href="#issue-7876f244" title="Jump to section">↵</a></div>
   <div class="issue"> How should the Aggregator Service delete the <code>derivation_resource_id</code> at the UAS? <a class="issue-return" href="#issue-3e489c46" title="Jump to section">↵</a></div>
   <div class="issue"> How does the Aggregator Service inspect the asset on the UAS? Probably via the same endpoint as an RS would do it
in A4DS. Can the aggregator also do a GET to this endpoint to verify the validity of the derivation_resource_id? <a class="issue-return" href="#issue-68530d09" title="Jump to section">↵</a></div>
   <div class="issue"> Maybe the resource_scopes should be send during the access token request from the Aggregator to the UAS?
Maybe we could send <code>derived_resource_scopes</code> to the UAS and during resource registration send this to the AAS as well?
This scope should be the same as the one required to access the derived resource. <a class="issue-return" href="#issue-c93571db" title="Jump to section">↵</a></div>
   <div class="issue"> Do we define the exact scopes here? <a class="issue-return" href="#issue-e6c8b095" title="Jump to section">↵</a></div>
  </div>