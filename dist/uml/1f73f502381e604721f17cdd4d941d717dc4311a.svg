<?plantuml 1.2026.1beta5?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="SEQUENCE" height="418px" preserveAspectRatio="none" style="width:712px;height:418px;background:#FFFFFF;" version="1.1" viewBox="0 0 712 418" width="712px" zoomAndPan="magnify"><defs/><g><g class="participant-lifeline" data-entity-uid="part1" data-qualified-name="Client" id="part1-lifeline"><g><title>Client ...</title><rect fill="#000000" fill-opacity="0.00000" height="346.4609" width="8" x="38.8916" y="36.2969"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="42" x2="42" y1="36.2969" y2="382.7578"/></g></g><g class="participant-lifeline" data-entity-uid="part2" data-qualified-name="User" id="part2-lifeline"><g><title>User .</title><rect fill="#000000" fill-opacity="0.00000" height="346.4609" width="8" x="116.1641" y="36.2969"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="119.7832" x2="119.7832" y1="36.2969" y2="382.7578"/></g></g><g class="participant-lifeline" data-entity-uid="part3" data-qualified-name="Aggregator" id="part3-lifeline"><g><title>Aggregator Server .</title><rect fill="#000000" fill-opacity="0.00000" height="346.4609" width="8" x="340.2271" y="36.2969"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="344.123" x2="344.123" y1="36.2969" y2="382.7578"/></g></g><g class="participant-lifeline" data-entity-uid="part4" data-qualified-name="AppClientDoc" id="part4-lifeline"><g><title>Client ID .</title><rect fill="#000000" fill-opacity="0.00000" height="346.4609" width="8" x="599.1538" y="36.2969"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="602.7832" x2="602.7832" y1="36.2969" y2="382.7578"/></g></g><g class="participant-lifeline" data-entity-uid="part5" data-qualified-name="IDP" id="part5-lifeline"><g><title>IDP .</title><rect fill="#000000" fill-opacity="0.00000" height="346.4609" width="8" x="677.626" y="36.2969"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="681.5244" x2="681.5244" y1="36.2969" y2="382.7578"/></g></g><g class="participant participant-head" data-entity-uid="part1" data-qualified-name="Client" id="part1-head"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="75.7832" x="5" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="61.7832" x="12" y="24.9951">Client &#129489;&#8205;&#128187;</text></g><g class="participant participant-tail" data-entity-uid="part1" data-qualified-name="Client" id="part1-tail"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="75.7832" x="5" y="381.7578"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="61.7832" x="12" y="401.7529">Client &#129489;&#8205;&#128187;</text></g><g class="participant participant-head" data-entity-uid="part2" data-qualified-name="User" id="part2-head"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="58.7617" x="90.7832" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="44.7617" x="97.7832" y="24.9951">User &#128587;</text></g><g class="participant participant-tail" data-entity-uid="part2" data-qualified-name="User" id="part2-tail"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="58.7617" x="90.7832" y="381.7578"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="44.7617" x="97.7832" y="401.7529">User &#128587;</text></g><g class="participant participant-head" data-entity-uid="part3" data-qualified-name="Aggregator" id="part3-head"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="156.208" x="266.123" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="142.208" x="273.123" y="24.9951">Aggregator Server &#129302;</text></g><g class="participant participant-tail" data-entity-uid="part3" data-qualified-name="Aggregator" id="part3-tail"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="156.208" x="266.123" y="381.7578"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="142.208" x="273.123" y="401.7529">Aggregator Server &#129302;</text></g><g class="participant participant-head" data-entity-uid="part4" data-qualified-name="AppClientDoc" id="part4-head"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="86.7412" x="559.7832" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="72.7412" x="566.7832" y="24.9951">Client ID &#128196;</text></g><g class="participant participant-tail" data-entity-uid="part4" data-qualified-name="AppClientDoc" id="part4-tail"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="86.7412" x="559.7832" y="381.7578"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="72.7412" x="566.7832" y="401.7529">Client ID &#128196;</text></g><g class="participant participant-head" data-entity-uid="part5" data-qualified-name="IDP" id="part5-head"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="50.2031" x="656.5244" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="36.2031" x="663.5244" y="24.9951">IDP &#128272;</text></g><g class="participant participant-tail" data-entity-uid="part5" data-qualified-name="IDP" id="part5-tail"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="50.2031" x="656.5244" y="381.7578"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="36.2031" x="663.5244" y="401.7529">IDP &#128272;</text></g><g class="message" data-entity-1="part1" data-entity-2="part3" id="msg1"><polygon fill="#181818" points="332.2271,63.4297,342.2271,67.4297,332.2271,71.4297,336.2271,67.4297" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="42.8916" x2="338.2271" y1="67.4297" y2="67.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="182.3428" x="49.8916" y="62.3638">1. Start aggregator creation</text></g><g class="message" data-entity-1="part3" data-entity-2="part1" id="msg2"><polygon fill="#181818" points="53.8916,92.5625,43.8916,96.5625,53.8916,100.5625,49.8916,96.5625" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="47.8916" x2="343.2271" y1="96.5625" y2="96.5625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="277.3354" x="59.8916" y="91.4966">1.2 Return client_id, code_challenge, state</text></g><g class="message" data-entity-1="part1" data-entity-2="part5" id="msg3"><polygon fill="#181818" points="669.626,121.6953,679.626,125.6953,669.626,129.6953,673.626,125.6953" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="42.8916" x2="675.626" y1="125.6953" y2="125.6953"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="149.8174" x="49.8916" y="120.6294">2. Redirect to IDP login</text></g><g class="message" data-entity-1="part5" data-entity-2="part2" id="msg4"><polygon fill="#181818" points="131.1641,150.8281,121.1641,154.8281,131.1641,158.8281,127.1641,154.8281" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="669.626,150.8281,679.626,154.8281,669.626,158.8281,673.626,154.8281" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="125.1641" x2="675.626" y1="154.8281" y2="154.8281"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="184.3296" x="137.1641" y="149.7622">3. Authenticate and consent</text></g><g class="message" data-entity-1="part5" data-entity-2="part1" id="msg5"><polygon fill="#181818" points="53.8916,179.9609,43.8916,183.9609,53.8916,187.9609,49.8916,183.9609" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="47.8916" x2="680.626" y1="183.9609" y2="183.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="190.3027" x="59.8916" y="178.895">4. Redirect with code + state</text></g><g class="message" data-entity-1="part1" data-entity-2="part3" id="msg6"><polygon fill="#181818" points="332.2271,209.0938,342.2271,213.0938,332.2271,217.0938,336.2271,213.0938" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="42.8916" x2="338.2271" y1="213.0938" y2="213.0938"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="241.7061" x="49.8916" y="208.0278">5. Return code + redirect_uri + state</text></g><g class="message" data-entity-1="part3" data-entity-2="part4" id="msg7"><polygon fill="#181818" points="355.2271,238.2266,345.2271,242.2266,355.2271,246.2266,351.2271,242.2266" style="stroke:#181818;stroke-width:1;"/><polygon fill="#181818" points="591.1538,238.2266,601.1538,242.2266,591.1538,246.2266,595.1538,242.2266" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="349.2271" x2="597.1538" y1="242.2266" y2="242.2266"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="234.9268" x="361.2271" y="237.1606">5.1 Dereference Client ID document</text></g><path d="M266,255.2266 L266,280.2266 L421,280.2266 L421,265.2266 L411,255.2266 L266,255.2266" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><path d="M411,255.2266 L411,265.2266 L421,265.2266 L411,255.2266" fill="#FEFFDD" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="134.9512" x="272" y="272.2935">validate redirect_uri.</text><g class="message" data-entity-1="part3" data-entity-2="part5" id="msg8"><polygon fill="#181818" points="669.626,302.4922,679.626,306.4922,669.626,310.4922,673.626,306.4922" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="344.2271" x2="675.626" y1="306.4922" y2="306.4922"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="114.2324" x="351.2271" y="301.4263">5.2 Redeem code</text></g><g class="message" data-entity-1="part5" data-entity-2="part3" id="msg9"><polygon fill="#181818" points="355.2271,331.625,345.2271,335.625,355.2271,339.625,351.2271,335.625" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="349.2271" x2="680.626" y1="335.625" y2="335.625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="252.6748" x="361.2271" y="330.5591">IDP_aggregator_token + refresh_token</text></g><g class="message" data-entity-1="part3" data-entity-2="part1" id="msg10"><polygon fill="#181818" points="53.8916,360.7578,43.8916,364.7578,53.8916,368.7578,49.8916,364.7578" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="47.8916" x2="343.2271" y1="364.7578" y2="364.7578"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="248.6821" x="59.8916" y="359.6919">5.3 Return aggregator account details</text></g><?plantuml-src TLAzJiCm4Dxp5AUij97QqgL2I1LPkY4gviXoZjIgQqUEKyJ6m8QG-1CIKnSa7eAtuGdw29oTq3X234dEv--x--wxL6kXIcRO1kXj1HSbKtPfRoI2GMwPAYH6KN07Pr8WVLW5SHlkTvzFtxSF-ztpLzo3NbPeFD07-ztxVVy-dXU5mO9PRM29Pkj17s-nutHNVKhRSv4IzEMkWPPbaqqrxuCNwJd1NXyzZ0vHrDA7fq636OmIM5eY0ki4SOFC2gsYGEIGU4q5nnd31ThQAE0-bOby05pdcF4Lan9LWGEeBBCOjYKLCnWdHCs5SnYiTZcGkX0gSj49ePnXCvWaCA_jYfY2KnbWAgS6ggA4HuPoZeEIryAkl18u-YiWd7kQ74PeqAOjaTL67CY10KvRQBShCO8K3LxHepX2jvzSythZf2fDshNRRjXxowJ8tLHXpwJdTklMr3kT8swypCFeOJNAPTtoCglNgFmyLmQhLNEE_blbD9dy-X3y08npNTCeELecPFK3?></g></svg>