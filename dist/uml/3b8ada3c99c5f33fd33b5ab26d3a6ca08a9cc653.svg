<?plantuml 1.2026.1?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="SEQUENCE" height="441px" preserveAspectRatio="none" style="width:1148px;height:441px;background:#FFFFFF;" version="1.1" viewBox="0 0 1148 441" width="1148px" zoomAndPan="magnify"><defs/><g><g class="participant-lifeline" data-entity-uid="part1" data-qualified-name="A" id="part1-lifeline"><g><title>Aggregator Service ..</title><rect fill="#000000" fill-opacity="0.00000" height="369.5938" width="8" x="84.0942" y="36.2969"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="88" x2="88" y1="36.2969" y2="405.8906"/></g></g><g class="participant-lifeline" data-entity-uid="part2" data-qualified-name="AAS" id="part2-lifeline"><g><title>Aggregator Authorization Server ..</title><rect fill="#000000" fill-opacity="0.00000" height="369.5938" width="8" x="312.0635" y="36.2969"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="315.8501" x2="315.8501" y1="36.2969" y2="405.8906"/></g></g><g class="participant-lifeline" data-entity-uid="part3" data-qualified-name="URS" id="part3-lifeline"><g><title>Upstream Resource Server .</title><rect fill="#000000" fill-opacity="0.00000" height="369.5938" width="8" x="556.9292" y="36.2969"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="560.2769" x2="560.2769" y1="36.2969" y2="405.8906"/></g></g><g class="participant-lifeline" data-entity-uid="part4" data-qualified-name="UAS" id="part4-lifeline"><g><title>Upstream Authorization Server ..</title><rect fill="#000000" fill-opacity="0.00000" height="369.5938" width="8" x="816.4336" y="36.2969"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="819.4668" x2="819.4668" y1="36.2969" y2="405.8906"/></g></g><g class="participant-lifeline" data-entity-uid="part5" data-qualified-name="IdP" id="part5-lifeline"><g><title>Identity Provider .</title><rect fill="#000000" fill-opacity="0.00000" height="369.5938" width="8" x="1066.6958" y="36.2969"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="1070.1201" x2="1070.1201" y1="36.2969" y2="405.8906"/></g></g><g class="participant participant-head" data-entity-uid="part1" data-qualified-name="A" id="part1-head"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="166.1885" x="5" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="152.1885" x="12" y="24.9951">Aggregator Service &#9881;&#65039;</text></g><g class="participant participant-tail" data-entity-uid="part1" data-qualified-name="A" id="part1-tail"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="166.1885" x="5" y="404.8906"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="152.1885" x="12" y="424.8857">Aggregator Service &#9881;&#65039;</text></g><g class="participant participant-head" data-entity-uid="part2" data-qualified-name="AAS" id="part2-head"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="254.4268" x="188.8501" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="240.4268" x="195.8501" y="24.9951">Aggregator Authorization Server &#128737;&#65039;</text></g><g class="participant participant-tail" data-entity-uid="part2" data-qualified-name="AAS" id="part2-tail"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="254.4268" x="188.8501" y="404.8906"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="240.4268" x="195.8501" y="424.8857">Aggregator Authorization Server &#128737;&#65039;</text></g><g class="participant participant-head" data-entity-uid="part3" data-qualified-name="URS" id="part3-head"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="215.3047" x="453.2769" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="201.3047" x="460.2769" y="24.9951">Upstream Resource Server &#128230;</text></g><g class="participant participant-tail" data-entity-uid="part3" data-qualified-name="URS" id="part3-tail"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="215.3047" x="453.2769" y="404.8906"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="201.3047" x="460.2769" y="424.8857">Upstream Resource Server &#128230;</text></g><g class="participant participant-head" data-entity-uid="part4" data-qualified-name="UAS" id="part4-head"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="243.9336" x="698.4668" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="229.9336" x="705.4668" y="24.9951">Upstream Authorization Server &#128737;&#65039;</text></g><g class="participant participant-tail" data-entity-uid="part4" data-qualified-name="UAS" id="part4-tail"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="243.9336" x="698.4668" y="404.8906"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="229.9336" x="705.4668" y="424.8857">Upstream Authorization Server &#128737;&#65039;</text></g><g class="participant participant-head" data-entity-uid="part5" data-qualified-name="IdP" id="part5-head"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="143.1514" x="999.1201" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="129.1514" x="1006.1201" y="24.9951">Identity Provider &#128272;</text></g><g class="participant participant-tail" data-entity-uid="part5" data-qualified-name="IdP" id="part5-tail"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="143.1514" x="999.1201" y="404.8906"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="129.1514" x="1006.1201" y="424.8857">Identity Provider &#128272;</text></g><g class="message" data-entity-1="part1" data-entity-2="part3" id="msg1"><polygon fill="#181818" points="548.9292,63.4297,558.9292,67.4297,548.9292,71.4297,552.9292,67.4297" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="88.0942" x2="554.9292" y1="67.4297" y2="67.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="250.2119" x="95.0942" y="62.3638">1. Request resource (no access token)</text></g><g class="message" data-entity-1="part3" data-entity-2="part4" id="msg2"><polygon fill="#181818" points="808.4336,92.5625,818.4336,96.5625,808.4336,100.5625,812.4336,96.5625" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="560.9292" x2="814.4336" y1="96.5625" y2="96.5625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="235.5044" x="567.9292" y="91.4966">1.1 Request UMA ticket for resource</text></g><g class="message" data-entity-1="part3" data-entity-2="part1" id="msg3"><polygon fill="#181818" points="99.0942,121.6953,89.0942,125.6953,99.0942,129.6953,95.0942,125.6953" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="93.0942" x2="559.9292" y1="125.6953" y2="125.6953"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="230.4263" x="105.0942" y="120.6294">1.2 401 Unauthorized + UMA ticket</text></g><g class="message" data-entity-1="part1" data-entity-2="part4" id="msg4"><polygon fill="#181818" points="808.4336,150.8281,818.4336,154.8281,808.4336,158.8281,812.4336,154.8281" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="88.0942" x2="814.4336" y1="154.8281" y2="154.8281"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="158.812" x="95.0942" y="149.7622">2. Request access token</text></g><g class="message" data-entity-1="part4" data-entity-2="part5" id="msg5"><polygon fill="#181818" points="1058.6958,179.9609,1068.6958,183.9609,1058.6958,187.9609,1062.6958,183.9609" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="820.4336" x2="1064.6958" y1="183.9609" y2="183.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="226.2622" x="827.4336" y="178.895">2.1 Validate IDP_aggregator_token</text></g><g class="message" data-entity-1="part4" data-entity-2="part1" id="msg6"><polygon fill="#181818" points="99.0942,209.0938,89.0942,213.0938,99.0942,217.0938,95.0942,213.0938" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="93.0942" x2="819.4336" y1="213.0938" y2="213.0938"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="218.2896" x="105.0942" y="208.0278">2.2 Request transformation claim</text></g><g class="message" data-entity-1="part1" data-entity-2="part4" id="msg7"><polygon fill="#181818" points="808.4336,238.2266,818.4336,242.2266,808.4336,246.2266,812.4336,242.2266" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="88.0942" x2="814.4336" y1="242.2266" y2="242.2266"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="349.0322" x="95.0942" y="237.1606">2.3 Request access token (with transformation claim)</text></g><g class="message" data-entity-1="part4" data-entity-2="part1" id="msg8"><polygon fill="#181818" points="99.0942,267.3594,89.0942,271.3594,99.0942,275.3594,95.0942,271.3594" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="93.0942" x2="819.4336" y1="271.3594" y2="271.3594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="478.3784" x="105.0942" y="266.2935">2.4 access_token + derivation_resource_id + management_access_token</text></g><g class="message" data-entity-1="part1" data-entity-2="part3" id="msg9"><polygon fill="#181818" points="548.9292,296.4922,558.9292,300.4922,548.9292,304.4922,552.9292,300.4922" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="88.0942" x2="554.9292" y1="300.4922" y2="300.4922"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="251.4561" x="95.0942" y="295.4263">3. Request resource with access token</text></g><g class="message" data-entity-1="part1" data-entity-2="part4" id="msg10"><polygon fill="#181818" points="808.4336,325.625,818.4336,329.625,808.4336,333.625,812.4336,329.625" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="88.0942" x2="814.4336" y1="329.625" y2="329.625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="191.2676" x="95.0942" y="324.5591">4. Get derivation_resource_id</text></g><g class="message" data-entity-1="part1" data-entity-2="part4" id="msg11"><polygon fill="#181818" points="808.4336,354.7578,818.4336,358.7578,808.4336,362.7578,812.4336,358.7578" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="88.0942" x2="814.4336" y1="358.7578" y2="358.7578"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="272.4795" x="95.0942" y="353.6919">4.1 Update derivation_resource_id scopes</text></g><g class="message" data-entity-1="part1" data-entity-2="part2" id="msg12"><polygon fill="#181818" points="304.0635,383.8906,314.0635,387.8906,304.0635,391.8906,308.0635,387.8906" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="88.0942" x2="310.0635" y1="387.8906" y2="387.8906"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="203.9692" x="95.0942" y="382.8247">5. Update resource registration</text></g><?plantuml-src XPBDIiD058NtUOfBLorYCMtTk1061Eb2A2rn6uRacWvDPkBCj59VGa4twaBS-0m-Zo-WZ-3DvCT4MjnaC-UxvznpOrP2vbpp3EXhHIHoBkt2RbC4ZP7bCadHyrflq6D9eZ7XLcbOeDw82E7p-Udhuwu7t03RAsPhkrHQt78hb7GeQlX-VNbhKBRema5kh4RADaUZrfgC6khXtI71V1_ohrlmrsqQexJ2Rc6crKR4JlvuxxJJUEPv30vF2yCJy8UKw7gDnb99LRA-LC2Z28q1grOe1nv97S4SuJT8SC60N5TeuOfggIUKUW9O8H_1vCY7GF9g3OpXe4NMQOhPezyqxG0UFHOQobveVBZagOYvHPYUpKBUt2LigKlt4RdN4wtcqb3ChEmnIhd8EjxZdURGln5skPCUTAqc5LV6e2MfUB5n-h2k9XJ5zXcNFC6CZXIsaVPXnZiEuu9qYcdbdmpXdEwmsxEZesFahhqz-KoaSZJLR5OmnyCQQR9GvOB-JqTxFm00?></g></svg>