<?plantuml 1.2026.1?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" data-diagram-type="SEQUENCE" height="412px" preserveAspectRatio="none" style="width:1195px;height:412px;background:#FFFFFF;" version="1.1" viewBox="0 0 1195 412" width="1195px" zoomAndPan="magnify"><defs/><g><g class="participant-lifeline" data-entity-uid="part1" data-qualified-name="A" id="part1-lifeline"><g><title>Aggregator Service ..</title><rect fill="#000000" fill-opacity="0.00000" height="340.4609" width="8" x="84.0942" y="36.2969"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="88" x2="88" y1="36.2969" y2="376.7578"/></g></g><g class="participant-lifeline" data-entity-uid="part2" data-qualified-name="AAS" id="part2-lifeline"><g><title>Aggregator Authorization Server ..</title><rect fill="#000000" fill-opacity="0.00000" height="340.4609" width="8" x="359.4297" y="36.2969"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="363.2163" x2="363.2163" y1="36.2969" y2="376.7578"/></g></g><g class="participant-lifeline" data-entity-uid="part3" data-qualified-name="URS" id="part3-lifeline"><g><title>Upstream Resource Server .</title><rect fill="#000000" fill-opacity="0.00000" height="340.4609" width="8" x="604.2954" y="36.2969"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="607.6431" x2="607.6431" y1="36.2969" y2="376.7578"/></g></g><g class="participant-lifeline" data-entity-uid="part4" data-qualified-name="UAS" id="part4-lifeline"><g><title>Upstream Authorization Server ..</title><rect fill="#000000" fill-opacity="0.00000" height="340.4609" width="8" x="863.7998" y="36.2969"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="866.833" x2="866.833" y1="36.2969" y2="376.7578"/></g></g><g class="participant-lifeline" data-entity-uid="part5" data-qualified-name="IdP" id="part5-lifeline"><g><title>Identity Provider .</title><rect fill="#000000" fill-opacity="0.00000" height="340.4609" width="8" x="1114.062" y="36.2969"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5,5;" x1="1117.4863" x2="1117.4863" y1="36.2969" y2="376.7578"/></g></g><g class="participant participant-head" data-entity-uid="part1" data-qualified-name="A" id="part1-head"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="166.1885" x="5" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="152.1885" x="12" y="24.9951">Aggregator Service &#9881;&#65039;</text></g><g class="participant participant-tail" data-entity-uid="part1" data-qualified-name="A" id="part1-tail"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="166.1885" x="5" y="375.7578"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="152.1885" x="12" y="395.7529">Aggregator Service &#9881;&#65039;</text></g><g class="participant participant-head" data-entity-uid="part2" data-qualified-name="AAS" id="part2-head"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="254.4268" x="236.2163" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="240.4268" x="243.2163" y="24.9951">Aggregator Authorization Server &#128737;&#65039;</text></g><g class="participant participant-tail" data-entity-uid="part2" data-qualified-name="AAS" id="part2-tail"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="254.4268" x="236.2163" y="375.7578"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="240.4268" x="243.2163" y="395.7529">Aggregator Authorization Server &#128737;&#65039;</text></g><g class="participant participant-head" data-entity-uid="part3" data-qualified-name="URS" id="part3-head"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="215.3047" x="500.6431" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="201.3047" x="507.6431" y="24.9951">Upstream Resource Server &#128230;</text></g><g class="participant participant-tail" data-entity-uid="part3" data-qualified-name="URS" id="part3-tail"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="215.3047" x="500.6431" y="375.7578"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="201.3047" x="507.6431" y="395.7529">Upstream Resource Server &#128230;</text></g><g class="participant participant-head" data-entity-uid="part4" data-qualified-name="UAS" id="part4-head"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="243.9336" x="745.833" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="229.9336" x="752.833" y="24.9951">Upstream Authorization Server &#128737;&#65039;</text></g><g class="participant participant-tail" data-entity-uid="part4" data-qualified-name="UAS" id="part4-tail"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="243.9336" x="745.833" y="375.7578"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="229.9336" x="752.833" y="395.7529">Upstream Authorization Server &#128737;&#65039;</text></g><g class="participant participant-head" data-entity-uid="part5" data-qualified-name="IdP" id="part5-head"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="143.1514" x="1046.4863" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="129.1514" x="1053.4863" y="24.9951">Identity Provider &#128272;</text></g><g class="participant participant-tail" data-entity-uid="part5" data-qualified-name="IdP" id="part5-tail"><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="143.1514" x="1046.4863" y="375.7578"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="129.1514" x="1053.4863" y="395.7529">Identity Provider &#128272;</text></g><g class="message" data-entity-1="part1" data-entity-2="part3" id="msg1"><polygon fill="#181818" points="596.2954,63.4297,606.2954,67.4297,596.2954,71.4297,600.2954,67.4297" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="88.0942" x2="602.2954" y1="67.4297" y2="67.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="250.2119" x="95.0942" y="62.3638">1. Request resource (no access token)</text></g><g class="message" data-entity-1="part3" data-entity-2="part4" id="msg2"><polygon fill="#181818" points="855.7998,92.5625,865.7998,96.5625,855.7998,100.5625,859.7998,96.5625" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="608.2954" x2="861.7998" y1="96.5625" y2="96.5625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="235.5044" x="615.2954" y="91.4966">1.1 Request UMA ticket for resource</text></g><g class="message" data-entity-1="part3" data-entity-2="part1" id="msg3"><polygon fill="#181818" points="99.0942,121.6953,89.0942,125.6953,99.0942,129.6953,95.0942,125.6953" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="93.0942" x2="607.2954" y1="125.6953" y2="125.6953"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="230.4263" x="105.0942" y="120.6294">1.2 401 Unauthorized + UMA ticket</text></g><g class="message" data-entity-1="part1" data-entity-2="part4" id="msg4"><polygon fill="#181818" points="855.7998,150.8281,865.7998,154.8281,855.7998,158.8281,859.7998,154.8281" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="88.0942" x2="861.7998" y1="154.8281" y2="154.8281"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="158.812" x="95.0942" y="149.7622">2. Request access token</text></g><g class="message" data-entity-1="part4" data-entity-2="part5" id="msg5"><polygon fill="#181818" points="1106.062,179.9609,1116.062,183.9609,1106.062,187.9609,1110.062,183.9609" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="867.7998" x2="1112.062" y1="183.9609" y2="183.9609"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="226.2622" x="874.7998" y="178.895">2.1 Validate IDP_aggregator_token</text></g><g class="message" data-entity-1="part4" data-entity-2="part1" id="msg6"><polygon fill="#181818" points="99.0942,209.0938,89.0942,213.0938,99.0942,217.0938,95.0942,213.0938" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="93.0942" x2="866.7998" y1="213.0938" y2="213.0938"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="218.2896" x="105.0942" y="208.0278">2.2 Request transformation claim</text></g><g class="message" data-entity-1="part1" data-entity-2="part4" id="msg7"><polygon fill="#181818" points="855.7998,238.2266,865.7998,242.2266,855.7998,246.2266,859.7998,242.2266" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="88.0942" x2="861.7998" y1="242.2266" y2="242.2266"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="349.0322" x="95.0942" y="237.1606">2.3 Request access token (with transformation claim)</text></g><g class="message" data-entity-1="part4" data-entity-2="part1" id="msg8"><polygon fill="#181818" points="99.0942,267.3594,89.0942,271.3594,99.0942,275.3594,95.0942,271.3594" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;stroke-dasharray:2,2;" x1="93.0942" x2="866.7998" y1="271.3594" y2="271.3594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="478.3784" x="105.0942" y="266.2935">2.4 access_token + derivation_resource_id + management_access_token</text></g><g class="message" data-entity-1="part1" data-entity-2="part3" id="msg9"><polygon fill="#181818" points="596.2954,296.4922,606.2954,300.4922,596.2954,304.4922,600.2954,300.4922" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="88.0942" x2="602.2954" y1="300.4922" y2="300.4922"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="251.4561" x="95.0942" y="295.4263">3. Request resource with access token</text></g><g class="message" data-entity-1="part1" data-entity-2="part4" id="msg10"><polygon fill="#181818" points="855.7998,325.625,865.7998,329.625,855.7998,333.625,859.7998,329.625" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="88.0942" x2="861.7998" y1="329.625" y2="329.625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="333.436" x="95.0942" y="324.5591">4. Update derivation_resource_id metadata on UAS</text></g><g class="message" data-entity-1="part1" data-entity-2="part2" id="msg11"><polygon fill="#181818" points="351.4297,354.7578,361.4297,358.7578,351.4297,362.7578,355.4297,358.7578" style="stroke:#181818;stroke-width:1;"/><line style="stroke:#181818;stroke-width:1;" x1="88.0942" x2="357.4297" y1="358.7578" y2="358.7578"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="251.3354" x="95.0942" y="353.6919">5. Update resource registration at AAS</text></g><?plantuml-src XP8zJiD048Lxds94bGWHaHyQ2gILQ58WHObCQutimLd5NeVr92XS0YHeW0BHS0REmmNW28pNiR5H8ffjzdtxthpPVA7D4Ysc82VhK2_Hy8mt2O6baD742NbUumuEL1nRYf4p2pEoQnqIV3u_VNtS7G3ceFQArOhdcTMto3ep3YKBtwylRpMgPctON-PiIR9DASzMLengwk7T8Vvq7_Alc__NRHoHOSqRcDXihICdVxntsd4qyJm5HsU5uIdqUvBeUaKvIqdRP1sJ0OOXvJbmjY3JzKJg2EM8Vetu5mh4TK4CLr9BzKAf5q0LyW6CZllW6zoEGH4SDiWgJV7su3TDCu0dbuL6iXUQFbnYeYDaWl7v9C1wBq53NReFnBrwaIsQN6AcPOzXWZfjUGztcaFdHlDy9zrjMussN1b3XfJYzThfWwgQG1VJfsWmfbIM53IHvcA6EnRZWhIAQUGVzS1VkbBssAR4AFS84h_uCIMh2lQaPcilgLJB_okdHNO_-WS0?></g></svg>